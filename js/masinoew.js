/*!
 * JavaScript for PHPMaker v2022.11.0
 * Copyright (c) e.World Technology Limited. All rights reserved.
 */
(function(ew$1,$$1,luxon){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var ew__default=_interopDefaultLegacy(ew$1);var $__default=_interopDefaultLegacy($$1);var luxon__default=_interopDefaultLegacy(luxon);function MultiPage(formid){var self=this;this.$form=null;this.formID=formid;this.pageIndex=1;this.maxPageIndex=0;this.minPageIndex=0;this.pageIndexes=[];this.$pages=null;this.$collapses=null;this.isTab=false;this.isCollapse=false;this.lastPageSubmit=false;this.hideDisabledButton=false;this.hideInactivePages=false;this.lockTabs=false;this.hideTabs=false;this.showPagerTop=false;this.showPagerBottom=false;this.pagerTemplate='<nav><ul class="pagination"><li class="page-item previous ew-prev"><a href="#" class="page-link"><span class="icon-prev"></span> {Prev}</a></li><li class="page-item next ew-next"><a href="#" class="page-link">{Next} <span class="icon-next"></span></a></li></ul></nav>';var _show=function(e){e.preventDefault()};var _properties=["lastPageSubmit","hideDisabledButton","hideInactivePages","lockTabs","hideTabs","showPagerTop","showPagerBottom","pagerTemplate"];this.set=function(){if(arguments.length==1&&$__default["default"].isObject(arguments[0])){var obj=arguments[0];for(var i in obj){var p=i[0].toLowerCase()+i.substr(1);if(_properties.includes(p))this[p]=obj[i]}}};this.init=function(){var tpl=this.pagerTemplate.replace(/\{prev\}/i,ew.language.phrase("Prev")).replace(/\{next\}/i,ew.language.phrase("Next"));if(this.isTab){if(this.showPagerTop)this.$pages.closest(".ew-nav").before(tpl);if(this.showPagerBottom)this.$pages.closest(".ew-nav").after(tpl);this.$form.find(".ew-prev").click((function(e){self.$pages.off("show.bs.tab",_show).filter(".active").parent().prev(":has([data-bs-toggle=tab]:not(.ew-hidden):not(.ew-disabled))").find("[data-bs-toggle=tab]").toggleClass("disabled d-none",false).click();return false}));this.$form.find(".ew-next").click((function(e){self.$pages.off("show.bs.tab",_show).filter(".active").parent().next(":has([data-bs-toggle=tab]:not(.ew-hidden):not(.ew-disabled))").find("[data-bs-toggle=tab]").toggleClass("disabled d-none",false).click();return false}));if(this.hideTabs)this.$form.find(".ew-multi-page > .ew-nav > .nav-tabs").hide()}else if(this.isCollapse){if(this.showPagerTop)this.$collapses.closest(".ew-accordion").before(tpl);if(this.showPagerBottom)this.$collapses.closest(".ew-accordion").after(tpl);this.$form.find(".ew-prev").click((function(e){self.$pages.closest(".card").filter(":has(.collapse.show)").prev(":has([data-bs-toggle=collapse]:not(.ew-hidden):not(.ew-disabled))").toggleClass("disabled d-none",false).find("[data-bs-toggle=collapse]").click();return false}));this.$form.find(".ew-next").click((function(e){self.$pages.closest(".card").filter(":has(.collapse.show)").next(":has([data-bs-toggle=collapse]:not(.ew-hidden):not(.ew-disabled))").toggleClass("disabled d-none",false).find("[data-bs-toggle=collapse]").click();return false}))}this.pageShow()};this.pageShow=function(){if(this.isTab){if(this.lockTabs)this.$pages.on("show.bs.tab",_show);this.$pages.each((function(){var $this=$__default["default"](this);if(self.hideInactivePages)$this.toggleClass("d-none",!$this.hasClass("active"));if(self.lockTabs)$this.toggleClass("disabled",!$this.hasClass("active"))}))}else if(this.isCollapse){this.$pages.closest(".card").each((function(){var $this=$__default["default"](this);if(self.hideInactivePages)$this.toggleClass("d-none",!$this.find(".collapse.show")[0])}))}var disabled=this.lastPageSubmit&&this.pageIndex!=this.maxPageIndex;var $btn=this.$form.closest(".content, .modal-content").find("#btn-action, button.ew-submit").prop("disabled",disabled).toggle(!this.hideDisabledButton||!disabled);$__default["default"](".ew-captcha").toggle($btn.is(":visible:not(:disabled)"));disabled=this.pageIndex<=this.minPageIndex;this.$form.find(".ew-prev").toggleClass("disabled",disabled);disabled=this.pageIndex>=this.maxPageIndex;this.$form.find(".ew-next").toggleClass("disabled",disabled)};this.gotoPage=function(i){if(i<=0||i<this.minPageIndex||i>this.maxPageIndex)return;if(this.pageIndex!=i){var $page=this.$pages.eq(i-1);if(this.isTab){if($page.is(":not(.d-none):not(.disabled)"))$page.click();else $page.parent().next(":has([data-bs-toggle=tab]):not(.d-none):not(.disabled)").find("[data-bs-toggle=tab]").toggleClass("disabled",false).click()}else if(this.isCollapse){var $p=$page.closest(".card");if($p.is(":not(.d-none)"))$page.click();else $p.next(":has([data-bs-toggle=collapse]):not(.d-none)").find("[data-bs-toggle=collapse]").click()}this.pageIndex=i}};this.gotoPageByIndex=this.gotoPage;this.gotoPageByElement=function(el){this.gotoPage(parseInt($__default["default"](el).data("page"),10)||-1)};this.gotoPageByElementId=function(id){var $el=this.$form.find("[data-page]").filter("[id='"+id+"'],[name='"+id+"'],[data-field='"+id+"']");this.gotoPageByElement($el)};this.togglePage=function(i,show){if(this.isTab){this.$pages.eq(i-1).toggleClass("d-none",!show)}else if(this.isCollapse){this.$pages.eq(i-1).closest(".card").toggle("d-none",!show)}};this.render=function(){this.$form=$__default["default"]("#"+formid);this.pageIndexes=this.$form.find("[data-page]").map((function(){var index=parseInt(this.dataset.page,10);return index>0?index:null})).get();this.pageIndexes.sort((function(a,b){return a-b}));this.minPageIndex=this.pageIndexes[0];this.maxPageIndex=this.pageIndexes[this.pageIndexes.length-1];var $tabs=this.$form.find("[data-bs-toggle=tab]");if($tabs[0]){this.$pages=$tabs;this.isTab=true;$tabs.on("shown.bs.tab",(function(e){self.pageIndex=$tabs.index(e.target)+1;self.pageShow();$__default["default"]($__default["default"](this).attr("href")).find(".ew-map").each((function(){var m=ew.maps[this.id];if(m!=null&&m["map"]){google.maps.event.trigger(m["map"],"resize");m["map"].setCenter(m["latlng"])}}))}));this.pageIndex=$tabs.index($tabs.parent(".active"))+1}else{this.$collapses=this.$form.find("[data-bs-toggle=collapse]");if(this.$collapses[0]){this.$pages=this.$collapses;this.isCollapse=true;var $bodies=this.$collapses.closest(".card-header").next();$bodies.on("shown.bs.collapse",(function(e){self.pageIndex=$bodies.index(e.target)+1;self.pageShow();$__default["default"](this).find(".ew-map").each((function(){var m=ew.maps[this.id];if(m!=null&&m["map"]){google.maps.event.trigger(m["map"],"resize");m["map"].setCenter(m["latlng"])}}))}));this.pageIndex=$bodies.index($bodies.hasClass("show"))+1}}$__default["default"]((function(){self.init()}))}}function userLevelId(el){if(el&&!ew.checkInteger(el.value))return{userLevelId:ew.language.phrase("UserLevelIDInteger")};var level=parseInt(el.value,10);if(level<1)return{userLevelId:ew.language.phrase("UserLevelIDIncorrect")};return false}function userLevelName(id){return function(el){let elId=document.getElementById("x_"+id);if(elId&&el){let name=el.value.trim(),level=parseInt(elId.value.trim(),10);if(level===0&&!ew.sameText(name,"Default")){return{userLevelName:ew.language.phrase("UserLevelDefaultName")}}else if(level===-1&&!ew.sameText(name,"Administrator")){return{userLevelName:ew.language.phrase("UserLevelAdministratorName")}}else if(level===-2&&!ew.sameText(name,"Anonymous")){return{userLevelName:ew.language.phrase("UserLevelAnonymousName")}}else if(level>0&&["anonymous","administrator","default"].includes(name.toLowerCase())){return{userLevelName:ew.language.phrase("UserLevelNameIncorrect")}}}return false}}function required(fieldName){return function(el){var _$el$data;let $el=$__default["default"](el),$p=$el.closest("#r_"+((_$el$data=$el.data("field"))==null?void 0:_$el$data.substr(2)));if(!$p[0])$p=$el.closest("[id^=el]");if($p.css("display")=="none"){return false}if(el&&!ew.hasValue(el)){return{required:ew.language.phrase("EnterRequiredField").replace("%s",fieldName)}}return false}}function fileRequired(fieldName){return function(el){let elFn=document.getElementById("fn_"+el.id);if(elFn&&!ew.hasValue(elFn)){return{fileRequired:ew.language.phrase("EnterRequiredField").replace("%s",fieldName)}}return false}}function mismatchPassword(el){let id;if(el.id.startsWith("c_"))id=el.id.replace(/^c_/,"x_");else if(el.id=="cpwd")id="npwd";let elPwd=document.getElementById(id);if(el.value!==elPwd.value){return{mismatchPassword:ew.language.phrase("MismatchPassword")}}return false}function between(el){let x,z;if(el.id.startsWith("y_")){x=document.getElementById(el.id.replace(/^y_/,"x_"));z=document.getElementById(el.id.replace(/^y_/,"z_"))}if(ew.hasValue(x)&&$__default["default"](z).val()=="BETWEEN"&&!ew.hasValue(el)){return{between:ew.language.phrase("EnterValue2")}}return false}function passwordStrength(el){let $el=$__default["default"](el);if(!ew.isMaskedPassword(el)&&$el.hasClass("ew-password-strength")&&!$el.data("validated")){return{passwordStrength:ew.language.phrase("PasswordTooSimple")}}return false}function username(raw){return function(el){if(!raw&&el.value.match(new RegExp("["+ew.escapeRegExChars(ew.INVALID_USERNAME_CHARACTERS)+"]")))return{username:ew.language.phrase("InvalidUsernameChars")};return false}}function password(raw){return function(el){if(!raw&&!ew.ENCRYPTED_PASSWORD&&el.value.match(new RegExp("["+ew.escapeRegExChars(ew.INVALID_PASSWORD_CHARACTERS)+"]")))return{password:ew.language.phrase("InvalidPasswordChars")};return false}}function email(el){let value=ew.getValue(el);if(!ew.checkEmail(value)){return{email:ew.language.phrase("IncorrectEmail")}}return false}function emails(cnt,err){return function(el){let value=ew.getValue(el);if(!ew.checkEmails(value,cnt)){return{email:err}}return false}}function datetime(format){return function(el){let value=ew.getValue(el);if(!ew.checkDate(value,format)){return{datetime:ew.language.phrase("IncorrectDate").replace(/%s/g,format)}}return false}}function time(format){return function(el){let value=ew.getValue(el);if(!ew.checkTime(value,format)){return{time:ew.language.phrase("IncorrectTime").replace(/%s/g,format)}}return false}}function float(el){let value=ew.getValue(el);if(!ew.checkNumber(value)){return{time:ew.language.phrase("IncorrectFloat")}}return false}function range(min,max){return function(el){let value=ew.getValue(el);if(!ew.checkRange(value,min,max)){return{range:ew.language.phrase("IncorrectRange").replace("%1",min).replace("%2",max)}}return false}}function integer(el){let value=ew.getValue(el);if(!ew.checkInteger(value)){return{integer:ew.language.phrase("IncorrectInteger")}}return false}function phone(el){let value=ew.getValue(el);if(!ew.checkPhone(value)){return{phone:ew.language.phrase("IncorrectPhone")}}return false}function zip(el){let value=ew.getValue(el);if(!ew.checkZip(value)){return{zip:ew.language.phrase("IncorrectZip")}}return false}function creditCard(el){let value=ew.getValue(el);if(!ew.checkCreditCard(value)){return{creditCard:ew.language.phrase("IncorrectCreditCard")}}return false}function ssn(el){let value=ew.getValue(el);if(!ew.checkSsn(value)){return{ssn:ew.language.phrase("IncorrectSSN")}}return false}function guid(el){let value=ew.getValue(el);if(!ew.checkGuid(value)){return{guid:ew.language.phrase("IncorrectGUID")}}return false}function regex(pattern){return function(el){let value=ew.getValue(el);if(!ew.checkByRegEx(value,pattern)){return{regex:ew.language.phrase("IncorrectField")}}return false}}function url(el){let value=ew.getValue(el);if(!ew.checkUrl(value)){return{url:ew.language.phrase("IncorrectUrl")}}return false}function custom(fn,...args){return function(el){if(typeof fn=="function"){let value=ew.getValue(el);if(fn(value,...args))return{custom:ew.language.phrase("IncorrectField")}}return false}}function captcha(el){if(el&&!ew.hasValue(el)){return{captcha:ew.language.phrase("EnterValidateCode")}}return false}function recaptcha(el){var _grecaptcha;if(el&&!ew.hasValue(el)&&((_grecaptcha=grecaptcha)==null?void 0:_grecaptcha.getResponse(el.dataset.id))===""){return{recaptcha:ew.language.phrase("ClickReCaptcha")}}return false}var Validators={__proto__:null,userLevelId:userLevelId,userLevelName:userLevelName,required:required,fileRequired:fileRequired,mismatchPassword:mismatchPassword,between:between,passwordStrength:passwordStrength,username:username,password:password,email:email,emails:emails,datetime:datetime,time:time,float:float,range:range,integer:integer,phone:phone,zip:zip,creditCard:creditCard,ssn:ssn,guid:guid,regex:regex,url:url,custom:custom,captcha:captcha,recaptcha:recaptcha};function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}$__default["default"].batchSettings={type:"POST",contentType:"application/json",processData:false,dataType:"json",toJSON:JSON.stringify,parse:data=>data};$__default["default"].batchSetup=function(options){return $__default["default"].extend($__default["default"].batchSettings,options)};var Batch=$__default["default"].batch=function(func,options){if(!(this instanceof Batch)){return new Batch(func,options)}if(typeof func==="object"){options=func;func=undefined}this.options=$__default["default"].extend({},$__default["default"].batchSettings,options);this.parent=$__default["default"].ajaxSetup()._batch;this.requests=[];if(func){this.add(func)}return this};$__default["default"].extend(Batch.prototype,{add:function(func){var _func$name;$__default["default"].ajaxSetup({_batch:this.parent||this});if((_func$name=func.name)!=null&&_func$name.startsWith("bound ")){func()}else{func.call($__default["default"].ajaxSetup()._batch)}if(!this.parent){$__default["default"].ajaxSetup({_batch:null})}return this},clear:function(){this.requests=[]},send:function(options){options=options||{};var instance=this;if(this.parent&&options.success){var parentSuccess=this.parent.options.success;this.parent.options.success=function(data,status,xhr){options.success(data,status,xhr);if(parentSuccess){parentSuccess(data,status,xhr)}}}else if(this.requests.length){var requests=$__default["default"].map(this.requests,(function(request){return request.settings.data}));var success=options.success;var childSuccess=this.options.success;options.success=function(data,statusText,xhr){instance._deliver.call(instance,data,statusText);if(childSuccess){childSuccess(data,statusText,xhr)}if(success){success(data,statusText,xhr)}};options=$__default["default"].extend({},this.options,options);if(!options.data){options.data=$__default["default"].batchSettings.toJSON(requests)}return $__default["default"].ajax(options)}},_addRequest:function(xhr,settings){this.requests.push({xhr:xhr,settings:settings})},_deliver:function(data,statusText){var _responses$error;var instance=this;var responses=$__default["default"].batchSettings.parse(data);if(responses!=null&&(_responses$error=responses.error)!=null&&_responses$error.description){var _responses$error2;ew__default["default"].alert(responses==null?void 0:(_responses$error2=responses.error)==null?void 0:_responses$error2.description);return}$__default["default"].each(responses,(function(i,response){var _request$settings$com;if(!instance.requests[i]){return}var request=instance.requests[i];request.xhr.statusText=statusText;if(statusText==="success"){var _request$settings$suc;(_request$settings$suc=request.settings.success)==null?void 0:_request$settings$suc.call(request.xhr,response,statusText)}(_request$settings$com=request.settings.complete)==null?void 0:_request$settings$com.call(request.xhr,statusText)}))}});var $ajax=$__default["default"].ajax;$__default["default"].ajax=function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var beforeSend=options.beforeSend;options.beforeSend=function(xhr,settings){if(beforeSend){var before=beforeSend(xhr,settings);if(before===false){return before}}if(settings._batch){settings._batch._addRequest(xhr,settings);return false}};return $ajax.call(this,url,options)};function FormBase(id,pageId){var self=this,$self=$__default["default"](self);this._initiated=false;this.id=id;this.element=document.getElementById(id);this.$element=$__default["default"](this.element);this.pageId=pageId;this.htmlForm=null;this.initSearchPanel=false;this.modified=false;this.emptyRow=null;this.multiPage=null;this.autoSuggests={};this.lists={};this.batch=new Batch;this.formKeyCountName="";this.submitReturnsPromise=false;this.disableForm=function(){var form=this.getForm();$__default["default"](form).find(":submit:not(.dropdown-toggle)").prop("disabled",true).addClass("disabled");this.trigger("disabled")};this.enableForm=function(){var form=this.getForm(),$form=$__default["default"](form);$form.find(".ew-disabled-element").removeClass("ew-disabled-element").prop("disabled",false);$form.find(".ew-enabled-element").removeClass("ew-enabled-element").prop("disabled",true);$form.find(":submit:not(.dropdown-toggle)").prop("disabled",false).removeClass("disabled");this.trigger("enabled")};this.appendHidden=function(el){var form=this.getForm(),$form=$__default["default"](form),$dp=$__default["default"](el).closest(".ew-form"),name=$dp.attr("id")+"$"+el.name;if($form.find("input:hidden[name='"+name+"']")[0])return;var ar=$dp.find('[name="'+el.name+'"]').serializeArray();if(ar.length){ar.forEach((function(o,i){$__default["default"]('<input type="hidden" name="'+name+'">').val(o.value).appendTo($form)}))}else{$__default["default"]('<input type="hidden" name="'+name+'">').val("").appendTo($form)}};this.canSubmit=async function(e){var form=this.getForm(),$form=$__default["default"](form);this.disableForm();this.updateTextArea();if(!this.validate||this.validate()&&!$form.find(".is-invalid")[0]){$form.find("input[name^=sv_], input[name^=p_], .ew-template input, .ew-custom-option").prop("disabled",true).addClass("ew-disabled-element");$form.find("[data-readonly=1][disabled]").prop("disabled",false).addClass("ew-enabled-element");var $dps=$form.find("input[name=detailpage]").map((function(i,el){return $form.find("#"+el.value)[0]}));if($dps.length>1){$dps.each((function(i,dp){$__default["default"](dp).find(":input").each((function(j,el){if(/^(fn_)?(x|o)\d*_/.test(el.name)){var $els=$dps.not(dp).find(":input[name='"+el.name+"']");if($els.length){self.appendHidden(el);$els.each((function(){self.appendHidden(this)}))}}}))}))}let args={form:form,result:true},evt=$__default["default"].Event("beforesubmit",{originalEvent:e});$form.trigger(evt,[args]);let result=await args.result;if(!evt.isDefaultPrevented()&&(result===true||$__default["default"].isObject(result)&&result.value))return true}else{this.enableForm()}return false};this.submit=async function(e){var _e$originalEvent,_e$originalEvent$subm;let form=this.getForm(),formAction=e==null?void 0:(_e$originalEvent=e.originalEvent)==null?void 0:(_e$originalEvent$subm=_e$originalEvent.submitter)==null?void 0:_e$originalEvent$subm.formAction;if(formAction)form.setAttribute("action",formAction);if(await this.canSubmit(e)){if(this.submitReturnsPromise){let url=form.getAttribute("action").split("#")[0].split("?")[0],method=form.method.toUpperCase(),body=$__default["default"](form).serialize();return ew.fetch(url,{method:method,body:body}).finally((()=>this.enableForm()))}else{form.submit()}}else{this.enableForm()}};this.getList=function(name){name=name.replace(/^(sv_)?[xy](\d*|\$rowindex\$)_|\[\]$/g,"");return this.lists[name]};this.compileTemplates=function(){let lists=Object.values(this.lists);for(let list of lists){if(list.template&&$__default["default"].isString(list.template))list.template=$__default["default"].templates(list.template)}};this.getForm=function(){if(!this.htmlForm){var _this$element,_this$element2;if(((_this$element=this.element)==null?void 0:_this$element.tagName)=="FORM"){this.htmlForm=this.element}else if(((_this$element2=this.element)==null?void 0:_this$element2.tagName)=="DIV"){this.htmlForm=this.element.closest("form")}}return this.htmlForm};this.getElement=function(name){return name?ew.getElement(name,this.$element):this.$element[0]};this.getElements=function(name){var selector="[name='"+name+"']";selector="input"+selector+",selection-list"+selector+",select"+selector+",textarea"+selector+",button"+selector;var $els=this.$element.find(selector);if($els.length==0)return null;if($els.length==1&&$els.is("[type=checkbox]"))return $els[0];if($els.length==1&&$els.is(":not([type=checkbox]):not([type=radio])"))return $els[0];if($els.length==2&&$els.eq(0).is("selection-list")&&$els.eq(1).is("input[type=hidden]"))return $els[0];return $els.get()};this.updateLists=function(rowindex,immediate){var _form$querySelector;if(rowindex===null)return;if(this.pageId=="grid"&&!$__default["default"].isNumber(rowindex)&&!$__default["default"].isUndefined(rowindex))return;var form=this.getForm();if((form==null?void 0:(_form$querySelector=form.querySelector("input#confirm"))==null?void 0:_form$querySelector.value)=="confirm")return;var fixId=(id,multiple)=>{var t="",i=rowindex,ar=id.split(" ");if(ar.length>1){t=ar[0];i="";id=ar[1]}let prefix=$__default["default"].isNumber(i)?"x"+i+"_":"x_";if(id.startsWith("x_"))id=id.replace(/^x_/,prefix);else id=prefix+id;if(multiple&&!id.endsWith("[]"))id+="[]";return t?t+" "+id:id};var selector=Object.entries(this.lists).map((([id,list])=>"[name='"+fixId(id,list.multiple)+"']")).join();if(selector&&form.querySelector(selector)){this.compileTemplates();var requests=[];for(let[id,list]of Object.entries(this.lists)){let parents=list.parentFields.slice().map((parent=>fixId(parent))),ajax=list.ajax&&!list.lookupOptions.length;id=fixId(id,list.multiple);if(ajax){let pvalues=parents.map((parent=>ew.getOptionValues(parent,form)));requests.push([id,pvalues,ajax,false])}else{ew.updateOptions.call(this,id,parents,false,false)}}requests.forEach((request=>this.batch.add(ew.updateOptions.bind(this,...request))))}if(this.batch.requests.length){if(rowindex===undefined||immediate){let deferreds=[],batchSize=ew.ajaxBatchSize>0?ew.ajaxBatchSize:1;while(this.batch.requests.length>batchSize){let b=new Batch;b.requests=this.batch.requests.splice(0,batchSize);deferreds.push(b.send({url:ew.getApiUrl(ew.API_LOOKUP_ACTION)}))}if(this.batch.requests.length>0)deferreds.push(this.batch.send({url:ew.getApiUrl(ew.API_LOOKUP_ACTION)}));$__default["default"].when(...deferreds).then((()=>$__default["default"](document).trigger("updatedone",[{source:self,target:form}]))).fail((error=>console.log(error))).always((()=>this.batch.clear()))}}else{$__default["default"](document).trigger("updatedone",[{source:self,target:form}])}};this.createAutoSuggest=function(settings){var options=Object.assign({limit:ew.AUTO_SUGGEST_MAX_ENTRIES,form:this},ew.autoSuggestSettings,settings);self.autoSuggests[settings.id]=new ew.AutoSuggest(options)};this.initEditors=function(){var form=this.getForm();$__default["default"](form.elements).filter("textarea.editor").each((function(i,el){var ed=$__default["default"](el).data("editor");if(ed&&!ed.active&&!ed.name.includes("$rowindex$"))ed.create()}))};this.updateTextArea=function(name){var form=this.getForm();$__default["default"](form.elements).filter("textarea.editor").each((function(i,el){var ed=$__default["default"](el).data("editor");if(!ed||name&&ed.name!=name)return true;ed.save();if(name)return false}))};this.destroyEditor=function(name){var form=this.getForm();$__default["default"](form.elements).filter("textarea.editor").each((function(i,el){var ed=$__default["default"](el).data("editor");if(!ed||name&&ed.name!=name)return true;ed.destroy();if(name)return false}))};this.onError=function(el,msg){return ew.onError(this,el,msg)};this.initUpload=function(){var form=this.getForm();$__default["default"](form.elements).filter("input:file:not([name*='$rowindex$'])").each((function(index){$__default["default"].later(ew.AJAX_DELAY*index,null,ew.upload,this)}))};this.setupFilters=function(e,filters){var id=this.id,data=this.filterList?this.filterList.data:null,$sf=$__default["default"](".ew-save-filter[data-form="+id+"]").toggleClass("disabled",!data),$df=$__default["default"](".ew-delete-filter[data-form="+id+"]").toggleClass("disabled",!filters.length).toggleClass("dropdown-toggle",!!filters.length),$delete=$df.parent("li").toggleClass("dropdown-submenu dropdown-hover",!!filters.length).toggleClass("disabled",!filters.length),$save=$sf.parent("li").toggleClass("disabled",!data);var saveFilters=function(id,filters){if(ew.SEARCH_FILTER_OPTION=="Client"){localStorage.setItem(ew.PROJECT_NAME+"_"+id+"_filters",JSON.stringify(filters))}else if(ew.SEARCH_FILTER_OPTION=="Server"){var $body=$__default["default"]("body").css("cursor","wait");$__default["default"].ajax(ew.currentPage(),{type:"POST",dataType:"json",data:{ajax:"savefilters",filters:JSON.stringify(filters)}}).done((function(result){if(result[0]&&result[0].success)self.filterList.filters=filters})).always((function(){$body.css("cursor","default")}))}};$save.off("click.ew").on("click.ew",(function(e){if($save.hasClass("disabled"))return false;ew.prompt({input:"text",html:ew.language.phrase("EnterFilterName")},(name=>{name=ew.sanitize(name);if(name){filters.push([name,data]);saveFilters(id,filters)}}),true)})).prevAll().remove();$df.next("ul.dropdown-menu").remove();if(filters.length){var $submenu=$__default["default"]("<ul class='dropdown-menu'></ul>");for(var i in filters){if(!Array.isArray(filters[i]))continue;$__default["default"]('<li><a class="dropdown-item" data-index="'+i+'" data-ew-action="none">'+filters[i][0]+"</a></li>").on("click",(function(e){var i=$__default["default"](this).find("a[data-index]").data("index");ew.prompt({html:ew.language.phrase("DeleteFilterConfirm").replace("%s",filters[i][0]),showCancelButton:true,icon:"question"},(result=>{if(result){filters.splice(i,1);saveFilters(id,filters)}}))})).appendTo($submenu);$__default["default"]('<li><a class="dropdown-item ew-filter-list" data-index="'+i+'" data-ew-action="none">'+$($.parseHTML(filters[i][0])).text()+"</a></li>").insertBefore($save).on("click",(function(e){var i=$__default["default"](this).find("a[data-index]").data("index");$__default["default"]("<form>").attr({method:"post",action:ew.currentPage()}).append($__default["default"]("<input type='hidden'>").attr({name:"cmd",value:"resetfilter"}),$__default["default"]("<input type='hidden'>").attr({name:ew.TOKEN_NAME_KEY,value:ew.TOKEN_NAME}),$__default["default"]("<input type='hidden'>").attr({name:ew.ANTIFORGERY_TOKEN_KEY,value:ew.ANTIFORGERY_TOKEN}),$__default["default"]("<input type='hidden'>").attr({name:"filter",value:JSON.stringify(filters[i][1])})).appendTo("body").trigger("submit")}))}$__default["default"]("<li class='dropdown-divider'></li>").insertBefore($save);$delete.append($submenu)}};this.on=function(){$self.on(...arguments)};this.one=function(){$self.one(...arguments)};this.off=function(){$self.off(...arguments)};this.trigger=function(){$self.trigger(...arguments)};this.init=function(){if(this._initiated)return;var form=this.getForm();if(!form)return;var $form=$__default["default"](form);if(ew.SEARCH_FILTER_OPTION=="Client"||ew.SEARCH_FILTER_OPTION=="Server"&&ew.IS_LOGGEDIN&&!ew.IS_SYS_ADMIN&&ew.CURRENT_USER_NAME!=""){$__default["default"](".ew-filter-option .ew-btn-dropdown").on("show.bs.dropdown",(function(e){var _self$filterList$filt,_self$filterList;var filters=[];if(ew.SEARCH_FILTER_OPTION=="Client"){var item=localStorage.getItem(ew.PROJECT_NAME+"_"+self.id+"_filters");if(item)filters=ew.parseJson(item)||[]}else if(ew.SEARCH_FILTER_OPTION=="Server")filters=(_self$filterList$filt=(_self$filterList=self.filterList)==null?void 0:_self$filterList.filters)!=null?_self$filterList$filt:[];var ar=$__default["default"].grep(filters,(function(val){if(Array.isArray(val)&&val.length==2)return val}));self.setupFilters(e,ar)})).removeClass("d-none").show()}else{$__default["default"](".ew-filter-option").addClass("d-none").hide()}this.compileTemplates();if(/s(ea)?rch$/.test(this.id)){if(this.initSearchPanel&&!ew.hasFormData(form))$__default["default"]("#"+this.id+"_search_panel").removeClass("show");if(!$__default["default"](".ew-table .ew-search-operator").text().trim())$__default["default"](".ew-table .ew-search-operator").parent("td").hide();$form.find("select[id^=z_]").each((function(){var $this=$__default["default"](this).trigger("change");if($this.val()!="BETWEEN")$form.find("#w_"+this.id.substring(2)).trigger("change")}))}if(this.multiPage)this.multiPage.render();loadjs.ready(["editor"],(()=>setTimeout(this.initEditors.bind(this),0)));this.updateLists();this.initUpload();if(this.$element.is("form")){this.$element.find(".ew-detail-pages .ew-nav a[data-bs-toggle=tab]").on("shown.bs.tab",(function(e){var $tab=$__default["default"](e.target.getAttribute("href")),$panel=$tab.find(".table-responsive.ew-grid-middle-panel"),$container=$tab.closest(".container-fluid");if($panel.width()>=$container.width())$panel.width($container.width()+"px");else $panel.width("auto")}));$form.on("submit",(function(e){let args={form:form,result:self.submit(e)},evt=$__default["default"].Event("aftersubmit",{originalEvent:e});self.trigger(evt,[args]);return false}));$form.find("[data-field], .ew-priv").on("change",(function(){if(ew.CONFIRM_CANCEL)self.modified=true}));$form.find("#btn-cancel[data-href]").on("click",(function(){self.updateTextArea();var href=this.dataset.href;if(self.modified&&ew.hasFormData(form)){ew.prompt({html:ew.language.phrase("ConfirmCancel"),showCancelButton:true,icon:"question"},(result=>{if(result){$form.find("#btn-action").prop("disabled",true);window.location=href}}))}else{$form.find("#btn-action").prop("disabled",true);window.location=href}}))}this._initiated=true;this.$element.data("form",this);this.trigger("initiated")};ew.forms.add(this)}let Field=function(){function Field(fldvar,validators,invalid){_defineProperty(this,"name","");_defineProperty(this,"validators",[]);_defineProperty(this,"_validate",true);this.name=fldvar;if(Array.isArray(validators)){for(let validator of validators)this.addValidator(validator)}else if(typeof validators==="function"){this.addValidator(validators)}this.invalid=invalid}var _proto=Field.prototype;_proto.addValidator=function addValidator(validator){if(typeof validator==="function")this.validators.push(validator)};_proto.addError=function addError(err){if(err){var _this$_error;let error=(_this$_error=this._error)!=null?_this$_error:{};this._error={...error,...err};this.invalid=true}};_proto.clearErrors=function clearErrors(){this._error=null;this.invalid=false};_proto.clearValidators=function clearValidators(){this.validators=[]};_proto.validate=function validate(){let result=true;this.clearErrors();if(this._element&&this.shouldValidate){if(Array.isArray(this.validators)){for(let validator of this.validators){let err=validator(this._element);if(err!==false){this.addError(err);result=false}}this.updateFeedback()}}return result};_proto.resetInvalid=function resetInvalid(){var _this$_element,_this$_element$classL,_this$_element$closes,_this$_element$closes2;this.clearErrors();if((_this$_element=this._element)!=null&&(_this$_element$classL=_this$_element.classList)!=null&&_this$_element$classL.contains("is-invalid")&&!this._error)this.addError({server:(_this$_element$closes=this._element.closest(ew.fieldContainerSelector))==null?void 0:(_this$_element$closes2=_this$_element$closes.querySelector(".invalid-feedback"))==null?void 0:_this$_element$closes2.innerHTML})};_proto.updateFeedback=function updateFeedback(){let err=this.errorMessage;if(this._element&&err){var _this$_element$closes3;let feedback=(_this$_element$closes3=this._element.closest(ew.fieldContainerSelector))==null?void 0:_this$_element$closes3.querySelector(".invalid-feedback");if(feedback)feedback.innerHTML=err;ew.setInvalid(this._element)}};_proto.focus=function focus(options){if(this._element)ew.setFocus(this._element,options)};_proto.canFocus=function canFocus(){var _el$style,_el$classList;let el=this._element;return el&&!(el.hidden&&!el.tagName=="SELECTION-LIST"||el.readonly||el.disabled||el.type=="hidden"||((_el$style=el.style)==null?void 0:_el$style.display)=="none"||(_el$classList=el.classList)!=null&&_el$classList.contains("d-none"))};_createClass(Field,[{key:"error",get:function(){return this._error}},{key:"errorMessage",get:function(){if(this._error){return Array.from(Object.values(this._error)).join("<br>")}return""}},{key:"shouldValidate",get:function(){return!this._checkbox||this._checkbox.checked}},{key:"element",get:function(){return this._element},set:function(el){var _this$_element2,_this$_element2$id;this._element=el;this._checkbox=(_this$_element2=this._element)!=null&&(_this$_element2$id=_this$_element2.id)!=null&&_this$_element2$id.match(/^[xy]_/)?document.getElementById(this._element.id.replace(/^[xy]_/,"u_")):null}},{key:"value",get:function(){return this._element?ew.getValue(this._element):""}},{key:"focused",get:function(){return this._element&&this._element==document.activeElement}}]);return Field}();let Form=function(_FormBase){_inheritsLoose(Form,_FormBase);function Form(id,pageId){var _this;_this=_FormBase.call(this,id,pageId)||this;_defineProperty(_assertThisInitialized(_this),"row",{});_defineProperty(_assertThisInitialized(_this),"fields",{});_defineProperty(_assertThisInitialized(_this),"validateRequired",true);_defineProperty(_assertThisInitialized(_this),"autoFocus",true);_defineProperty(_assertThisInitialized(_this),"autoFocusPreventScroll",true);_this.on("initiated",(function(){let form=this.getForm();if(form.classList.contains("ew-wait")){this.one("enabled",(function(){this.setInvalid();this.tryFocus()}));return}this.setInvalid();this.tryFocus()}));return _this}var _proto=Form.prototype;_proto.addField=function addField(fldvar,validators,invalid){if(!(fldvar in this.fields))this.fields[fldvar]=new Field(fldvar,validators,invalid)};_proto.getField=function getField(fldvar){return this.fields[fldvar]};_proto.addFields=function addFields(fields){if(Array.isArray(fields)){for(let field of fields){if(Array.isArray(field)){this.addField.apply(this,field)}}}};_proto.addError=function addError(fldvar,err){if(err){var _this$_error;this._error=(_this$_error=this._error)!=null?_this$_error:{};this._error[fldvar]=err}};_proto.addCustomError=function addCustomError(fldvar,msg){if(fldvar in this.fields){let field=this.fields[fldvar],err={custom:msg};field.addError(err);field.updateFeedback();this.addError(fldvar,err)}return false};_proto.getFieldElements=function getFieldElements(name,rowIndex){return this.getElements("x"+(rowIndex!=null?rowIndex:"")+"_"+name)||this.getElements("x"+(rowIndex!=null?rowIndex:"")+"_"+name+"[]")||this.getElements(name)};_proto.setFocus=function setFocus(el){let delay=this.makeVisible(el)?Form.focusDelay:0;if(el!=document.activeElement&&el.focus){let preventScroll=!el.closest(".modal-body")&&Form.autoFocusPreventScroll&&this.autoFocusPreventScroll;setTimeout((()=>{el.focus({preventScroll:preventScroll})}),delay);this._focused=true}};_proto.focus=function focus(){if(!this.canFocus())return;for(let[fldvar,field]of Object.entries(this.fields)){var _this$_error2;if(field.invalid||(_this$_error2=this._error)!=null&&_this$_error2[fldvar]){this.getFocusable(field);if(field.canFocus()){this.setFocus(field.element);break}}}};_proto.getFocusable=function getFocusable(field){var _field$element;(_field$element=field.element)!=null?_field$element:field.element=this.getFieldElements(field.name);if(!field.canFocus())field.element=this.getFieldElements(field.name,0);if(!field.canFocus())field.element=this.getFieldElements(field.name,1)};_proto.tryFocus=function tryFocus(fieldName){if(!this.canFocus())return;if(!fieldName&&(!Form.autoFocus||!this.autoFocus||this._focused))return;if(!fieldName&&this.invalid){this.focus();return}if(["add","edit"].includes(this.pageId)){let form=this.getForm(),detailpage=Array.from(form.querySelectorAll("input[name=detailpage]")).find((dp=>{var _ew$forms$get;return(_ew$forms$get=ew.forms.get(dp.value))==null?void 0:_ew$forms$get.invalid}));if(detailpage){detailpage.focus();return}}for(let[fldvar,field]of Object.entries(this.fields)){if(fieldName&&fieldName!==fldvar)continue;field.element=null;this.getFocusable(field);if(field.canFocus()){this.setFocus(field.element);return}}if(this.id.endsWith("srch")&&this.element.psearch&&this.element.psearch!=document.activeElement){this.element.psearch.focus({preventScroll:Form.autoFocusPreventScroll&&this.autoFocusPreventScroll});this._focused=true}};_proto.canFocus=function canFocus(){var _el$style,_el$classList;let el=this.element;return el&&!(el.hidden||el.type=="hidden"||((_el$style=el.style)==null?void 0:_el$style.display)=="none"||(_el$classList=el.classList)!=null&&_el$classList.contains("d-none"))};_proto.makeVisible=function makeVisible(el){if(this.multiPage){this.multiPage.gotoPageByElement(el);return true}else if(this.$element.is("div")){let $pane=this.$element.closest(".tab-pane");if($pane[0]&&!$pane.hasClass("active")){$pane.closest(".ew-nav").find("a[data-bs-toggle=tab][href='#"+$pane.attr("id")+"']").trigger("click");return true}}return false};_proto.validateFields=function validateFields(rowIndex){var _rowIndex;(_rowIndex=rowIndex)!=null?_rowIndex:rowIndex="";if(rowIndex<2)this.value=null;this.row={};this._error=null;let result=true;for(let field of Object.values(this.fields)){field.element=this.getFieldElements(field.name,rowIndex);this.row[field.name]=field.value;if(field.element&&!field.validate()){this.addError(field.name,field.error);result=false}}if(!this.value){this.value={...this.row}}else{if(!Array.isArray(this.value))this.value=[this.value];let index=parseInt(rowIndex,10)||0;index=index>1?index-1:0;this.value[index]={...this.row}}this.focus();return result};_proto.validate=function validate(){var _form$querySelector,_form$querySelector2,_form$querySelector3;if(!this.validateRequired)return true;let form=this.getForm();if(((_form$querySelector=form.querySelector("#confirm"))==null?void 0:_form$querySelector.value)=="confirm")return true;if(this.pageId=="update"&&!ew.updateSelected(form)){ew.alert({html:ew.language.phrase("NoFieldSelected"),icon:"warning"});return false}let addcnt=0,action=(_form$querySelector2=form.querySelector("#action"))==null?void 0:_form$querySelector2.value,keycnt=this.formKeyCountName?(_form$querySelector3=form.querySelector("#"+this.formKeyCountName))==null?void 0:_form$querySelector3.value:null,detailpages=form.querySelectorAll("input[name=detailpage]"),gridinsert=action=="gridinsert"||action=="insert"&&Array.from(detailpages).some((dp=>dp.value==this.id)),insert=action=="insert"&&!gridinsert,startcnt=insert?0:1,rowcnt=insert?0:parseInt(keycnt,10)||1;for(let i=startcnt;i<=rowcnt;i++){let rowIndex=keycnt?String(i):"";form.dataset.rowindex=rowIndex;if(["list","grid"].includes(this.pageId)){if(gridinsert?!this.emptyRow(rowIndex):true)addcnt++;else continue}if(!this.validateFields(rowIndex))return false;if(this.customValidate&&!this.customValidate(form)){this.focus();return false}}if(this.pageId=="list"&&gridinsert&&addcnt==0){ew.alert(ew.language.phrase("NoAddRecord"));return false}if(["add","edit"].includes(this.pageId)){detailpages.forEach((dp=>{let frm=ew.forms.get(dp.value);if(frm&&!frm.validate())return false}))}return true};_proto.getValue=function getValue(rowIndex){var _rowIndex2;rowIndex=(_rowIndex2=rowIndex)!=null?_rowIndex2:"";let value={};for(let field of Object.values(this.fields)){var _field$element2;(_field$element2=field.element)!=null?_field$element2:field.element=this.getFieldElements(field.name,rowIndex);value[field.name]=field.value}return value};_proto.setInvalid=function setInvalid(rowIndex){let form=this.getForm();if(typeof rowIndex==="undefined"&&this.formKeyCountName){let k=form.querySelector("#"+this.formKeyCountName),rowcnt=parseInt(k==null?void 0:k.value,10)||1,startcnt=rowcnt===0?0:1;for(let i=startcnt;i<=rowcnt;i++){let rowIndex=k?String(i):"";this.setInvalid(rowIndex)}}else{var _rowIndex3;rowIndex=(_rowIndex3=rowIndex)!=null?_rowIndex3:"";for(let field of Object.values(this.fields)){field.element=this.getFieldElements(field.name,rowIndex);if(rowIndex)field.resetInvalid();if(field.invalid){this.addError(field.name,field.error);if(!this._focused)this.focus()}else{continue}ew.setInvalid(field.element)}if(["add","edit"].includes(this.pageId))form.querySelectorAll("input[name=detailpage]").forEach((dp=>{var _ew$forms$get2;return(_ew$forms$get2=ew.forms.get(dp.value))==null?void 0:_ew$forms$get2.setInvalid()}))}};_createClass(Form,[{key:"error",get:function(){return this._error}},{key:"invalid",get:function(){return this._error||Object.values(this.fields).some((field=>field.invalid))}}]);return Form}(FormBase);_defineProperty(Form,"autoFocus",true);_defineProperty(Form,"autoFocusPreventScroll",true);_defineProperty(Form,"focusDelay",200);let AjaxLookup=function(){function AjaxLookup(settings){_defineProperty(this,"_isAutoSuggest",null);this.elementId=settings.id;this.form=settings.form;if($__default["default"].isString(this.form))this.form=ew.forms.get(this.form);this.element=this.form.getElement(this.elementId);this.formElement=this.form.getElement();this.list=this.form.getList(this.elementId);let m=this.elementId.match(/^[xy](\d*|\$rowindex\$)_/),rowindex=m?m[1]:"";this.parentFields=this.list.parentFields.slice().map((pf=>pf.split(" ").length==1?pf.replace(/^x_/,"x"+rowindex+"_"):pf));this.limit=settings.limit;this.debounce=settings.debounce;this.data=settings.data;this.recordCount=0;this.action=settings.action||"autosuggest"}var _proto=AjaxLookup.prototype;_proto.formatResult=function formatResult(opt){this.form.compileTemplates();if(this.list.template&&!this.isAutoSuggest){return this.list.template.render(opt,ew.jsRenderHelpers)}else{return ew.displayValue(opt,this.element)||opt[0]}};_proto.generateRequest=function generateRequest(){var _data$ajax;var data=Object.assign({},this.data,{name:this.element.name,page:this.list.page,field:this.list.field,language:ew.LANGUAGE_ID},ew.getUserParams("#p_"+this.elementId,this.formElement));(_data$ajax=data.ajax)!=null?_data$ajax:data.ajax=this.action;if(this.parentFields.length>0){this.parentFields.forEach(((pf,i)=>{let arp=ew.getOptionValues(pf,this.formElement);data["v"+(i+1)]=arp.join(ew.MULTIPLE_OPTION_SEPARATOR)}))}return data};_proto.getUrl=function getUrl(query,start){let params=new URLSearchParams({q:query||"",n:this.limit,rnd:ew.random(),start:$__default["default"].isNumber(start)?start:-1});return ew.getApiUrl(ew.API_LOOKUP_ACTION,params.toString())};_proto.prepare=function prepare(query,start){return{url:this.getUrl(query,start),type:"POST",dataType:"json",data:this.generateRequest()}};_proto.transform=function transform(data){let results=[];if((data==null?void 0:data.result)=="OK"){this.recordCount=data.totalRecordCount;results=data.records}return results};_createClass(AjaxLookup,[{key:"isAutoSuggest",get:function(){if(this._isAutoSuggest===null)this._isAutoSuggest=ew.isAutoSuggest(this.element);return this._isAutoSuggest}},{key:"options",get:function(){return this.list.lookupOptions}}]);return AjaxLookup}();let SelectionListOption=function SelectionListOption(value,text,selected){this.value=String(value);this.text=String(text);this.selected=!!selected};let AutoSuggest=function(_AjaxLookup){_inheritsLoose(AutoSuggest,_AjaxLookup);function AutoSuggest(settings){var _this;_this=_AjaxLookup.call(this,settings)||this;_this.input=_this.form.getElement("sv_"+_this.elementId);if(!_this.input||_this.elementId.includes("$rowindex$"))return _assertThisInitialized(_this);let self=_assertThisInitialized(_this),$input=$__default["default"](_this.input),$element=$__default["default"](_this.element);_this.minWidth=settings.minWidth;_this.maxHeight=settings.maxHeight;_this.highlight=settings.highlight;_this.hint=settings.hint;_this.minLength=settings.minLength;_this.templates=Object.assign({},settings.templates);_this.classNames=Object.assign({},settings.classNames);_this.delay=settings.delay;_this.debounce=settings.debounce;_this.display=settings.display||"text";_this.forceSelection=settings.forceSelect;_this.lineHeight=settings.lineHeight;_this.paddingY=settings.paddingY;_this.$input=$input;_this.$element=$element;$element.data("autosuggest",_assertThisInitialized(_this));if($input.val()&&$element.val())_this.element.add($element.val(),$input.val(),true);$input.on("typeahead:select",((e,d)=>{self.setValue(d[self.display])})).on("change",(()=>{let ta=$input.data("tt-typeahead");if(ta!=null&&ta.isOpen()&&!ta.menu.empty()){let $item=ta.menu.getActiveSelectable();if($item){let i=$item.index(),val=self.element.options[i].text;$input.typeahead("val",val)}}self.setValue()})).on("blur",(()=>{let ta=$input.data("tt-typeahead");if(ta!=null&&ta.isOpen())ta.menu.close()})).on("focus",(()=>{$input.attr("placeholder",$input.data("placeholder")).removeClass("is-invalid");$element.removeClass("is-invalid")}));let async=!_this.options.length,loadingMore=false,timer;let tpl=self.list.template||self.templates.suggestion;if(tpl&&$__default["default"].isString(tpl))tpl=$__default["default"].templates(tpl);if(tpl)self.templates.suggestion=tpl.render.bind(tpl);if(async&&!self.templates.footer)self.templates.footer='<div class="tt-footer dropdown-item">'+ew.language.phrase("LoadingMore")+"</div>";let source=(query,syncResults,asyncResults)=>{if(async){if(timer)timer.cancel();timer=$__default["default"].later(_this.debounce,null,(()=>{_this.recordCount=0;$__default["default"].ajax(_this.prepare(query)).done((data=>asyncResults(_this.transform(data))))}))}else{let records=_this.getSyncResults(query);syncResults(_this.transform({result:"OK",totalRecordCount:records.length,records:records}))}};$__default["default"]((function(){let options={highlight:self.highlight,minLength:self.minLength,hint:self.hint,classNames:self.classNames};let dataset={name:self.form.id+"-"+self.elementId,source:source,async:async,templates:self.templates,display:self.display,limit:async?self.limit:Infinity};let args=[options,dataset];$element.trigger("typeahead",[args]);self.typeahead=$input.typeahead.apply($input,args).off("blur.tt").data("tt-typeahead");let menu=self.typeahead.menu,$menu=menu.$node,$dataset=$menu.find(".tt-dataset"),suggestionHeight=()=>$menu.find(".tt-suggestion").outerHeight(false);if(self.minWidth)$menu.css("min-width",self.minWidth);$input.on("typeahead:rendered",((e,suggestions)=>{let rendered=suggestions.length,count=self.count;if(count>=self.limit){let h=suggestionHeight();if(h)$dataset.css("max-height",h*self.limit)}if(rendered>0)$dataset.scrollTop(suggestionHeight()*(count-rendered));if(async)$menu.find(".tt-footer").toggle(self.recordCount>count)}));if(async){let loadingMoreTimer;$dataset.on("scroll",(()=>{var _loadingMoreTimer;(_loadingMoreTimer=loadingMoreTimer)==null?void 0:_loadingMoreTimer.cancel();loadingMoreTimer=$__default["default"].later(self.delay,null,(()=>{let $footer=$menu.find(".tt-footer");if(!$footer.is(":hidden")&&!loadingMore){let currentOffset=$dataset.offset().top+$dataset.outerHeight(false),loadingMoreOffset=$footer.offset().top+$footer.outerHeight(false);if(currentOffset+20>loadingMoreOffset){loadingMore=true;self.getMore().always((()=>loadingMore=false))}else{var _loadingMoreTimer2;(_loadingMoreTimer2=loadingMoreTimer)==null?void 0:_loadingMoreTimer2.cancel()}}}))}))}}));return _this}var _proto=AutoSuggest.prototype;_proto.setValue=function setValue(v){v||(v=this.$input.val());let index=this.element.options.findIndex((option=>option.text==v));if(index<0){if(this.forceSelection&&v){this.$input.typeahead("val","").addClass("is-invalid");this.$element.next(".invalid-feedback").html(ew.language.phrase("ValueNotExist"));this.$element.addClass("is-invalid").val("").trigger("change");return}}else{this.element.options[index].selected=true;if(!/s(ea)?rch$/.test(this.formElement.id)||this.forceSelection)v=this.element.options[index].value}if(v!==this.$element.attr("value"))this.$element.attr("value",v).trigger("change")};_proto.transform=function transform(data){let results=_AjaxLookup.prototype.transform.call(this,data).map((item=>Object.assign({},item,{text:_AjaxLookup.prototype.formatResult.call(this,item)})));this.element.options=results.map((item=>new SelectionListOption(item.lf||item[0],item.text)));return results};_proto.getSyncResults=function getSyncResults(query){if(this.options.length){let results=this.options.filter((item=>{if(ew.LOOKUP_ALL_DISPLAY_FIELDS){let v=[item.df,item.df2,item.df3,item.df4].map((df=>String(df).toLowerCase())).join(" ");return query.toLowerCase().split(" ").filter((q=>q!=="")).every((q=>v.includes(q)))}else{return String(item.df).toLowerCase().startsWith(query)}}));this.recordCount=results.length;return results}return[]};_proto.getMore=function getMore(){let menu=this.typeahead.menu,start=this.count,settings=this.prepare(menu.query,start);return $__default["default"].ajax(settings).done((data=>menu.datasets[0]._append(menu.query,this.transform(data))))};_createClass(AutoSuggest,[{key:"count",get:function(){return this.typeahead.menu.$node.find(".tt-suggestion.tt-selectable").length||0}}]);return AutoSuggest}(AjaxLookup);let Forms=function(){function Forms(){_defineProperty(this,"_forms",{})}var _proto=Forms.prototype;_proto.get=function get(el){var _ew$getForm;if(!el)return null;let id=$__default["default"].isString(el)?el:(_ew$getForm=ew.getForm(el))==null?void 0:_ew$getForm.id;return this._forms[id]};_proto.add=function add(f){if(this._forms[f.id]&&this._forms[f.id]!==f)delete this._forms[f.id];this._forms[f.id]=f};_proto.ids=function ids(){return Object.keys(this._forms)};return Forms}();var Select2Language={errorLoading:function(){return ew.language.phrase("ErrorLoading")},inputTooLong:function(args){var overChars=args.input.length-args.maximum;return ew.language.phrase("InputTooLong").replace("%s",overChars)},inputTooShort:function(args){var remainingChars=args.minimum-args.input.length;return ew.language.phrase("InputTooShort").replace("%s",remainingChars)},loadingMore:function(){return ew.language.phrase("LoadingMore")},maximumSelected:function(args){return ew.language.phrase("MaximumSelected").replace("%s",args.maximum)},noResults:function(){return ew.language.phrase("NoResults")},searching:function(){return ew.language.phrase("Searching")},removeAllItems:function(){return ew.language.phrase("RemoveAllItems")},removeItem:function(){return ew.language.phrase("RemoveItem")},search:function(){return ew.language.phrase("Search")}};let _defined$3=$__default["default"].fn.select2.amd.require._defined,Utils$3=_defined$3["select2/utils"];let Select2ResultsDecorator=function(){function Select2ResultsDecorator(){}var _proto=Select2ResultsDecorator.prototype;_proto.render=function render(decorated){var $results=$__default["default"]('<div class="select2-results__options '+this.options.get("containerClass")+'" role="listbox"></div>');if(this.options.get("multiple")){$results.attr("aria-multiselectable","true")}this.$results=$results;return $results};_proto.displayMessage=function displayMessage(decorated,params){var escapeMarkup=this.options.get("escapeMarkup");this.clear();this.hideLoading();var $message=$__default["default"]('<div role="alert" aria-live="assertive"'+' class="select2-results__option"></div>');if(params.message.includes("<")&&params.message.includes(">")){$message.append(params.message)}else{var message=this.options.get("translations").get(params.message);$message.append(escapeMarkup(message(params.args)))}$message[0].className+=" select2-results__message";this.$results.append($message)};_proto.append=function append(decorated,data){this.hideLoading();if(data.results==null||data.results.length===0){if(this.$results.children().length===0){if(this.$element.data("updating")&&data.pagination.more){this.trigger("results:message",{message:'<div class="spinner-border spinner-border-sm text-primary ew-select-spinner" role="status"><span class="visually-hidden">'+ew.language.phrase("Loading")+"</span></div> "+ew.language.phrase("Loading")});this.$element.one("updated",(()=>this.$element.select2("close").select2("open")))}else{this.trigger("results:message",{message:"noResults"})}}return}data.results=this.sort(data.results);var cols=this.options.get("columns"),len=data.results.length,$row=this.$results.find("."+this.options.get("rowClass")).last();for(var d=0;d<data.results.length;d++){var item=data.results[d];var $option=this.option(item);if(!$row.length||$row.children().length==cols){$row=$__default["default"]('<div class="'+this.options.get("rowClass")+'"></div>');this.$results.append($row)}$row.append($option);if(d==len-1){var cnt=cols-$row.children().length;for(var i=0;i<cnt;i++)$row.append('<div class="'+this.options.get("cellClass")+'"></div>')}}};_proto.option=function option(decorated,data){var option=document.createElement("div");option.classList.add("select2-results__option");option.classList.add("select2-results__option--selectable");this.options.get("cellClass").split(" ").forEach((c=>option.classList.add(c)));var attrs={role:"option","aria-selected":"false"};var matches=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;if(data.element!=null&&matches.call(data.element,":disabled")||data.element==null&&data.disabled){attrs["aria-disabled"]="true";option.classList.remove("select2-results__option--selectable");option.classList.add("select2-results__option--disabled")}if(data.id==null){option.classList.remove("select2-results__option--selectable")}if(data._resultId!=null){option.id=data._resultId}if(data.title){option.title=data.title}for(var attr in attrs){var val=attrs[attr];option.setAttribute(attr,val)}this.template(data,option);Utils$3.StoreData(option,"data",data);return option};return Select2ResultsDecorator}();let _defined$2=$__default["default"].fn.select2.amd.require._defined,Utils$2=_defined$2["select2/utils"];let ModalResults=function(){function ModalResults(){}var _proto=ModalResults.prototype;_proto.bind=function bind(decorated,container,$container){var _container$listeners$;var self=this;decorated.call(this,container,$container);(_container$listeners$=container.listeners["results:select"])==null?void 0:_container$listeners$.pop();this.$results.off("mouseup");container.on("results:select",(function(evt){var $highlighted=self.getHighlightedResults();if($highlighted.length===0){return}var data=Utils$2.GetData($highlighted[0],"data");if($highlighted.hasClass("select2-results__option--selected")){self.trigger("unselect",{originalEvent:evt,data:data})}else{self.trigger("select",{originalEvent:evt,data:data})}}));this.$results.on("mousedown",".select2-results__option--selectable",(function(evt){this._mousedown=true}));this.$results.on("mouseup",".select2-results__option--selectable",(function(evt){if(!this._mousedown)return;var $this=$__default["default"](this);var data=Utils$2.GetData(this,"data");if($this.hasClass("select2-results__option--selected")){self.trigger("unselect",{originalEvent:evt,data:data});return}self.trigger("select",{originalEvent:evt,data:data})}))};return ModalResults}();let ModalSearch=function(){function ModalSearch(){}var _proto=ModalSearch.prototype;_proto.bind=function bind(decorated,container,$container){var _container$listeners$;var self=this;decorated.call(this,container,$container);(_container$listeners$=container.listeners["close"])==null?void 0:_container$listeners$.pop();container.on("close",(function(){self.$search.attr("tabindex",-1).removeAttr("aria-controls").removeAttr("aria-activedescendant")}))};return ModalSearch}();let KEYS=$.fn.select2.amd.require._defined["select2/keys"];KEYS.PRINT_SCREEN=44;let DropdownSearchDecorator=function(){function DropdownSearchDecorator(){}var _proto=DropdownSearchDecorator.prototype;_proto.handleSearch=function handleSearch(decorated,evt){var key=evt.which;if([KEYS.TAB,KEYS.SHIFT,KEYS.CTRL,KEYS.ALT,KEYS.PRINT_SCREEN].includes(key)){return}if(!this._keyUpPrevented){var input=this.$search.val();this.trigger("query",{term:input})}this._keyUpPrevented=false};return DropdownSearchDecorator}();let AttachBody$2=$__default["default"].fn.select2.amd.require._defined["select2/dropdown/attachBody"];let Select2AttachBody=function(_AttachBody){_inheritsLoose(Select2AttachBody,_AttachBody);function Select2AttachBody(decorated,$element,options){return _AttachBody.call(this,decorated,$element,options)||this}var _proto=Select2AttachBody.prototype;_proto._attachPositioningHandler=function _attachPositioningHandler(decorated,container){var self=this;var events=["scroll.select2."+container.id,"resize.select2."+container.id,"orientationchange.select2."+container.id];var handler=()=>{self._positionDropdown();self._resizeDropdown()};$__default["default"](window).on(events.join(" "),handler);container.$element.closest(".modal").on("scroll.select2."+container.id,handler)};_proto._detachPositioningHandler=function _detachPositioningHandler(decorated,container){var events=["scroll.select2."+container.id,"resize.select2."+container.id,"orientationchange.select2."+container.id];$__default["default"](window).off(events.join(" "));container.$element.closest(".modal").off("scroll.select2."+container.id)};_proto._showDropdown=function _showDropdown(decorated){var _this$_popper;this.$dropdownContainer.appendTo(this.$dropdownParent);(_this$_popper=this._popper)!=null?_this$_popper:this._popper=Popper.createPopper(this.$container[0],this.$dropdownContainer[0],{placement:ew.IS_RTL?"bottom-end":"bottom-start",modifiers:[{name:"flip",enabled:true},{name:"preventOverflow",enabled:true}]});this._positionDropdown();this._resizeDropdown()};_proto._positionDropdown=function _positionDropdown(){var _this$_popper2;(_this$_popper2=this._popper)==null?void 0:_this$_popper2.update()};_proto.destroy=function destroy(decorated){var _this$_popper3;_AttachBody.prototype.destroy.call(this,decorated);(_this$_popper3=this._popper)==null?void 0:_this$_popper3.destroy();this._popper=null};return Select2AttachBody}(AttachBody$2);let ModalAttachBody=function(){function ModalAttachBody(decorated,$element,options){_defineProperty(this,"$modal",null);options.set("dropdownParent",$__default["default"](document.body));decorated.call(this,$element,options)}var _proto=ModalAttachBody.prototype;_proto.bind=function bind(decorated,container,$container){let self=this;decorated.call(this,container,$container);container.on("open",(function(){self._showDropdown();self._bindContainerResultHandlers(container)}));this.$dropdownContainer.on("mousedown",(function(evt){evt.stopPropagation()}))};_proto.position=function position(decorated,$dropdown,$container){$dropdown.attr("class",$container.attr("class"));$dropdown.removeClass("select2");this.$container=$container};_proto.render=function render(decorated){let $container=$__default["default"]("<span></span>");let $dropdown=decorated.call(this);$container.append($dropdown);this.$dropdownContainer=$container;return $container};_proto._bindContainerResultHandlers=function _bindContainerResultHandlers(decorated,container){if(this._containerResultsHandlersBound){return}let self=this;container.$modal=this.$modal;container.on("results:all",(function(){var _self$$search$;self._updateDropdown();(_self$$search$=self.$search[0])==null?void 0:_self$$search$.focus()}));container.on("results:append",(function(){self._updateDropdown()}));container.on("results:message",(function(){self._updateDropdown()}));container.on("select",(function(e){var _e$originalEvent;let target=(_e$originalEvent=e.originalEvent)==null?void 0:_e$originalEvent.currentTarget;target==null?void 0:target.classList.add("select2-results__option--selected");self._updateDropdown()}));container.on("unselect",(function(e){var _e$originalEvent2;let target=(_e$originalEvent2=e.originalEvent)==null?void 0:_e$originalEvent2.currentTarget;target==null?void 0:target.classList.remove("select2-results__option--selected");self._updateDropdown()}));this._containerResultsHandlersBound=true};_proto._updateDropdown=function _updateDropdown(){if(!this.$modal.find(this.$dropdownContainer)[0])this.$modal.find(".modal-body").children().detach().end().append(this.$dropdownContainer)};_proto._showDropdown=function _showDropdown(decorated){var _this$$modal;let self=this,oldValue=this.$element.val();this.$dropdownContainer.appendTo(this.options.get("dropdownParent"));(_this$$modal=this.$modal)!=null?_this$$modal:this.$modal=$__default["default"]("#ew-modal-lookup-dialog");this._updateDropdown();this.$modal.find(".modal-title").empty().append(ew.language.phrase("LookupTitle").replace("%s",this.$element.data("caption")));this.$modal.find(".modal-footer button[data-value]").off().on("click",(function(){if(!$__default["default"](this).data("value"))self.$element.val(oldValue).trigger("change")}));this.$modal.modal("show").on("hidden.bs.modal",(function(event){self.$container.removeClass("select2-container--open")})).draggable(this.options.get("draggableOptions"))};return ModalAttachBody}();let AttachBody$1=$__default["default"].fn.select2.amd.require._defined["select2/dropdown/attachBody"];let FilterAttachBody=function(_AttachBody){_inheritsLoose(FilterAttachBody,_AttachBody);function FilterAttachBody(decorated,$element,options){return _AttachBody.call(this,decorated,$element,options)||this}var _proto=FilterAttachBody.prototype;_proto.bind=function bind(decorated,container,$container){var self=this;decorated.call(this,container,$container);container.on("open",(function(){self._showDropdown();self._bindContainerResultHandlers(container)}));container.on("close",(function(){self._hideDropdown()}));this.$dropdownContainer.on("mousedown",(function(evt){evt.stopPropagation()}))};_proto._positionDropdown=function _positionDropdown(){var _this$_popper;(_this$_popper=this._popper)==null?void 0:_this$_popper.update()};_proto._resizeDropdown=function _resizeDropdown(){var css={width:this.$container.outerWidth(false)+"px"};if(this.options.get("dropdownAutoWidth")){css.minWidth=css.width;css.position="relative";css.width="auto"}this.$dropdown.css(css)};_proto._showDropdown=function _showDropdown(decorated){var _dropdownButton$close,_this$_popper2;this.$dropdownContainer.appendTo(this.$dropdownParent);let self=this,oldValue=this.$element.val(),$footer=$__default["default"]("#ew-filter-dropdown-footer").contents().clone();$footer.find(".ew-filter-btn[data-value]").off().on("click",(function(e){let value=$__default["default"](this).data("value");if(value){ew.forms.get(self.$element[0].form).submit()}else{self.$element.val(oldValue).trigger("change")}self.$element.select2("close")}));$footer.find(".ew-filter-clear").off().on("click",(e=>self.$element.data("select2").selection._handleClear(e)));let $filterDropdown=this.$dropdownContainer.find(".ew-filter-dropdown");if(!$filterDropdown.find(".ew-filter-btn")[0])$filterDropdown.append($footer);var dropdownButton=document.querySelector(".ew-filter-dropdown-btn[data-table="+this.$element.data("table")+"][data-field="+this.$element.data("field")+"]"),reference=(_dropdownButton$close=dropdownButton.closest(".ew-table-header-cell"))!=null?_dropdownButton$close:dropdownButton.closest(".ew-table-header-btn");(_this$_popper2=this._popper)!=null?_this$_popper2:this._popper=Popper.createPopper(reference,this.$dropdownContainer[0],{placement:ew.IS_RTL?"bottom-end":"bottom-start",modifiers:[{name:"flip",enabled:true},{name:"preventOverflow",enabled:true}]});this._positionDropdown();this._resizeDropdown()};_proto.position=function position(decorated,$dropdown,$container){$dropdown.attr("class",$container.attr("class"));$dropdown[0].classList.remove("select2");$dropdown[0].classList.add("select2-container--open");this.$container=$container};_proto.destroy=function destroy(decorated){var _this$_popper3;_AttachBody.prototype.destroy.call(this,decorated);(_this$_popper3=this._popper)==null?void 0:_this$_popper3.destroy();this._popper=null};return FilterAttachBody}(AttachBody$1);let AttachBody=$__default["default"].fn.select2.amd.require._defined["select2/dropdown/attachBody"];let DropdownAttachBody=function(_AttachBody){_inheritsLoose(DropdownAttachBody,_AttachBody);function DropdownAttachBody(decorated,$element,options){return _AttachBody.call(this,decorated,$element,options)||this}var _proto=DropdownAttachBody.prototype;_proto.bind=function bind(decorated,container,$container){var self=this;decorated.call(this,container,$container);container.on("open",(function(){self._showDropdown();self._bindContainerResultHandlers(container)}));container.on("close",(function(){self._hideDropdown()}));this.$dropdownContainer.on("mousedown",(function(evt){evt.stopPropagation()}))};_proto._showDropdown=function _showDropdown(decorated){var _this$_popper;this.$dropdownContainer.appendTo(this.$dropdownParent);(_this$_popper=this._popper)!=null?_this$_popper:this._popper=Popper.createPopper(this.$element.parent().find(".select2-container")[0],this.$dropdownContainer[0],{placement:ew.IS_RTL?"bottom-end":"bottom-start",modifiers:[{name:"flip",enabled:true},{name:"preventOverflow",enabled:true}]});this._positionDropdown();this._resizeDropdown()};_proto._positionDropdown=function _positionDropdown(){var _this$_popper2;(_this$_popper2=this._popper)==null?void 0:_this$_popper2.update()};_proto.position=function position(decorated,$dropdown,$container){$dropdown.attr("class",$container.attr("class"));$dropdown[0].classList.remove("select2");$dropdown[0].classList.add("select2-container--open");this.$container=$container};_proto.destroy=function destroy(decorated){var _this$_popper3;_AttachBody.prototype.destroy.call(this,decorated);(_this$_popper3=this._popper)==null?void 0:_this$_popper3.destroy();this._popper=null};return DropdownAttachBody}(AttachBody);let _defined$1=$__default["default"].fn.select2.amd.require._defined,AllowClear$1=_defined$1["select2/selection/allowClear"],Utils$1=_defined$1["select2/utils"];let FilterAllowClear=function(_AllowClear){_inheritsLoose(FilterAllowClear,_AllowClear);function FilterAllowClear(){return _AllowClear.apply(this,arguments)||this}var _proto=FilterAllowClear.prototype;_proto._handleClear=function _handleClear(_,evt){if(this.isDisabled()){return}var $clear=this.$selection.find(".select2-selection__clear");if($clear.length===0){return}evt.stopPropagation();var data=Utils$1.GetData($clear[0],"data");var previousVal=this.$element.val();this.$element.val(this.placeholder.id);var unselectData={data:data};this.trigger("clear",unselectData);if(unselectData.prevented){this.$element.val(previousVal);return}for(var d=0;d<data.length;d++){unselectData={data:data[d]};this.trigger("unselect",unselectData);if(unselectData.prevented){this.$element.val(previousVal);return}}this.$element.trigger("input").trigger("change")};return FilterAllowClear}(AllowClear$1);let Select2MultipleSelectionDecorator=function(){function Select2MultipleSelectionDecorator(){}var _proto=Select2MultipleSelectionDecorator.prototype;_proto.bind=function bind(decorated,container,$container){decorated.call(this,container,$container);this.$selection.on("click",".select2-selection__choice__remove",(function(evt){evt.stopPropagation()}))};return Select2MultipleSelectionDecorator}();let Select2DataAdapterDecorator=function(){function Select2DataAdapterDecorator(){}var _proto=Select2DataAdapterDecorator.prototype;_proto.option=function option(decorated,data){var _data$element;var text=data.text,html=(_data$element=data.element)==null?void 0:_data$element.innerHTML,$option=decorated.call(this,data);if(text.startsWith("<")&&text.endsWith(">"))$option.html(text);else if(html&&html!=text)$option.html(html);return $option};return Select2DataAdapterDecorator}();let _defined=$.fn.select2.amd.require._defined,ResultsList=_defined["select2/results"],SingleSelection=_defined["select2/selection/single"],MultipleSelection=_defined["select2/selection/multiple"],Placeholder=_defined["select2/selection/placeholder"],AllowClear=_defined["select2/selection/allowClear"],SelectionSearch=_defined["select2/selection/search"],EventRelay=_defined["select2/selection/eventRelay"],Utils=_defined["select2/utils"],Translation=_defined["select2/translation"],SelectData=_defined["select2/data/select"],ArrayData=_defined["select2/data/array"],AjaxData=_defined["select2/data/ajax"],Tags=_defined["select2/data/tags"],Tokenizer=_defined["select2/data/tokenizer"],MinimumInputLength=_defined["select2/data/minimumInputLength"],MaximumInputLength=_defined["select2/data/maximumInputLength"],MaximumSelectionLength=_defined["select2/data/maximumSelectionLength"],Dropdown=_defined["select2/dropdown"],DropdownSearch=_defined["select2/dropdown/search"],HidePlaceholder=_defined["select2/dropdown/hidePlaceholder"],InfiniteScroll=_defined["select2/dropdown/infiniteScroll"],MinimumResultsForSearch=_defined["select2/dropdown/minimumResultsForSearch"],SelectOnClose=_defined["select2/dropdown/selectOnClose"],CloseOnSelect=_defined["select2/dropdown/closeOnSelect"],DropdownCSS=_defined["select2/dropdown/dropdownCss"],TagsSearchHighlight=_defined["select2/dropdown/tagsSearchHighlight"],Defaults=_defined["select2/defaults"];Defaults.apply=function(options){options=$.extend(true,{},this.defaults,options);if(options.dataAdapter==null){if(options.ajax!=null){options.dataAdapter=AjaxData}else if(options.data!=null){options.dataAdapter=ArrayData}else{options.dataAdapter=SelectData}options.dataAdapter=Utils.Decorate(options.dataAdapter,Select2DataAdapterDecorator);if(options.minimumInputLength>0){options.dataAdapter=Utils.Decorate(options.dataAdapter,MinimumInputLength)}if(options.maximumInputLength>0){options.dataAdapter=Utils.Decorate(options.dataAdapter,MaximumInputLength)}if(options.maximumSelectionLength>0){options.dataAdapter=Utils.Decorate(options.dataAdapter,MaximumSelectionLength)}if(options.tags){options.dataAdapter=Utils.Decorate(options.dataAdapter,Tags)}if(options.tokenSeparators!=null||options.tokenizer!=null){options.dataAdapter=Utils.Decorate(options.dataAdapter,Tokenizer)}}if(options.resultsAdapter==null){options.resultsAdapter=ResultsList;if(options.columns>0&&options.customOption){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,Select2ResultsDecorator);if(options.iconClass&&options.multiple&&options.templateResult==ew.selectOptions.templateResult){options._templateResult=options.templateResult;options.templateResult=result=>result.loading?result.text:'<div class="form-check-input ew-dropdown-check-input"></div><label class="'+options.iconClass+' ew-dropdown-check-label">'+options._templateResult(result)+"</label>"}}else if(options.modal||options.filter){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,ModalResults)}if(options.ajax!=null){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,InfiniteScroll)}if(options.placeholder!=null){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,HidePlaceholder)}if(options.selectOnClose){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,SelectOnClose)}if(options.tags){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,TagsSearchHighlight)}}if(options.dropdownAdapter==null){if(options.modal||options.filter){options.dropdownAdapter=Utils.Decorate(Dropdown,DropdownSearch);options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,DropdownSearchDecorator);options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,ModalSearch)}else{options.dropdownAdapter=Dropdown;if(!options.multiple){options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,DropdownSearch);options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,DropdownSearchDecorator)}}if(options.minimumResultsForSearch!==0){options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,MinimumResultsForSearch)}if(options.closeOnSelect){options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,CloseOnSelect)}if(options.dropdownCssClass!=null){options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,DropdownCSS)}options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,options.modal?ModalAttachBody:options.filter?FilterAttachBody:options.dropdown?DropdownAttachBody:Select2AttachBody)}if(options.selectionAdapter==null){if(options.multiple){options.selectionAdapter=MultipleSelection;options.selectionAdapter=Utils.Decorate(options.selectionAdapter,Select2MultipleSelectionDecorator)}else{options.selectionAdapter=SingleSelection}if(options.placeholder!=null){options.selectionAdapter=Utils.Decorate(options.selectionAdapter,Placeholder)}if(options.allowClear){options.selectionAdapter=Utils.Decorate(options.selectionAdapter,options.filter?FilterAllowClear:AllowClear)}if(options.multiple){options.selectionAdapter=Utils.Decorate(options.selectionAdapter,SelectionSearch)}options.selectionAdapter=Utils.Decorate(options.selectionAdapter,EventRelay)}options.translations=new Translation(Select2Language);options.dir=ew.IS_RTL?"rtl":"ltr";return options};let currentUrl=new URL(window.location);let forms=new Forms;let $document$1=$__default["default"](document),$body=$__default["default"]("body");let fieldContainerSelector=".row, [id^=el_], [class^=el_]";Pace.on("done",(()=>{var _forms$get;let form=document.querySelector(".modal.show form.ew-form")||document.querySelector("form.ew-form");if(form)(_forms$get=forms.get(form.id))==null?void 0:_forms$get.tryFocus()}));function createSelect(options){if(options.selectId.includes("$rowindex$"))return;if($__default["default"].isObject(options.data)){let lookup=new ew.AjaxLookup(options.data);options.data=lookup.options.map((item=>({id:item.lf,text:lookup.formatResult({lf:item.lf,df:item.df,df2:item.df2,df3:item.df3,df4:item.df4})})))}if($__default["default"].isObject(options.ajax)){let limit=options.ajax.limit,lookup=new ew.AjaxLookup({...options.ajax,...{action:"modal"}});options.ajax={url:params=>{let start=params.page?(params.page-1)*limit:-1;return lookup.getUrl(params.term,start)},type:"POST",dataType:"json",data:lookup.generateRequest.bind(lookup),delay:options.debounce,processResults:function(data){var _data$records$length,_data$records;let self=this;return{results:lookup.transform(data).map((item=>({id:item.lf,text:lookup.formatResult({lf:item.lf,df:item.df,df2:item.df2,df3:item.df3,df4:item.df4})}))),pagination:{more:self.container.$results.find(".select2-results__option:not(.select2-results__option--load-more)").length+((_data$records$length=(_data$records=data.records)==null?void 0:_data$records.length)!=null?_data$records$length:0)<lookup.recordCount}}}}}let args={name:options.name,options:options};$document$1.trigger("select2",[args]);let $select=$__default["default"]("select[data-select2-id='"+options.selectId+"']").select2(args.options);$select.on("select2:open",(function(){var _$$data$$dropdown$fin;(_$$data$$dropdown$fin=$__default["default"](this).data("select2").$dropdown.find(".select2-search__field")[0])==null?void 0:_$$data$$dropdown$fin.focus()}));if($__default["default"].isObject(options.ajax)){$select.on("select2:opening",(function(){$__default["default"](this).data("select2").$results.find(".select2-results__option:not(.loading-results)").remove()}))}if(options.minimumResultsForSearch===Infinity){$select.on("select2:opening select2:closing",(function(){$__default["default"](this).data("select2").$dropdown.find(".select2-search--dropdown").addClass("select2-search--hide")}))}}function createModalLookup(options){if(options.selectId.includes("$rowindex$"))return;if($__default["default"].isObject(options.data)){let lookup=new ew.AjaxLookup(options.data);options.data=lookup.options.map((item=>({id:item.lf,text:lookup.formatResult({lf:item.lf,df:item.df,df2:item.df2,df3:item.df3,df4:item.df4})})))}if($__default["default"].isObject(options.ajax)){let limit=options.ajax.limit,lookup=new ew.AjaxLookup({...options.ajax,...{action:"modal"}});options.ajax={url:params=>{let start=params.page?(params.page-1)*limit:-1;return lookup.getUrl(params.term,start)},type:"POST",dataType:"json",data:lookup.generateRequest.bind(lookup),delay:options.debounce,processResults:function(data){var _data$records$length2,_data$records2;let self=this;return{results:lookup.transform(data).map((item=>({id:item.lf,text:lookup.formatResult({lf:item.lf,df:item.df,df2:item.df2,df3:item.df3,df4:item.df4})}))),pagination:{more:self.container.$results.find(".select2-results__option:not(.select2-results__option--load-more)").length+((_data$records$length2=(_data$records2=data.records)==null?void 0:_data$records2.length)!=null?_data$records$length2:0)<lookup.recordCount}}}}}let $select=$__default["default"]("select[data-select2-id='"+options.selectId+"']").select2(options);$select.on("select2:open",(function(){var _$$data$$dropdown$fin2;(_$$data$$dropdown$fin2=$__default["default"](this).data("select2").$dropdown.find(".select2-search__field").addClass("form-control")[0])==null?void 0:_$$data$$dropdown$fin2.focus()}));if($__default["default"].isObject(options.ajax)){$select.on("select2:opening",(function(){$__default["default"](this).data("select2").$results.find(".select2-results__option:not(.loading-results)").remove()}))}}function createFilter(options){if(options.selectId.includes("$rowindex$"))return;if($__default["default"].isObject(options.data)){let lookup=new ew.AjaxLookup(options.data);options.data=lookup.options.map((item=>({id:item.lf,text:lookup.formatResult({lf:item.lf,df:item.df,df2:item.df2,df3:item.df3,df4:item.df4})})))}if($__default["default"].isObject(options.ajax)){let limit=options.ajax.limit,lookup=new ew.AjaxLookup({...options.ajax,...{action:"modal"}});options.ajax={url:params=>{let start=params.page?(params.page-1)*limit:-1;return lookup.getUrl(params.term,start)},type:"POST",dataType:"json",data:lookup.generateRequest.bind(lookup),delay:options.debounce,processResults:function(data){var _data$records$length3,_data$records3;let self=this;return{results:lookup.transform(data).map((item=>({id:item.lf,text:lookup.formatResult({lf:item.lf,df:item.df,df2:item.df2,df3:item.df3,df4:item.df4})}))),pagination:{more:self.container.$results.find(".select2-results__option:not(.select2-results__option--load-more)").length+((_data$records$length3=(_data$records3=data.records)==null?void 0:_data$records3.length)!=null?_data$records$length3:0)<lookup.recordCount}}}}}let $select=$__default["default"]("select[data-select2-id='"+options.selectId+"']").select2(options);$select.on("select2:open",(function(){var _$$data$$dropdown$fin3;(_$$data$$dropdown$fin3=$__default["default"](this).data("select2").$dropdown.find(".select2-search__field").addClass("form-control")[0])==null?void 0:_$$data$$dropdown$fin3.focus({preventScroll:options.preventScroll})}));if($__default["default"].isObject(options.ajax)){$select.on("select2:opening",(function(){$__default["default"](this).data("select2").$results.find(".select2-results__option:not(.loading-results)").remove()}))}}function initIcons(e){var _e$target;let el=(_e$target=e==null?void 0:e.target)!=null?_e$target:document,tooltipOptions={container:"body",trigger:ew.IS_MOBILE?"manual":"hover",placement:"bottom",sanitizeFn:ew.sanitizeFn};$__default["default"](el).find(".ew-icon").closest(".btn").each((function(){let $this=$__default["default"](this);if($this.hasClass("dropdown-toggle")){let $p=$this.closest(".btn-group");if($p.children(".btn").length==1){$p.tooltip({title:this.title,...tooltipOptions}).on("mouseleave",(e=>{var _bootstrap$Tooltip$ge;return(_bootstrap$Tooltip$ge=bootstrap.Tooltip.getInstance(e.currentTarget))==null?void 0:_bootstrap$Tooltip$ge.hide()}));$this.next(".dropdown-menu").on("mouseover",(e=>e.stopPropagation()))}}else{$this.tooltip(tooltipOptions)}}))}function initPasswordOptions(e){var _e$target2;var el=(_e$target2=e==null?void 0:e.target)!=null?_e$target2:document;if($__default["default"].fn.pStrength&&typeof ew.MIN_PASSWORD_STRENGTH!="undefined"){$__default["default"](el).find(".ew-password-strength").each((function(){var $this=$__default["default"](this);if(!$this.data("pStrength"))$this.pStrength({changeBackground:false,backgrounds:[],passwordValidFrom:ew.MIN_PASSWORD_STRENGTH,onPasswordStrengthChanged:function(strength,percentage){var $pst=$__default["default"]("[id='"+this.attr("data-password-strength")+"']"),$pb=$pst.find(".progress-bar");if(this.val()&&!ew.isMaskedPassword(this)){var pct=percentage+"%",min=ew.MIN_PASSWORD_STRENGTH,valid=percentage>=min;if(percentage<min*.25){$pb.addClass("bg-danger").removeClass("bg-warning bg-info bg-success")}else if(percentage<min*.5){$pb.addClass("bg-warning").removeClass("bg-danger bg-info bg-success")}else if(percentage<min*.75){$pb.addClass("bg-primary").removeClass("bg-danger bg-warning bg-success")}else{$pb.addClass("bg-success").removeClass("bg-danger bg-warning bg-info")}$pb.css("width",pct);if(percentage>min*.5)pct=ew.language.phrase("PasswordStrength").replace("%p",pct);$pb.html(pct);$pst.removeClass("d-none");this.data("validated",valid);if(valid)setValid(this[0])}else{$pst.addClass("d-none");this.data("validated",null)}$pst.width(this.outerWidth())}})}))}if($__default["default"].fn.pGenerator){$__default["default"](el).find(".ew-password-generator").each((function(){var $this=$__default["default"](this);if(!$this.data("pGenerator"))$this.pGenerator({passwordLength:ew.GENERATE_PASSWORD_LENGTH,uppercase:ew.GENERATE_PASSWORD_UPPERCASE,lowercase:ew.GENERATE_PASSWORD_LOWERCASE,numbers:ew.GENERATE_PASSWORD_NUMBER,specialChars:ew.GENERATE_PASSWORD_SPECIALCHARS,onPasswordGenerated:function(pwd){$__default["default"]("#"+this.attr("data-password-confirm")).val(pwd);$__default["default"]("#"+this.attr("data-password-field")).val(pwd).trigger("change").trigger("focus").triggerHandler("click")}})}))}}function getApiUrl(action,query){var url=ew.PATH_BASE+ew.API_URL,params=new URLSearchParams(query),qs=params.toString();if($__default["default"].isString(action)){url+=action?action:""}else if(Array.isArray(action)){var route=action.map((function(v){return encodeURIComponent(v)})).join("/");url+=route?route:""}return url+(qs?"?"+qs:"")}function sanitizeUrl(url){var ar=url.split("?"),search=ar[1];if(search){var searchParams=new URLSearchParams(search);searchParams.forEach(((value,key)=>{value=decodeURIComponent(value);if(["<>","<=",">=",">","<"].includes(value))searchParams.set(key,value);else searchParams.set(key,ew.sanitize(value))}));search=searchParams.toString()}return ar[0]+(search?"?"+search:"")}function setSessionTimer(){if(typeof ew.IS_LOGGEDIN=="undefined"||!ew.IS_LOGGEDIN)return;var keepAliveTimer,timeoutTime,timeoutTime4,timer1,timer2,timer3,timer4,timer5,counter,counter2,$dlg=$__default["default"]("div.ew-footer-text"),useKeepAlive=(ew.SESSION_KEEP_ALIVE_INTERVAL>0||ew.IS_LOGGEDIN&&ew.IS_AUTOLOGIN)&&ew.TIMEOUT_URL;var keepAlive=function keepAlive(){$__default["default"].get(getApiUrl(ew.API_SESSION_ACTION),{rnd:random()},(function(token){if(token&&$__default["default"].isObject(token)){ew.TOKEN_NAME=token[ew.TOKEN_NAME_KEY];ew.ANTIFORGERY_TOKEN=token[ew.ANTIFORGERY_TOKEN_KEY];if(token["JWT"])ew.API_JWT_TOKEN=token["JWT"];if(ew.SESSION_TIMEOUT>0)setTimer()}}))};var timeout4=function(){if(timer4)timer4.cancel();timer5=$__default["default"].later(1e3,null,(function(){var message='<span class="text-danger">'+ew.language.phrase("SessionCountDown")+"</span>";if(counter2>0){if(counter2<=ew.SESSION_TIMEOUT_COUNTDOWN||timeoutTime<=0){$dlg.find(".msTimer").html("");counter2=0}else{var sMinutes="";var sSeconds="";var minutes=Math.floor(counter2/60);var seconds=counter2%60;if(minutes.toString().length==1)sMinutes="0"+minutes;else sMinutes=minutes;if(seconds.toString().length==1)sSeconds="0"+seconds;else sSeconds=seconds;if(message.includes("%m")&&message.includes("%s")){message=message.replace("%m",'<span class="ew-session-counter-minute">'+sMinutes+"</span>");message=message.replace("%s",'<span class="ew-session-counter-second">'+sSeconds+"</span>")}else if(message.includes("%s")){message=message.replace("%s",'<span class="ew-session-counter-second">'+sSeconds+"</span>")}$dlg.find(".msTimer").html(message)}}else{$dlg.find(".msTimer").html("");$__default["default"].later(1e3,null,(function(){}))}counter2--}),null,true)};var resetTimer4=function(){if(timeoutTime4<0){timeoutTime4=0;counter2=0;timer5.cancel()}if(timer4)timer4.cancel()};var resetTimer=function(){counter=ew.SESSION_TIMEOUT_COUNTDOWN;counter2=ew.SESSION_TIMEOUT;timeoutTime4=ew.SESSION_TIMEOUT;timeoutTime=ew.SESSION_TIMEOUT-ew.SESSION_TIMEOUT_COUNTDOWN;if(timeoutTime<0){timeoutTime=0;counter=ew.SESSION_TIMEOUT}if(timer4)timer4.cancel();if(timer2)timer2.cancel();if(timer1)timer1.cancel()};var timeout=function(){var sMessage="";if(keepAliveTimer)keepAliveTimer.cancel();if(timer3)timer3.cancel();timer2=$__default["default"].later(1e3,null,(function(){if(counter>0){let timerInterval;var sMinutes="";var sSeconds="";var message='<span class="text-danger">'+ew.language.phrase("SessionWillExpire")+"</span>";var minutes=Math.floor(counter/60);var seconds=counter%60;if(minutes.toString().length==1)sMinutes="0"+minutes.toString();else sMinutes=minutes.toString();if(seconds.toString().length==1)sSeconds="0"+seconds.toString();else sSeconds=seconds.toString();if(message.includes("%m")&&message.includes("%s")){message=message.replace("%m",'<span class="ew-session-counter-minute">'+sMinutes+"</span>");message=message.replace("%s",'<span class="ew-session-counter-second">'+sSeconds+"</span>")}else if(message.includes("%s")){message=message.replace("%s",'<span class="ew-session-counter-second">'+counter+"</span>")}sMessage='<span class="text-danger">'+message+"</span>";document.title=message.replace(/<[^>]*>?/gm,"");Swal.fire({...ew.sweetAlertSettings,html:sMessage,icon:"warning",showConfirmButton:true,confirmButtonText:ew.language.phrase("OKBtn"),timer:counter*1e3,timerProgressBar:false,allowOutsideClick:false,allowEscapeKey:false,willOpen:()=>{timerInterval=setInterval((()=>{}),1e3)},willClose:()=>{clearInterval(timerInterval)}}).then((result=>{if(result.value){if(timer2)timer2.cancel();keepAlive();document.title=document_title}else if(result.dismiss===Swal.DismissReason.timer){resetTimer();window.location=sanitizeUrl(ew.TIMEOUT_URL+"?expired=1")}}))}else{var sMessage="";var message="";message=ew.language.phrase("SessionExpired");sMessage='<span class="text-danger">'+message+"</span>";Swal.fire({html:sMessage,icon:"success"});$dlg.find(".msTimer").html(ew.language.phrase("SessionExpired"));resetTimer();timer4.cancel();timer5.cancel();$__default["default"].later(1e3,null,(function(){window.location=sanitizeUrl(ew.TIMEOUT_URL+"?expired=1")}))}counter--}),null,true)};var setTimer=function(){resetTimer();timer1=$__default["default"].later(timeoutTime*1e3,null,timeout)};var setTimer4=function(){resetTimer4();timer4=$__default["default"].later(1e3,null,timeout4)};if(useKeepAlive){var keepAliveInterval=ew.SESSION_KEEP_ALIVE_INTERVAL>0?ew.SESSION_KEEP_ALIVE_INTERVAL:ew.SESSION_TIMEOUT-ew.SESSION_TIMEOUT_COUNTDOWN;if(keepAliveInterval<=0)keepAliveInterval=60;timer3=$__default["default"].later(keepAliveInterval*1e3,null,keepAlive,null,true);keepAliveTimer=$__default["default"].later(keepAliveInterval*1e3,null,keepAlive,null,true)}if(ew.SESSION_TIMEOUT>0){setTimer();setTimer4()}}function initExportLinks(e){var _e$target3;var el=(_e$target3=e==null?void 0:e.target)!=null?_e$target3:document;$__default["default"](el).find("a.ew-export-link[href]:not(.ew-email):not(.ew-print):not(.ew-xml)").on("click",(function(e){var href=this.href;if(href&&href!="#")fileDownload(href);e.preventDefault()}))}function initMultiSelectCheckboxes(e){var _e$target4;var el=(_e$target4=e==null?void 0:e.target)!=null?_e$target4:document,$el=$__default["default"](el),$cbs=$el.find("input[type=checkbox].ew-multi-select");var _update=function(id){var $els=$cbs.filter("[name^='"+id+"_']"),cnt=$els.length,len=$els.filter(":checked").length;$__default["default"]("input[type=checkbox]#"+id).prop("checked",len==cnt).prop("indeterminate",len!=cnt&&len!=0)};$cbs.on("click",(e=>_update(e.target.name.split("_")[0])));$el.find("input[type=checkbox].ew-priv:not(.ew-multi-select)").each(((i,el)=>_update(el.id)))}function fileDownload(href,data){let isHtml=href.includes("export=html");return Swal.fire({...ew.sweetAlertSettings,showConfirmButton:false,html:"<p>"+ew.language.phrase("Exporting")+"</p>",allowOutsideClick:false,allowEscapeKey:false,willOpen:()=>{Swal.showLoading();$__default["default"].ajax({url:href,type:data?"POST":"GET",cache:false,data:data||null,xhrFields:{responseType:isHtml?"text":"blob"}}).done(((data,textStatus,jqXHR)=>{var url=URL.createObjectURL(isHtml?new Blob([data],{type:"text/html"}):data),a=document.createElement("a"),cd=jqXHR.getResponseHeader("Content-Disposition"),m=cd.match(/\bfilename=((['"])(.+)\2|([^;]+))/i);a.style.display="none";a.href=url;if(m)a.download=m[3]||m[4];document.body.appendChild(a);a.click();$document$1.trigger("export",[{type:"done",url:href,objectUrl:url}]);URL.revokeObjectURL(url);Swal.close()})).fail(((jqXHR,textStatus,errorThrown)=>{var _Swal$getActions;Swal.hideLoading();Swal.update({showConfirmButton:true});(_Swal$getActions=Swal.getActions())==null?void 0:_Swal$getActions.classList.add("d-flex");Swal.showValidationMessage("<div class='text-danger'>"+(errorThrown||ew.language.phrase("FailedToExport"))+"</div>");$document$1.trigger("export",[{type:"fail",url:href}])})).always((()=>{$document$1.trigger("export",[{type:"always",url:href}])}))}})}function lazyLoad(e){var _e$target5;if(!ew.LAZY_LOAD)return;var el=(_e$target5=e==null?void 0:e.target)!=null?_e$target5:document;el.querySelectorAll("img.ew-lazy").forEach(((img,i)=>{if(ew.LAZY_LOAD_DELAY>0)setTimeout((()=>img.src=img.dataset.src),i*ew.LAZY_LOAD_DELAY);else img.src=img.dataset.src}));$document$1.trigger("lazyload")}function updateDropdownPosition(){var select=$__default["default"](".select2-container--open").prev(".ew-select").data("select2");if(select){select.dropdown._positionDropdown();select.dropdown._resizeDropdown()}}function initLightboxes(e){var _e$target6;if(!ew.USE_COLORBOX)return;var el=(_e$target6=e==null?void 0:e.target)!=null?_e$target6:document;var settings=Object.assign({},ew.lightboxSettings,{title:ew.language.phrase("LightboxTitle"),current:ew.language.phrase("LightboxCurrent"),previous:ew.language.phrase("LightboxPrevious"),next:ew.language.phrase("LightboxNext"),close:ew.language.phrase("LightboxClose"),xhrError:ew.language.phrase("LightboxXhrError"),imgError:ew.language.phrase("LightboxImgError")});$__default["default"](el).find(".ew-lightbox").each((function(){var $this=$__default["default"](this);$this.colorbox(Object.assign({rel:$this.data("rel")},settings))}))}function initPdfObjects(e){var _e$target7;if(!ew.EMBED_PDF)return;var el=(_e$target7=e==null?void 0:e.target)!=null?_e$target7:document,options=Object.assign({},ew.PDFObjectOptions);$__default["default"](el).find(".ew-pdfobject").not(":has(.pdfobject)").each((function(){var $this=$__default["default"](this),url=$this.data("url"),html=$this.html();if(url)PDFObject.embed(url,this,Object.assign(options,{fallbackLink:html}))}))}function initTooltips(e){var _e$target8;var el=(_e$target8=e==null?void 0:e.target)!=null?_e$target8:document,$el=$__default["default"](el);$el.find("input[data-bs-toggle=tooltip],textarea[data-bs-toggle=tooltip],select[data-bs-toggle=tooltip]").each((function(){var $this=$__default["default"](this);$this.tooltip(Object.assign({html:true,placement:"bottom",sanitizeFn:ew.sanitizeFn},$this.data()))}));$el.find("a.ew-tooltip-link").each(tooltip);$el.find(".ew-tooltip").tooltip({placement:"bottom",sanitizeFn:ew.sanitizeFn});$el.find(".ew-popover").popover({sanitizeFn:ew.sanitizeFn})}function parseJson(data){if($__default["default"].isString(data)){try{return JSON.parse(data)}catch(e){return undefined}}return data}function searchOperatorChanged(el){var $el=$__default["default"](el),$p=$el.closest("[id^=r_], [id^=xs_]"),parm=el.id.substr(2),$fld=$p.find(".ew-search-field"),$fld2=$p.find(".ew-search-field2"),$y=$fld2.find("[name='y_"+parm+"'], [name='y_"+parm+"[]']"),hasY=$y.length,$cond=$p.find(".ew-search-cond"),hasCond=$cond.length,$and=$p.find(".ew-search-and"),$opr=$p.find(".ew-search-operator"),opr=$opr.find("[name='z_"+parm+"']").val(),$opr2=$p.find(".ew-search-operator2"),opr2=$opr2.find("[name='w_"+parm+"']").val(),isBetween=opr=="BETWEEN",isNullOpr=["IS NULL","IS NOT NULL"].includes(opr),isNullOpr2=["IS NULL","IS NOT NULL"].includes(opr2),hideOpr2=!hasY||isBetween,hideX=isNullOpr,hideY=!isBetween&&(!hasCond||isNullOpr2);$cond.toggleClass("d-none",hideOpr2).find(":input").prop("disabled",hideOpr2);$and.toggleClass("d-none",!isBetween);$opr2.toggleClass("d-none",hideOpr2).find(":input").prop("disabled",hideOpr2);$fld.toggleClass("d-none",hideX).find(":input").prop("disabled",hideX);$fld2.toggleClass("d-none",hideY).find(":input").prop("disabled",hideY)}function initForms(e){var _e$target9;let el=(_e$target9=e==null?void 0:e.target)!=null?_e$target9:document,$el=$__default["default"](el),ids=ew.forms.ids();for(let id of ids){if($el.find("#"+id))forms.get(id).init()}}function isFunction$2(x){return typeof x==="function"}function _alert(msg,cb,type){let config=$__default["default"].isObject(msg)?msg:{};msg=$__default["default"].isString(msg)?msg:"";type=$__default["default"].isString(cb)?cb:type;config=$__default["default"].extend(true,{},ew.sweetAlertSettings,{html:msg,icon:type,confirmButtonText:ew.language.phrase("OKBtn"),customClass:{htmlContainer:"ew-swal2-html-container text-"+(type||"danger")}},config);let args={config:config,type:type,show:true};$document$1.trigger("alert",[args]);if(args.show)return Swal.fire(args.config).then((result=>isFunction$2(cb)?cb(result.isConfirmed):result))}function _prompt(cfg,cb){var _config,_config$inputValidato;let config=$__default["default"].isObject(cfg)?cfg:{};config=$__default["default"].extend(true,{},ew.sweetAlertSettings,{html:$__default["default"].isString(cfg)?cfg:"",showCancelButton:false,confirmButtonText:ew.language.phrase("OKBtn"),cancelButtonText:ew.language.phrase("CancelBtn")},config);if(config.input)(_config$inputValidato=(_config=config).inputValidator)!=null?_config$inputValidato:_config.inputValidator=value=>{if(!value)return ew.language.phrase("EnterValue")};return Swal.fire(config).then((result=>isFunction$2(cb)?cb(result.value):result))}function toast(options){options=Object.assign({},ew.toastOptions,options);$document$1.Toasts("create",options);var position=options.position,$container=$__default["default"]("#toastsContainer"+position[0].toUpperCase()+position.substring(1));return $container.children().first()}function showToast(message,type){if(!message)return;type=type||"danger";let args={message:message,type:type,show:true};$document$1.trigger("toast",[args]);if(!args.show)return;({message:message,type:type}=args);return toast({class:"ew-toast bg-"+type,title:ew.language.phrase(type),body:message,autohide:type=="success"?ew.autoHideSuccessMessage:false,delay:type=="success"?ew.autoHideSuccessMessageDelay:500})}function getForm(el){if(el instanceof Form)return el.$element[0];var $el=$__default["default"](el),$f=$el.closest(".ew-form");if(!$f[0])$f=$el.closest(".ew-grid, .ew-multi-column-grid").find(".ew-form").not(".ew-pager-form");return $f[0]}function hasFormData(form){var selector="[name^=x_],[name^=y_],[name^=z_],[name^=w_],[name=psearch]",els=$__default["default"](form).find(selector).filter(":enabled").get();for(var i=0,len=els.length;i<len;i++){var el=els[i];if(/^(z|w)_/.test(el.name)){if(/^IS/.test($__default["default"](el).val()))return true}else if(el.type=="checkbox"||el.type=="radio"){if(el.checked)return true}else if(el.type=="select-one"||el.type=="select-multiple"){if(!!$__default["default"](el).val())return true}else if(["text","textarea","password","search","color","date","datetime-local","datetime","email","hidden","month","number","range","tel","time","url","week"].includes(el.type)){if(el.value)return true}}return false}function setSearchType(el){var val=el.dataset.searchType,phraseId="Auto";if(val=="=")phraseId="Exact";else if(val=="AND")phraseId="All";else if(val=="OR")phraseId="Any";el.closest(".ew-basic-search").querySelector("input.ew-basic-search-type").value=val||"";el.closest(".dropdown-menu").querySelectorAll(".dropdown-item").forEach((item=>item.classList.remove("active")));el.closest(".dropdown-item").classList.add("active");var searchType=el.closest(".input-group").querySelector("#searchtype"),text=ew.language.phrase("QuickSearch"+phraseId+"Short");searchType.innerHTML=text;searchType.classList.toggle("me-2",!!text);return false}function updateOptions(obj,parentId,async,change){var _batch$send;var f=this.$element?this.$element[0]:this.form?this.form:null;if(!f)return;var frm=this.htmlForm?this:forms.get(f.id);if(!frm)return;if(this.form&&$__default["default"].isUndefined(obj))obj=forms.get(this).getList(this.name||this.id).childFields.slice();else if($__default["default"].isString(obj))obj=getElements(obj,f);if(!obj||Array.isArray(obj)&&obj.length==0)return;var self=this,batch=new Batch;if(Array.isArray(obj)&&$__default["default"].isString(obj[0])){var els=[];for(var i=0,len=obj.length;i<len;i++){var ar=obj[i].split(" ");if(ar.length==1&&self.form){var m=getId(self,false).match(/^([xy]\d*_)/);if(m)obj[i]=obj[i].replace(/^([xy]\d*_)/,m[1])}var el=getElements(obj[i],f),names=[];if(isTextbox(el)||isFilter(el))continue;els.push(el);if(ar.length==2&&Array.isArray(el)){var $el=$__default["default"](el);$el.each((function(){if(!names.includes(this.name)){names.push(this.name);var $elf=$el.filter("[name='"+this.name+"']"),typ=$elf.attr("type"),elf=["radio","checkbox"].includes(typ)?$elf.get():$elf[0];batch.add(_updateOptions.bind(self,elf,parentId,async,change))}}))}else{batch.add(_updateOptions.bind(self,el,parentId,async,change))}}obj=els;var list=forms.get(self).getList(self.name||self.id);if(Array.isArray(list==null?void 0:list.autoFillTargetFields)&&list.autoFillTargetFields[0])batch.add(autoFill.bind(null,self))}else{if(isTextbox(obj)||isFilter(obj))return;batch.add(_updateOptions.bind(self,obj,parentId,async,change))}return(_batch$send=batch.send({url:ew.getApiUrl(ew.API_LOOKUP_ACTION)}))==null?void 0:_batch$send.then((function(){$document$1.trigger("updatedone",[{source:self,target:obj}])}))}function _updateOptions(obj,parentId,async,change){var id=getId(obj,false);if(!id)return;var fo=getForm(obj);if(!fo||!fo.id)return;var frmo=forms.get(fo.id);if(!frmo)return;var self=this,args=Array.from(arguments),ar=getOptionValues(obj),m=id.match(/^([xy])(\d*)_/),prefix=m?m[1]:"",rowindex=m?m[2]:"",arp=[],list=frmo.getList(id),$obj=$__default["default"](obj).data("updating",true);if($obj.data("hidden"))return;if($__default["default"].isUndefined(parentId)){parentId=list.parentFields.slice();if(rowindex!=""){for(var i=0,len=parentId.length;i<len;i++){var arr=parentId[i].split(" ");if(arr.length==1)parentId[i]=parentId[i].replace(/^x_/,"x"+rowindex+"_")}}}if(Array.isArray(parentId)&&parentId.length>0){if(Array.isArray(parentId[0])){arp=parentId}else if($__default["default"].isString(parentId[0])){for(var i=0,len=parentId.length;i<len;i++)arp.push(getOptionValues(parentId[i],fo))}}if(!isAutoSuggest(obj))clearOptions(obj);var addOpt=function(results){var name=getId(obj);results.forEach((function(result){let args={data:result,parents:arp,valid:true,name:name,form:fo};$document$1.trigger("addoption",[args]);if(args.valid)newOption(obj,result,fo)}));if(obj.list)obj.render();selectOption(obj,ar);if(change!==false){if(!obj.options&&obj.length)$obj.first().triggerHandler("click");else $obj.first().trigger("change")}};if($__default["default"].isUndefined(async))async=list.ajax;var _updateSibling=function(){if(/(s(ea)?rch|summary|crosstab)$/.test(fo.id)&&prefix=="x"&&!rowindex){args[0]=id.replace(/^x_/,"y_");updateOptions.apply(self,args)}};if(!$__default["default"].isBoolean(async)||Array.isArray(list.lookupOptions)&&list.lookupOptions.length>0){var ds=list.lookupOptions;addOpt(ds);_updateSibling();return ds}else{var name=getId(obj),data=Object.assign({page:list.page,field:list.field,ajax:"updateoption",language:ew.LANGUAGE_ID,name:name},getUserParams("#p_"+id,fo));if(isAutoSuggest(obj)&&self.htmlForm)data["v0"]=ar[0]||random();else if(obj.options&&obj.tagName!="SELECTION-LIST"&&!obj.classList.contains("form-select")||isModalLookup(obj))data["v0"]=ar[0]?obj.multiple?ar.join(ew.MULTIPLE_OPTION_SEPARATOR):ar[0]:random();for(var i=0,cnt=arp.length;i<cnt;i++)data["v"+(i+1)]=arp[i].join(ew.MULTIPLE_OPTION_SEPARATOR);return $__default["default"].ajax(getApiUrl(ew.API_LOOKUP_ACTION),{method:"POST",dataType:"json",data:data,async:async,processData:false,success:result=>{var ds=result.records||[];addOpt(ds);_updateSibling();$obj.first().trigger("updated",[Object.assign({},result,{target:obj})]);return ds},complete:()=>$obj.data("updating",false)})}}function getUserParams(id,root){var id=id.replace(/\[\]$/,""),o={};var root=!$__default["default"].isString(root)?root:/^#/.test(root)?root:"#"+root;var $els=root?$__default["default"](root).find(id):$__default["default"](id);var val=$els.val();if(val){var params=new URLSearchParams(val);params.forEach((function(value,key){o[key]=value}))}return o}function applyTemplate(divId,tmplId,classId,exportType,data){let args={data:data||{},id:divId,template:tmplId,class:classId,export:exportType,enabled:true};$document$1.trigger("rendertemplate",[args]);if(args.enabled){var _document$getElementB;let template=(_document$getElementB=document.getElementById(tmplId))==null?void 0:_document$getElementB.content,dlg=document.querySelector("#ew-modal-dialog.show");if(!template)return;template.querySelectorAll(".ew-slot").forEach((el=>{var _dlg$querySelector;let id=el.name||el.id,subtmpl=(_dlg$querySelector=dlg==null?void 0:dlg.querySelector("#"+id))!=null?_dlg$querySelector:document.getElementById(id);if(subtmpl!=null&&subtmpl.content){if(el.dataset.rowspan>1)Array.prototype.slice.call(subtmpl.content.childNodes).forEach((node=>node.rowSpan=el.dataset.rowspan));el.replaceWith(subtmpl.content.cloneNode(true))}else{el.remove()}}));if($__default["default"].views){let textContent=template.textContent,hasTag=textContent.includes("{{")&&textContent.includes("}}");if(!hasTag){let selector=ew.jsRenderAttributes.map((attr=>"["+attr+"*='{{']["+attr+"*='}}']")).join(",");hasTag=template.querySelector(selector)}if(hasTag){let scripts=Array.prototype.slice.call(template.querySelectorAll("script"));scripts.forEach((item=>item.remove()));let div=document.createElement("div");div.appendChild(template);let html=div.innerHTML.replace(/{{([^}]+)}}/g,(m=>htmlDecode(m))),tmpl=$__default["default"].templates(html);document.getElementById(divId).innerHTML=tmpl.render(args.data,ew.jsRenderHelpers);scripts.forEach((item=>document.body.appendChild(item)))}else{document.getElementById(divId).appendChild(template)}}else{document.getElementById(divId).appendChild(template)}}if(exportType&&exportType!="print"){$__default["default"]((function(){let $meta=$__default["default"]("meta[http-equiv='Content-Type']"),html="<html><head>",$div=$__default["default"]("#"+divId);if($div.children(0).is("div[id^=ct_]"))$div=$div.children(0);if($meta[0])html+="<meta http-equiv='Content-Type' content='"+$meta.attr("content")+"'>";if(exportType=="pdf"){html+="<link rel='stylesheet' href='"+ew.PDF_STYLESHEET_FILENAME+"'>"}else{html+="<style>"+$__default["default"].ajax({async:false,type:"GET",url:ew.PROJECT_STYLESHEET_FILENAME}).responseText+"</style>"}html+="</"+"head><body>";$__default["default"](".ew-chart-top").each((function(){html+=$__default["default"](this).html()}));html+=$div.html();$__default["default"](".ew-chart-bottom").each((function(){html+=$__default["default"](this).html()}));html+="</body></html>";let url=currentPage(),data={customexport:exportType,data:html,filename:args.class};data[ew.TOKEN_NAME]=ew.ANTIFORGERY_TOKEN;if(exportType=="email"){let str=currentUrl.searchParams.toString()+"&"+$__default["default"].param(data);$__default["default"].post(url,str,(function(result){showMessage(result)}))}else{fileDownload(url,data)}window.parent.jQuery("body").css("cursor","default")}))}}function toggleGroup(el){var $el=$__default["default"](el),$tr=$el.closest("tr"),selector="tr",level;for(var i=1;i<=6;i++){var idx=i==1?"":"-"+i;var data=$tr.data("group"+idx);if($__default["default"].isValue(data)){level=i;if(data!="")selector+="[data-group"+idx+"='"+String(data).replace(/'/g,"\\'")+"']"}}if($el.hasClass("ew-rpt-grp-hide")){$__default["default"](selector).slice(1).removeClass("ew-rpt-grp-hide-"+level);$el.removeClass("ew-rpt-grp-hide")}else{$__default["default"](selector).slice(1).addClass("ew-rpt-grp-hide-"+level);$el.addClass("ew-rpt-grp-hide")}}function convertToBool(value){return value&&["1","y","t","true"].includes(value.toLowerCase())}function valueChanged(fobj,infix,fld,bool){var nelm=getElements("x"+infix+"_"+fld,fobj);var oelm=getElement("o"+infix+"_"+fld,fobj);var fnelm=getElement("fn_x"+infix+"_"+fld,fobj);if((nelm==null?void 0:nelm.type)=="hidden"&&!oelm)return false;if(!oelm&&(!nelm||Array.isArray(nelm)&&nelm.length==0))return false;var getValue=obj=>getOptionValues(obj).join();if(oelm&&nelm){if(bool){if(convertToBool(getValue(oelm))===convertToBool(getValue(nelm)))return false}else{var oldvalue=getValue(oelm);var newvalue=fnelm?getValue(fnelm):getValue(nelm);if(oldvalue==newvalue)return false}}return true}function setLanguage(el){var $el=$__default["default"](el),val=$el.val()||$el.data("language");if(!val)return false;currentUrl.searchParams.set("language",val);window.location=sanitizeUrl(currentUrl.toString());return false}function submitAction(e,args){var _window$msg;var el=e.currentTarget,f=args.f||el.form||el.closest("form"),$f=$__default["default"](f),key=args.key,action=args.action,url=args.url||currentPage(),msg=args.msg,data=args.data,success=args.success,isPost=!args.method||sameText(args.method[0],"p"),isMultiple=!args.select&&!args.key||args.select&&sameText(args.select[0],"m");if((isMultiple||isPost)&&!f){_alert(ew.language.phrase("NoHtmlForm"));return false}if(isMultiple&&!keySelected(f)){_alert({html:ew.language.phrase("NoRecordSelected"),icon:"warning"});return false}var _success=function(result){showMessage(result)};var _submit=function(value){if(isPost&&f){if(action)$__default["default"]("<input>").attr({type:"hidden",name:"useraction",value:action}).appendTo($f);if(!$__default["default"].isUndefined(value))$__default["default"]("<input>").attr({type:"hidden",name:"actionvalue",value:value}).appendTo($f);if($__default["default"].isObject(data)){for(var k in data){var $input=$f.find("input[type=hidden][name='"+k+"']");if($input[0])$input.val(data[k]);else $__default["default"]("<input>").attr({type:"hidden",name:k,value:data[k]}).appendTo($f)}}if(!isMultiple&&$__default["default"].isObject(key)){for(var k in key)$__default["default"]("<input>").attr({type:"hidden",name:k,value:key[k]}).appendTo($f)}$f.prop({action:url,method:"post"}).trigger("submit")}else{data=$__default["default"].isObject(data)?$__default["default"].param(data):$__default["default"].isString(data)?data:"";if(action)data+="&useraction="+action+"&ajax="+action;if(!$__default["default"].isUndefined(value))data+="&actionvalue="+encodeURIComponent(value);if(isMultiple)data+="&"+$f.find("input[name='key_m[]']:checked").serialize();else if(key)data+="&"+($__default["default"].isObject(key)?$__default["default"].param(key):key);if(success&&$__default["default"].isString(success))success=window[success];if(isFunction$2(success)){$__default["default"].post(url,data,success)}else if($__default["default"].isObject(success)){success.data=data;success.method=success.method||"POST";success.success=success.success||_success;$__default["default"].ajax(url,success)}else{$__default["default"].post(url,data,_success)}}};msg=$__default["default"].isString(msg)?(_window$msg=window[msg])!=null?_window$msg:msg:msg;if(msg){_prompt({html:msg,showCancelButton:true,icon:"question"},(value=>{if(value)_submit(value)}))}else{_submit()}return false}function _export(e,url,type,custom,sel,fobj){var f=e.currentTarget.form;if(!f)return false;var $f=$__default["default"](f),target=$f.attr("target"),action=$f.attr("action"),cb=sel&&f.querySelector("input[type=checkbox][name='key_m[]']");if(cb&&!keySelected(f)){_alert({html:ew.language.phrase("NoRecordSelected"),icon:"warning"});return false}if(custom){$__default["default"]("iframe.ew-export").remove();if(type=="email"&&fobj)url+="&"+$__default["default"](fobj).serialize().replace(/&export=email/,"");if(cb){$__default["default"]("<iframe>").attr("name","ew-export-frame").addClass("ew-export d-none").appendTo($body);try{$f.append($__default["default"]("<input type='hidden'>").attr({name:"custom",value:"1"})).attr({action:url,target:"ew-export-frame"}).find("input[name=exporttype]").val(type).end().trigger("submit")}finally{$f.attr({target:target||"",action:action}).find("input[name=custom]").remove()}}else{$__default["default"]("<iframe>").attr({name:"ew-export-frame",src:url}).addClass("ew-export d-none").appendTo($body)}}else{$f.find("input[name=exporttype]").val(type);if(["xml","print"].includes(type))$f.trigger("submit");else fileDownload(action,$f.serialize())}return false}function removeSpaces(value){return/^(<(p|br)\/?>(&nbsp;)?(<\/p>)?)?$/i.test(value.replace(/\s/g,""))?"":value}function isHiddenTextArea(el){var $el=$__default["default"](el);return $el.is(":hidden")&&$el.data("editor")}function isModalLookup(el){var _el$dataset;return el==null?void 0:(_el$dataset=el.dataset)==null?void 0:_el$dataset.modalLookup}function isFilter(el){var _el$dataset2;return el==null?void 0:(_el$dataset2=el.dataset)==null?void 0:_el$dataset2.filter}function isAutoSuggest(el){var $el=$__default["default"](el);return $el.is(":hidden")&&$el.data("autosuggest")}function isTextbox(el){var $el=$__default["default"](el);return $el.is("input[type!=checkbox][type!=radio]")&&!isAutoSuggest($el)}function clearError(el){if(el.jquery){let typ=el.attr("type");el=typ=="checkbox"||typ=="radio"?el.get():el[0]}$__default["default"](el).closest(fieldContainerSelector).find(".invalid-feedback").html("")}function onError(frm,el,msg,focus){if(el.jquery){let typ=el.attr("type");el=typ=="checkbox"||typ=="radio"?el.get():el[0]}else if(el instanceof Field){el=el.element}$__default["default"](el).closest(fieldContainerSelector).find(".invalid-feedback").append("<p>"+msg+"</p>");if(focus)setFocus(el);frm==null?void 0:frm.makeVisible(el);return false}function setFocus(obj,options){if(!obj)return;var $obj=$__default["default"](obj);if(isHidden($obj))return;if(isHiddenTextArea(obj)){return $obj.data("editor").focus()}else if(!obj.options&&obj.length){obj=$obj[0]}else if(isAutoSuggest(obj)){obj=obj.input}obj.focus(options)}function setInvalid(obj){if(!obj)return;let $obj=$__default["default"](obj);if(isHidden($obj))return;if(!obj.options&&obj.length)obj=$obj[0];let $p=$obj.closest(fieldContainerSelector),reset=()=>$p.find(".is-invalid").removeClass("is-invalid");if(isAutoSuggest(obj)){$p.find(".ew-auto-suggest").removeClass("is-valid").addClass("is-invalid").one("click keydown",reset)}else if(isHiddenTextArea(obj)){$obj.removeClass("is-valid").addClass("is-invalid");$obj.data("editor").instance.once("change",reset)}else if(isModalLookup(obj)){$obj.removeClass("is-valid").addClass("is-invalid").one("select2:open",reset)}else{if(obj.type=="checkbox"||obj.type=="radio"){$obj.removeClass("is-valid").addClass("is-invalid").one("click keydown",reset)}else{$obj.removeClass("is-valid").addClass("is-invalid").parent().one("click keydown change",reset);$obj.closest(".input-group").removeClass("is-valid").addClass("is-invalid")}}}function setValid(obj){if(!obj)return;var $obj=$__default["default"](obj);if(isHidden($obj))return;if(!obj.options&&obj.length)obj=$obj[0];var $p=$obj.closest(fieldContainerSelector);if(isAutoSuggest(obj)){$p.find(".ew-auto-suggest").removeClass("is-invalid").addClass("is-valid").one("click keydown",(function(){$p.find(".is-valid").removeClass("is-valid")}))}else{if(obj.type=="checkbox"||obj.type=="radio"){$obj.removeClass("is-invalid").addClass("is-valid").one("click keydown",(function(){$p.find(".is-valid").removeClass("is-valid")}))}else{$obj.removeClass("is-invalid").addClass("is-valid").parent().one("click keydown",(function(){$p.find(".is-valid").removeClass("is-valid")}));$obj.closest(".input-group").removeClass("is-invalid").addClass("is-valid")}}}function hasValue(obj){return getOptionValues(obj).join("")!=""}function isMaskedPassword(obj){var val=$__default["default"](obj).val();return val==null?void 0:val.match(/^\*+$/)}function sort(e,url,type){if(e.shiftKey&&!e.ctrlKey)url=url.split("?")[0]+"?cmd=resetsort";else if(type==2&&e.ctrlKey)url+="&ctrl=1";window.location=sanitizeUrl(url);return true}function filter(e){let data=e.currentTarget.dataset;$__default["default"]("select[data-select2-id='f"+data.table+"srch_"+data.field+"']").select2("open")}function confirmDelete(el){clickDelete(el);_prompt({html:ew.language.phrase("DeleteConfirmMsg"),icon:"question",showCancelButton:true},(result=>{result&&el.href?window.location=sanitizeUrl(el.href):clearDelete(el)}));return false}function keySelected(f){return $__default["default"](f).find("input[type=checkbox][name='key_m[]']:checked",f).length>0}function selectAllKeys(cb){selectAll(cb);var tbl=$__default["default"](cb).closest(".ew-table")[0];if(!tbl)return;$__default["default"](tbl.tBodies).each((function(){$__default["default"](this.rows).each((function(i,r){var $r=$__default["default"](r);if($r.is(":not(.ew-template):not(.ew-table-preview-row)"))$r.toggleClass("table-active ew-table-selected-row",cb.checked).triggerHandler("change")}))}))}function selectAll(cb){if(!cb||!cb.form)return;$__default["default"](cb.form.elements).filter("input[type=checkbox][name^="+cb.name+"_], [type=checkbox][name="+cb.name+"]").not(cb).not(":disabled").prop("checked",cb.checked)}function updateSelected(f){return $__default["default"](f).find("input[type=checkbox][name^=u_]:checked,input:hidden[name^=u_][value=1]").length>0}function clearSelected(tbl){let rowIndexes=$__default["default"](tbl).find("input[type=checkbox][name='key_m[]']:checked").closest("[data-rowindex]").map(((i,r)=>r.dataset.rowindex)).get();$__default["default"](tbl==null?void 0:tbl.rows).filter(((i,r)=>r.classList.contains("table-active")&&!rowIndexes.includes(r.dataset.rowindex))).removeClass("table-active ew-table-selected-row").triggerHandler("change")}function clearDelete(el){var $el=$__default["default"](el),tbl=$el.closest(".ew-table")[0];if(!tbl)return;var $tr=$el.closest(".ew-table > tbody > tr");$tr.siblings("[data-rowindex='"+$tr.data("rowindex")+"']").addBack().removeClass("table-active").triggerHandler("change")}function clickDelete(el){var $el=$__default["default"](el),tbl=$el.closest(".ew-table")[0];if(!tbl)return;clearSelected(tbl);var $tr=$el.closest(".ew-table > tbody > tr");$tr.siblings("[data-rowindex='"+$tr.data("rowindex")+"']").addBack().addClass("table-active").triggerHandler("change")}function selectKey(e){var cb=e.target,$cb=$__default["default"](cb),tbl=$cb.closest(".ew-table")[0];if(!tbl)return;clearSelected(tbl);var $tr=$cb.closest(".ew-table > tbody > tr");$tr.siblings("[data-rowindex='"+$tr.data("rowindex")+"']").addBack().each((function(i,r){$__default["default"](r).toggleClass("table-active ew-table-selected-row",cb.checked).triggerHandler("change")}));e.stopPropagation()}function setupTable(index,tbl,force){var $tbl=$__default["default"](tbl),$rows=$__default["default"](tbl.rows);if(!tbl||!tbl.rows||!force&&$tbl.data("isset")||tbl.tBodies.length==0)return;var click=function(e){var $this=$__default["default"](this),$tbl=$this.closest(".ew-table"),tbl=$tbl[0],$target=$__default["default"](e.target);if(!tbl||$target.hasClass("btn")||$target.hasClass("ew-preview-btn")||$target.is(":input"))return;clearSelected(tbl);$this.siblings("[data-rowindex='"+$this.data("rowindex")+"']").addBack().toggleClass("table-active").triggerHandler("change")};var n=$rows.filter("[data-rowindex=1]").length||$rows.filter("[data-rowindex=0]").length||1;var rows=$rows.filter(":not(.ew-template)").each((function(){$__default["default"](this.cells).removeClass("ew-table-last-row").last().addClass("ew-table-last-col")})).get();var div=$tbl.parentsUntil(".ew-grid","."+ew.RESPONSIVE_TABLE_CLASS)[0];if(rows.length){for(var i=1;i<=n;i++){var r=rows[rows.length-i];$__default["default"](r.cells).each((function(){if(this.rowSpan==i)$__default["default"](this).addClass("ew-table-last-row").toggleClass("ew-table-border-bottom",(div==null?void 0:div.clientHeight)>tbl.offsetHeight)}))}}var form=$tbl.closest("form")[0];var attach=form&&$__default["default"](form.elements).filter("input#action:not([value^=grid])").length>0;$__default["default"](tbl.tBodies[tbl.tBodies.length-1].rows).filter(":not(.ew-template):not(.ew-table-preview-row)").each((function(){var $r=$__default["default"](this);if(attach&&!$r.data("isset"))$r.on("click",click).data("isset",true)}));setupGrid(index,$tbl.closest(".ew-grid")[0],force);$tbl.data("isset",true)}function setupGrid(index,grid,force){var $grid=$__default["default"](grid);if(!grid||!force&&$grid.data("isset"))return;var rowcnt=$grid.find("table.ew-table > tbody").first().children("tr:not(.ew-table-preview-row, .ew-template)").length;if(rowcnt==0&&!$grid.find(".ew-grid-upper-panel, .ew-grid-lower-panel")[0])$grid.hide();if($grid.find(".ew-grid-middle-panel:visible").hasClass(ew.RESPONSIVE_TABLE_CLASS)&&$grid.width()>$__default["default"](".content").width()){$grid.addClass("d-flex");$grid.closest(".ew-detail-pages").addClass("d-block");$grid.closest(".ew-form").addClass("w-100");if(ew.USE_OVERLAY_SCROLLBARS)$grid.find(".ew-grid-middle-panel:not(.ew-preview-middle-panel)").overlayScrollbars(ew.overlayScrollbarsOptions)}$grid.data("isset",true)}function addGridRow(el){var _bootstrap$Tooltip$ge2;var $grid=$__default["default"](el).closest(".ew-grid"),$tbl=$grid.find("table.ew-table").last(),$p=$tbl.parent("div"),$tpl=$tbl.find("tr.ew-template");if(!el||!$grid[0]||!$tbl[0]||!$tpl[0])return false;var $lastrow=$__default["default"]($tbl[0].rows).last();$tbl.find("td.ew-table-last-row").removeClass("ew-table-last-row");var $row=$tpl.clone(true,true).removeClass("ew-template");var $form=$grid.find("div.ew-form[id^=f][id$=grid]");if(!$form[0])$form=$grid.find("form.ew-form[id^=f][id$=list]");var suffix=$form.is("div")?"_"+$form.attr("id"):"";var $elkeycnt=$form.find("#key_count"+suffix);var keycnt=parseInt($elkeycnt.val(),10)+1;$row.attr({id:"r"+keycnt+$row.attr("id").substring(2),"data-rowindex":keycnt});var $els=$tpl.find("script:contains('$rowindex$')");$row.children("td").each((function(){$__default["default"](this).find("*").each((function(){$__default["default"].each(this.attributes,(function(i,attr){attr.value=attr.value.replace(/\$rowindex\$/g,keycnt)}))}))}));var $btn=$row.find(".ew-icon").closest("a, button");(_bootstrap$Tooltip$ge2=bootstrap.Tooltip.getInstance($btn[0]))==null?void 0:_bootstrap$Tooltip$ge2.dispose();$btn.tooltip({container:"body",placement:"bottom",trigger:"hover",sanitizeFn:ew.sanitizeFn});$elkeycnt.val(keycnt).after($__default["default"]("<input>").attr({type:"hidden",id:"k"+keycnt+"_action"+suffix,name:"k"+keycnt+"_action"+suffix,value:"insert"}));$lastrow.after($row);$els.each((function(){addScript(this.text.replace(/\$rowindex\$/g,keycnt))}));var frm=$form.data("form");frm==null?void 0:frm.initEditors();frm==null?void 0:frm.initUpload();setupTable(-1,$tbl[0],true);$p.scrollTop($p[0].scrollHeight);return false}function deleteGridRow(el,infix){var _bootstrap$Tooltip$ge3;(_bootstrap$Tooltip$ge3=bootstrap.Tooltip.getInstance(el))==null?void 0:_bootstrap$Tooltip$ge3.dispose();var $el=$__default["default"](el),$grid=$el.closest(".ew-grid, .ew-multi-column-grid"),$row=$el.closest("tr, div[data-rowindex]"),$tbl=$row.closest(".ew-table");if(!el||!$grid[0]||!$row[0])return false;var rowidx=parseInt($row.data("rowindex"),10);var $form=$grid.find("div.ew-form[id^=f][id$=grid]");if(!$form[0])$form=$grid.find("form.ew-form[id^=f][id$=list]");var frm=$form.data("form");if(!$form[0]||!frm)return false;var suffix=$form.is("div")?"_"+$form.attr("id"):"";var keycntname="#key_count"+suffix;var _delete=function(){$row.remove();if($grid.is(".ew-grid"))setupTable(-1,$tbl[0],true);if(rowidx>0){var $keyact=$form.find("#k"+rowidx+"_action"+suffix);if($keyact[0]){$keyact.val($keyact.val()=="insert"?"insertdelete":"delete")}else{$form.find(keycntname).after($__default["default"]("<input>").attr({type:"hidden",id:"k"+rowidx+"_action"+suffix,name:"k"+rowidx+"_action"+suffix,value:"delete"}))}}};if(isFunction$2(frm.emptyRow)&&frm.emptyRow(infix)){_delete()}else{_prompt({html:ew.language.phrase("DeleteConfirmMsg"),showCancelButton:true,icon:"question"},(result=>{if(result)_delete()}))}return false}function htmlEncode(text){var str=String(text);return str.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlDecode(text){var str=String(text);return str.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">")}function getElements(el,root){var selector;if($__default["default"].isObject(el)&&el.dataset){selector="[data-table='"+el.dataset.table+"'][data-field='"+el.dataset.field+"']:not([name^=o]):not([name^='x$'])"}else if($__default["default"].isString(el)){selector="[name='"+el+"']";var ar=el.split(" ");if(ar.length==2)selector="[data-table='"+ar[0]+"'][data-field='"+getId(ar[1])+"']:not([name^=o]):not([name^='x$'])"}var root=!$__default["default"].isString(root)?root:/^#/.test(root)?root:"#"+root;selector="input"+selector+",select"+selector+",textarea"+selector+",button"+selector+",selection-list"+selector;var $els=root?$__default["default"](root).find(selector):$__default["default"](selector);if($els.length==1&&$els.is(":not([type=checkbox]):not([type=radio])"))return $els[0];if($els.length==2&&$els.eq(0).is("selection-list")&&$els.eq(1).is("input[type=hidden]"))return $els[0];return $els.get()}function getElement(name,root){var root=$__default["default"].isString(root)?"#"+root:root,selector="#"+name.replace(/([\$\[\]])/g,"\\$1")+",[name='"+name+"']";return root?$__default["default"](root).find(selector)[0]:$__default["default"](selector).first()[0]}function getAncestorBy(node,fn){while(node=node.parentNode){var _node;if(((_node=node)==null?void 0:_node.nodeType)==1&&(!fn||fn(node)))return node}return null}function isHidden(el){var $el=$__default["default"](el);return $el.css("display")=="none"&&!$el.is("selection-list")&&!$el.closest(".dropdown-menu")[0]&&!isModalLookup(el)&&!isAutoSuggest(el)&&!isHiddenTextArea(el)||getAncestorBy(el,(node=>node.style.display=="none"&&!node.classList.contains("tab-pane")&&!node.classList.contains("collapse")))!=null}function sameText(o1,o2){return String(o1).toLowerCase()==String(o2).toLowerCase()}function sameString(o1,o2){return String(o1)==String(o2)}function getValue(el,form){if(!el)return"";let obj;if($__default["default"].isString(el)){let ar=el.split(" ");if(ar.length==2){obj=getElements(el)}else{obj=getElements(el,form)}}else if(el.type=="radio"||el.type=="checkbox"){obj=getElements(el)}else{obj=el}if(obj.options){if(obj.list){let val=obj.values;return obj.multiple?val:val[0]||""}else{let val=Array.prototype.filter.call(obj.options,(option=>option.selected&&option.value!=="")).map((option=>option.value));return obj.type=="select-multiple"?val:val[0]||""}}else if($__default["default"].isNumber(obj.length)){let val=$__default["default"](obj).filter(":checked").map((function(){return this.value})).get();return obj.length==1?val[0]:val}else if(ew.isHiddenTextArea(obj)){$__default["default"](obj).data("editor").save();return obj.value}else{let data=$__default["default"](obj).data();if(data.lookup&&data.multiple)return obj.value.split(ew.MULTIPLE_OPTION_SEPARATOR);else return obj.value}}function getOptionValues(el,form){var obj;if($__default["default"].isString(el)){var ar=el.split(" ");if(ar.length==2){obj=getElements(el)}else{obj=getElements(el,form)}}else if(el.type=="radio"||el.type=="checkbox"){obj=getElements(el)}else{obj=el}if(obj.options){if(obj.list)return obj.values;else return Array.prototype.filter.call(obj.options,(option=>option.selected&&option.value!=="")).map((option=>option.value))}else if($__default["default"].isNumber(obj.length)){return $__default["default"](obj).filter(":checked").map((function(){return this.value})).get()}else if(ew.isHiddenTextArea(obj)){$__default["default"](obj).data("editor").save();return[obj.value]}else{var data=$__default["default"](obj).data();if(data.lookup&&data.multiple)return obj.value.split(ew.MULTIPLE_OPTION_SEPARATOR);else return[obj.value]}}function getOptionTexts(el,form){var obj;if($__default["default"].isString(el)){var ar=el.split(" ");if(ar.length==2){obj=getElements(el)}else{obj=getElements(el,form)}}else{obj=el}if(isAutoSuggest(obj)){return[obj.input.value]}else if(obj.options){return Array.prototype.filter.call(obj.options,(option=>option.selected&&option.value!=="")).map((option=>option.text))}else if($__default["default"].isNumber(obj.length)){return $__default["default"](obj).filter(":checked").map((function(){return $__default["default"](this).parent().text()})).get()}else if(ew.isHiddenTextArea(obj)){$__default["default"](obj).data("editor").save();return[obj.value]}else{return[obj.value]}}function clearOptions(obj){if(obj.options){var lo=obj.type=="select-multiple"||obj.hasAttribute("data-dropdown")||convertToBool(obj.getAttribute("data-pleaseselect"))===false||obj.length>0&&obj.options[0].value!=""?0:1;if(obj.list){obj.removeAll()}else{for(var i=obj.length-1;i>=lo;i--)obj.remove(i)}if(isAutoSuggest(obj)){obj.input.value="";obj.value=""}}}function getId(el,remove){var id=$__default["default"].isString(el)?el:$__default["default"](el).attr("name")||$__default["default"](el).attr("id");return remove!==false?id.replace(/\[\]$/,""):id}function valueSeparator(index,obj){var sep=$__default["default"](obj).data("value-separator");return Array.isArray(sep)?sep[index-1]:sep||", "}function displayValue(opt,obj){var text=opt.df;for(var i=2;i<=4;i++){if(opt["df"+i]&&opt["df"+i]!=""){var sep=valueSeparator(i-1,obj);if($__default["default"].isUndefined(sep))break;if($__default["default"].isValue(text))text+=sep;text+=opt["df"+i]}}return text}function optionHtml(val){return ew.OPTION_HTML_TEMPLATE.replace(/\{value\}/g,val)}function optionsHtml(options,max){if(options.length>(max||ew.MAX_OPTION_COUNT)){return ew.language.phrase("CountSelected").replace("%s",options.length)}else if(options.length){var html="";for(var i=0;i<options.length;i++)html+=optionHtml(options[i]);return html}else{return ew.language.phrase("PleaseSelect")}}function newOption(obj,opt,f){var frm=forms.get(f.id),id=getId(obj),list=frm.getList(id),value=opt.lf,item={lf:opt.lf,df:opt.df,df2:opt.df2,df3:opt.df3,df4:opt.df4},text;if(list.template&&!isAutoSuggest(obj)){text=list.template.render(item,ew.jsRenderHelpers)}else{text=displayValue(opt,obj)||value}var args={data:item,name:id,form:f.$element,value:value,text:text};if(obj.options){let option;if(obj.list){option=new SelectionListOption(args.value,args.text)}else{option=document.createElement("option");option.value=args.value;option.innerHTML=args.text}args={...args,option:option};$document$1.trigger("newoption",[args]);if(obj.list){obj.add(args.option.value,args.option.text)}else{obj.add(args.option)}}return args.text}function selectOption(obj,values){if(!obj||!values)return;var $obj=$__default["default"](obj);if(Array.isArray(values)){if(obj.options){if(obj.list){obj.value=values}else{var _obj$options$;$obj.val(values);if(obj.type=="select-one"&&obj.selectedIndex==-1&&!((_obj$options$=obj.options[0])!=null&&_obj$options$.value))obj.selectedIndex=0}if(isAutoSuggest(obj)&&values.length==1){let opts=obj.options||[];for(let opt of opts){if(opt.value==values[0]){obj.value=opt.value;obj.input.value=opt.text;break}}}}else if(obj.type){obj.value=values.join(ew.MULTIPLE_OPTION_SEPARATOR)}}function isAutoSelect(el){if(!$__default["default"](el).data("autoselect"))return false;var form=getForm(el);if(form){if(/s(ea)?rch$/.test(form.id))return false;var list=forms.get(form.id).getList(el.id);if((list==null?void 0:list.parentFields.length)===0)return false;return true}return false}if(!isAutoSelect(obj))return;if(obj.options){if(!obj.list&&obj.type=="select-one"&&obj.options.length==2&&!obj.options[1].selected){obj.options[1].selected=true;$obj.trigger("change")}else if(obj.options.length==1&&!obj.options[0].selected){obj.options[0].selected=true;$obj.trigger("change")}if(obj.list)obj.render();if(isAutoSuggest(obj)){let opts=obj.options||[];if(opts.length==1){obj.value=opts[0].value;obj.input.value=opts[0].text}}}}function _fetch(url,init){var _init;(_init=init)!=null?_init:init={};let apiUrl=getApiUrl(),isApi=url.startsWith(apiUrl);if(isApi&&ew.API_JWT_TOKEN&&!ew.IS_WINDOWS_AUTHENTICATION){init.headers=new Headers(init.headers||{});init.headers.set(ew.API_JWT_AUTHORIZATION_HEADER,"Bearer "+ew.API_JWT_TOKEN)}if(!init.method||init.method=="GET"){let ar=url.split("?"),params=new URLSearchParams(ar[1]);params.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);params.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN);if(init.body instanceof FormData||$__default["default"].isString(init.body)||$__default["default"].isObject(init.body)||Array.isArray(init.body)&&init.body.every((item=>Array.isArray(item)&&item.length==2))){let body=new URLSearchParams(init.body);body.forEach(((value,key)=>params.set(key,value)))}ar[1]=params.toString();url=ar[0]+(ar[1]?"?"+ar[1]:"");return fetch(url)}else{if(init.body instanceof FormData){init.body.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);init.body.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN)}else if($__default["default"].isString(init.body)||$__default["default"].isObject(init.body)||Array.isArray(init.body)&&init.body.every((item=>Array.isArray(item)&&item.length==2))){init.body=new URLSearchParams(init.body);init.body.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);init.body.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN)}return fetch(url,init)}}$document$1.ajaxSend((function(event,jqxhr,settings){var url=settings.url,apiUrl=getApiUrl(),isApi=url.startsWith(apiUrl),allowed=isApi||url.startsWith(ew.PATH_BASE)||url.startsWith(currentPage());if(!allowed&&url.match(/^http/i)){var objUrl=new URL(url);allowed=objUrl.hostname==currentUrl.hostname}if(allowed){if(isApi&&ew.API_JWT_TOKEN&&!ew.IS_WINDOWS_AUTHENTICATION)jqxhr.setRequestHeader(ew.API_JWT_AUTHORIZATION_HEADER,"Bearer "+ew.API_JWT_TOKEN);if(settings.type=="GET"||settings.contentType=="application/json"){var ar=settings.url.split("?"),params=new URLSearchParams(ar[1]);params.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);params.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN);ar[1]=params.toString();settings.url=ar[0]+(ar[1]?"?"+ar[1]:"")}else{if(settings.data instanceof FormData){settings.data.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);settings.data.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN)}else{var params=new URLSearchParams(settings.data);params.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);params.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN);settings.data=params.toString()}}}}));$document$1.ajaxStart((function(){$document$1.data("_ajax",true);$__default["default"]("form.ew-form").addClass("ew-wait").each((function(){var frm=forms.get(this.id);if(frm){if(!frm.multiPage||!frm.multiPage.lastPageSubmit)frm.disableForm()}}))}));function _ajaxStop(){$__default["default"]("form.ew-form.ew-wait").removeClass("ew-wait").each((function(){var frm=forms.get(this.id);if(frm){if(!frm.multiPage||!frm.multiPage.lastPageSubmit){frm.enableForm()}}}));$document$1.data("_ajax",false)}$document$1.ajaxStop(_ajaxStop).ajaxError(_ajaxStop);function executeScript(html,id){let matches=html.replace(/<head>[\s\S]*<\/head>/,"").matchAll(/<script([^>]*)>([\s\S]*?)<\/script\s*>/gi);Array.from(document.createRange().createContextualFragment(Array.from(matches).map((m=>m[0])).join("")).querySelectorAll("script:not([type]), script[type='text/javascript']")).sort(((s1,s2)=>s2.classList.contains("ew-apply-template")?1:s1.classList.contains("ew-apply-template")?-1:0)).forEach(((s,i)=>addScript(s,"scr_"+id+"_"+i)))}function stripScript(html){let matches=html.matchAll(/<script([^>]*)>([\s\S]*?)<\/script\s*>/gi);return Array.from(matches).filter((m=>document.createRange().createContextualFragment(m[0]).querySelector("script:not([type]), script[type='text/javascript']"))).reduce(((html,m)=>html.replace(m[0],"")),html)}function addScript(text,id){let scr=text instanceof HTMLScriptElement?text:document.createElement("SCRIPT");if($__default["default"].isString(text))scr.text=text;if(id)scr.id=id;return document.body.appendChild(scr)}function removeScript(id){if(id)$__default["default"]("script[id^='scr_"+id+"_']").remove()}function elementsToRow(fobj){var $fobj=$__default["default"](fobj),infix=$fobj.data("rowindex");infix=$__default["default"].isValue(infix)?infix:"";var row={index:infix};$fobj.find("[name^=x"+infix+"_]").each((function(){var elname="x_"+this.name.substr(infix.length+2);if($__default["default"].isObject(row[elname])){if($__default["default"].isArray(row[elname])){row[elname][row[elname].length]=this}else{row[elname]=[row[elname],this]}}else{row[elname]=this}}));return row}function getContent(html){let body=stripScript(html),m=body.match(/<body[\s\S]*>[\s\S]*<\/body>/i);body=m?m[0]:body;let $content=$__default["default"](body).find("section.content");return $content[0]?$content:$__default["default"](body)}function getOptions(obj){return obj.options?Array.prototype.map.call(obj.options,(opt=>[opt.value,opt.text])):[]}function enable2FA(){let url=ew.getApiUrl([ew.API_2FA_ACTION,ew.API_2FA_SHOW]);$body.css("cursor","wait");$__default["default"].get(url,(result=>{var _result$error2;if(result!=null&&result.url){_prompt({imageUrl:result.url,html:ew.language.phrase("Scan2FAQrCode"),input:"text",confirmButtonText:ew.language.phrase("Verify"),showLoaderOnConfirm:true,allowEscapeKey:false,allowOutsideClick:()=>!Swal.isLoading(),willOpen:()=>{Swal.showLoading(Swal.getConfirmButton());Swal.disableInput();Swal.getImage().onload=()=>{Swal.enableInput();Swal.hideLoading();Swal.getInput().focus()}},preConfirm:value=>$__default["default"].get(ew.getApiUrl([ew.API_2FA_ACTION,ew.API_2FA_VERIFY,value])).then((result=>{if((result==null?void 0:result.success)!==true)Swal.showValidationMessage(ew.language.phrase("2FAVerificationFailed"));return result})).catch((error=>Swal.showValidationMessage(error)))},(result=>{var _result$error;if(result!=null&&(_result$error=result.error)!=null&&_result$error.description){showToast(result.error.description)}else if(result!=null&&result.success){showToast(ew.language.phrase("2FAEnabled"),"success");$__default["default"]("#enable-2fa").addClass("d-none");$__default["default"]("#disable-2fa, #backup-codes").removeClass("d-none")}})).catch((err=>showToast(err==null?void 0:err.message)))}else if(result!=null&&(_result$error2=result.error)!=null&&_result$error2.description){_alert(result.error.description)}})).fail(((jqXHR,textStatus,errorThrown)=>showToast(errorThrown))).always((()=>$body.css("cursor","default")));return false}function disable2FA(){_prompt({html:ew.language.phrase("Disable2FAMsg"),preConfirm:value=>{if(value)return $__default["default"].get(ew.getApiUrl([ew.API_2FA_ACTION,ew.API_2FA_RESET])).then((result=>{var _result$error3;if(result!=null&&(_result$error3=result.error)!=null&&_result$error3.description)showToast(result.error.description);else if((result==null?void 0:result.success)!==true)showToast(ew.language.phrase("2FAResetFailed"));return result})).fail(((jqXHR,textStatus,errorThrown)=>showToast(errorThrown)))}},(result=>{var _result$error4;if(result!=null&&(_result$error4=result.error)!=null&&_result$error4.description){showToast(result.error.description)}else if(result!=null&&result.success){showToast(ew.language.phrase("2FADisabled"),"success");$__default["default"]("#enable-2fa").removeClass("d-none");$__default["default"]("#disable-2fa, #backup-codes").addClass("d-none")}})).catch((err=>showToast(err==null?void 0:err.message)))}function showBackupCodes(){let html="<p>"+ew.language.phrase("BackupCodesMsg")+"</p>";return _alert({title:ew.language.phrase("BackupCodes"),html:html,showDenyButton:true,showLoaderOnDeny:true,showCancelButton:true,confirmButtonText:ew.language.phrase("CopyToClipboard"),denyButtonText:ew.language.phrase("GetNewCodes"),customClass:{denyButton:"btn btn-primary ew-swal2-deny-button"},willOpen:()=>{Swal.showLoading();Swal.disableButtons();$__default["default"].get(ew.getApiUrl([ew.API_2FA_ACTION,ew.API_2FA_BACKUP_CODES])).then((result=>{if(result.success&&Array.isArray(result.codes)){Swal.update({html:html+'<textarea class="form-control ew-backup-codes" readonly>'+result.codes.join("\n")+"</textarea>"});Swal.enableButtons();Swal.getConfirmButton().focus()}})).fail(((jqXHR,textStatus,errorThrown)=>showToast(errorThrown))).always((()=>Swal.hideLoading()))},preConfirm:()=>{let codes=copyToClipboard(Swal.getHtmlContainer().querySelector("textarea"));if(codes)showToast(ew.language.phrase("CopiedToClipboard"),"success");return false},preDeny:async()=>{Swal.showLoading(Swal.getDenyButton());await $__default["default"].get(ew.getApiUrl([ew.API_2FA_ACTION,ew.API_2FA_NEW_BACKUP_CODES])).then((result=>{if(result.success&&Array.isArray(result.codes)){Swal.update({html:html+'<textarea class="form-control ew-backup-codes" readonly>'+result.codes.join("\n")+"</textarea>"});Swal.getConfirmButton().focus()}})).fail(((jqXHR,textStatus,errorThrown)=>showToast(errorThrown))).always((()=>Swal.hideLoading()));return false}})}function addOptionDialogShow(args){var _args$evt;args.lnk=args.lnk||((_args$evt=args.evt)==null?void 0:_args$evt.currentTarget);var _hide=function(){removeScript($dlg.data("args").el);var frm=$dlg.removeData("args").find(".modal-body form").data("form");if(frm)frm.destroyEditor();$dlg.find(".modal-body").html("");$dlg.find(".modal-footer .btn-primary").off();$dlg.data("showing",false)};var $dlg=ew.addOptionDialog||$__default["default"]("#ew-add-opt-dialog").on("hidden.bs.modal",_hide);if(!$dlg[0]){_alert("DIV #ew-add-opt-dialog not found.");return}if($dlg.data("showing"))return;$dlg.data("showing",true);var _submitSuccess=function(data){var _results;var results=data,args=$dlg.data("args"),frm=forms.get(args.lnk),objName=$dlg.find(".modal-body form input[name='"+ew.API_OBJECT_NAME+"']").val(),el=args.el,re=/^x(\d+)_/,m=el.match(re),prefix=m?m[0]:"x_",index=m?m[1]:-1,name=el.replace(re,"x_"),list=frm.getList(el);if($__default["default"].isString(data))results=parseJson(data);if((_results=results)!=null&&_results.success&&results[objName]){$dlg.modal("hide");var result=results[objName],form=frm.$element[0],obj=getElements(el,form);if(obj){var lf=list.linkField,dfs=list.displayFields.slice(),ffs=list.filterFields.slice(),pfs=list.parentFields.slice();pfs.forEach(((pf,i)=>{if(pf.split(" ").length==1)pfs[i]=pfs[i].replace(/^x_/,prefix)}));var lfv=lf!=""?result[lf]:"",row={lf:lfv};dfs.forEach(((df,i)=>{if(df in result)row["df"+(i||"")]=result[df]}));ffs.forEach(((ff,i)=>{if(ff in result)row["ff"+(i||"")]=result[ff]}));if(lfv&&dfs.length>0&&row["df"]){if(list.ajax===null)list.lookupOptions.push(row);var arp=pfs.map((pf=>getOptionValues(pf,form))),args={data:row,parents:arp,valid:true,name:getId(obj),form:form};$document$1.trigger("addoption",[args]);if(args.valid){var ar=getOptions(obj),txt=newOption(obj,row,form);if(obj.options){obj.options[obj.options.length-1].selected=true;if(obj.list){obj.render();$__default["default"](obj.target).find("input").last().trigger("focus")}if(isAutoSuggest(obj)){$__default["default"](obj).val(lfv).trigger("change");$__default["default"](obj.input).val(txt).trigger("focus")}else{$__default["default"](obj).trigger("change").trigger("focus")}}var $form=$__default["default"](form),suffix=$form.is("div")?"_"+$form.attr("id"):"";var cnt=$form.find("#key_count"+suffix).val();if(cnt>0){for(var i=1;i<=cnt;i++){if(i==index)continue;var obj2=getElements(name.replace(/^x/,"x"+i),form),ar2=getOptions(obj2);if(JSON.stringify(ar)!=JSON.stringify(ar2))continue;newOption(obj2,row,form);if(obj2.options&&obj.list)obj2.render()}}}}}}else{var _results2;if((_results2=results)!=null&&_results2.error){var _results$error;if($__default["default"].isString(results.error))_alert(results.error);else if($__default["default"].isString((_results$error=results.error)==null?void 0:_results$error.description))_alert(results.error.description)}else{var msg,$div=$__default["default"]("<div></div>").html(data).find("div.ew-message-dialog");if($div[0]){msg=$div.html()}else{var _results3;msg=((_results3=results)==null?void 0:_results3.failureMessage)||data;if(!msg||String(msg).trim()=="")msg=ew.language.phrase("InsertFailed")}_alert(msg)}}};var _fail=function(o){$dlg.modal("hide");_alert("Server Error "+o.status+": "+o.statusText)};var _submit=async function(e){let $dlg=ew.addOptionDialog,form=$dlg.find(".modal-body form")[0],frm=forms.get(form.id),btn=e?e.target:null,$btn=$__default["default"](btn);if(await frm.canSubmit()){$btn.prop("disabled",false).removeClass("disabled");$body.css("cursor","wait");$__default["default"].post(getApiUrl([ew.API_ADD_ACTION,form.elements[ew.API_OBJECT_NAME].value]),$__default["default"](form).serialize(),_submitSuccess).fail(_fail).always((function(){frm.enableForm();$btn.prop("disabled",false).removeClass("disabled");$body.css("cursor","default")}))}return false};$dlg.modal("hide");$dlg.data("args",args);var success=function(data){var frm=forms.get(args.lnk),prefix="x_",m=args.el.match(/^(x\d+_)/);if(m)prefix=m[1];var list=frm.getList(args.el),pfs=list.parentFields.slice().map((pf=>pf.split(" ").length==1?pf.replace(/^x_/,prefix):pf)),form=frm.htmlForm,ar=pfs.map((pf=>getOptionValues(pf,form))),ar2=pfs.map((pf=>getOptionTexts(pf,form))),ffs=list.filterFieldVars.slice();$dlg.find(".modal-title").html($__default["default"](args.lnk).closest(".ew-add-opt-btn").data("title"));$dlg.find(".modal-body").html(stripScript(data));var form=$dlg.find(".modal-body form")[0];if(form){$__default["default"](form).on("keydown",(function(e){if(e.key=="Enter"&&e.target.nodeName!="TEXTAREA")return _submit()}));ar.forEach(((v,i)=>{(function(){var obj=getElements(ffs[i],form);if(obj){if(obj.options||obj.length){$__default["default"](obj).first().one("updated",(()=>selectOption(obj,v)))}else{selectOption(obj,v)}}})()}))}ew.addOptionDialog=$dlg.modal("show");$dlg.find(".modal-footer .btn-primary").click(_submit).focus();executeScript(data,args.el);if(form){ar.forEach(((v,i)=>{var obj=getElements(ffs[i],form);if(obj){if(isAutoSuggest(obj)){obj.value=v[0];obj.input.value=ar2[i][0];obj.add(v[0],ar2[i][0],true)}else if(obj.options||obj.length);else{obj.value=v[0]}}}))}$dlg.trigger("load.ew")};$__default["default"].get(args.url,success).fail(_fail);return false}function modalDialogHide(e){var $dlg=$__default["default"](this),args=$dlg.data("args");removeScript("modal_dialog");var frm=$dlg.removeData("args").find(".modal-body form").data("form");frm==null?void 0:frm.destroyEditor();$dlg.find(".modal-footer .btn-primary").off();$dlg.find(".modal-dialog").removeClass(((i,className)=>{var m=className.match(/table\-\w+/);return m?m[0]:""}));$dlg.data({showing:false,url:null});if(args!=null&&args.reload)window.location.reload()}function modalDialogShow(args){var _args$evt2,_bootstrap$Tooltip$ge4,_args$evt3,_args$evt3$currentTar,_args$evt4,_args$evt4$currentTar;args.lnk=args.lnk||((_args$evt2=args.evt)==null?void 0:_args$evt2.currentTarget);(_bootstrap$Tooltip$ge4=bootstrap.Tooltip.getInstance(args.lnk))==null?void 0:_bootstrap$Tooltip$ge4.hide();var f=args.f||((_args$evt3=args.evt)==null?void 0:(_args$evt3$currentTar=_args$evt3.currentTarget)==null?void 0:_args$evt3$currentTar.form);if(f&&!keySelected(f)){_prompt({html:'<p class="text-danger">'+ew.language.phrase("NoRecordSelected")+"</p>",icon:"warning"});return false}var url=args.url||((_args$evt4=args.evt)==null?void 0:(_args$evt4$currentTar=_args$evt4.currentTarget)==null?void 0:_args$evt4$currentTar.dataset.url),$dlg=ew.modalDialog||$__default["default"]("#ew-modal-dialog").on("hidden.bs.modal",modalDialogHide);if($dlg.data("showing")&&$dlg.data("url")==url)return false;$dlg.data({showing:true,url:url});args.reload=false;var size=args.size||"modal-lg";$dlg.find(".modal-dialog").removeClass("modal-sm modal-md modal-lg modal-xl").addClass(size);var _ask=function(){var args=$dlg.data("args");if($__default["default"].isNull(args.ask))return"";else if(args.ask&&args.ask!="")return args.ask};var _caption=function(){var args=$dlg.data("args"),$lnk=$__default["default"](args.lnk);return args.caption||$lnk.data("caption")||$lnk.data("original-title")||""};var _button=function(){var args=$dlg.data("args");if($__default["default"].isNull(args.btn))return"";else if(args.btn&&args.btn!="")return ew.language.phrase(args.btn);else return _caption()};var _fail=function(o){$dlg.modal("hide");if(o.status)_alert("Server Error "+o.status+": "+o.statusText)};var _always=function(o){$body.css("cursor","default")};var _current=function(url){var a=$__default["default"]("<a>",{href:url})[0];return window.location.pathname.endsWith(a.pathname)};var handleResult=function(result){var cb=null,url=result.url,reload=result.reload;if(url||reload){cb=function(){if(url){if(result.modal&&!_current(url)){var args=$dlg.data("args");args.reload=true;if(result.caption)args.caption=result.caption;args.btn=result.view?null:"";$dlg.data("args",args);url+=(url.split("?").length>1?"&":"?")+"modal=1&rnd="+random();$body.css("cursor","wait");$__default["default"].get(url).done(success).fail(_fail).always(_always)}else{$dlg.modal("hide");window.location=sanitizeUrl(url)}}else if(reload){$dlg.modal("hide");window.location.reload()}}}if($__default["default"].isString(result.failureMessage)){_alert(result.failureMessage)}else if($__default["default"].isString(result.warningMessage)){_alert(result.warningMessage,cb,"warning")}else if($__default["default"].isString(result.message)){_alert(result.message,cb,"body")}else if($__default["default"].isString(result.successMessage)){_alert(result.successMessage,cb,"success")}else if(result.error){var _result$error5,_result$error6;if($__default["default"].isString(result.error))_alert(result.error);else if($__default["default"].isString((_result$error5=result.error)==null?void 0:_result$error5.message))_alert(result.error.message);else if($__default["default"].isString((_result$error6=result.error)==null?void 0:_result$error6.description))_alert(result.error.description)}else if(cb){cb()}};var _submitSuccess=function(data){var result=parseJson(data);if($__default["default"].isObject(result)){handleResult(result)}else{var body=getContent(data);if(body.length){var $bd=$dlg.find(".modal-body").html(body);var footer="";var cf=$bd.find("#confirm");var ct=$bd.find("#conflict");if((ct==null?void 0:ct.val())=="1"){footer+='<button type="button" id="btn-overwrite" class="btn btn-primary ew-btn">'+ew.language.phrase("OverwriteBtn")+"</button>";footer+='<button type="button" id="btn-reload" class="btn btn-default ew-btn">'+ew.language.phrase("ReloadBtn")+"</button>";footer+='<button type="button" class="btn btn-default ew-btn" data-bs-dismiss="modal">'+ew.language.phrase("CancelBtn")+"</button>";$dlg.find(".modal-footer").html(footer);$dlg.find(".modal-footer #btn-overwrite").on("click",{action:"overwrite"},_submit);$dlg.find(".modal-footer #btn-reload").on("click",{action:"show"},_submit)}else if((cf==null?void 0:cf.val())=="confirm"){footer+='<button type="button" class="btn btn-primary ew-btn">'+ew.language.phrase("ConfirmBtn")+"</button>";footer+='<button type="button" class="btn btn-default ew-btn">'+ew.language.phrase("CancelBtn")+"</button>";$dlg.find(".modal-footer").html(footer);$dlg.find(".modal-footer .btn-primary").click(_submit).focus();$dlg.find(".modal-footer .btn-default").on("click",{action:"cancel"},_submit)}else{var $btn=$dlg.find(".card-body button[type=submit], .modal-footer .btn-primary").first().addClass("ew-submit").click(_submit);if(!$btn[0]){var btn=_button();if(btn)footer+='<button type="button" class="btn btn-primary ew-btn">'+btn+"</button>";footer+='<button type="button" class="btn btn-default ew-btn" data-bs-dismiss="modal">'+ew.language.phrase("CancelBtn")+"</button>";$dlg.find(".modal-footer").html(footer);$dlg.find(".modal-footer .btn-primary").addClass("ew-submit").click(_submit).focus()}}executeScript(data,"modal_dialog");$dlg.trigger("load.ew")}else if(data){$dlg.modal("hide");_alert(data)}}};var _submit=async function(e){var form=$dlg.find(".modal-body form")[0],$form=$__default["default"](form),frm=forms.get(form.id),action=e!=null&&e.data?e.data.action:null,btn=e?e.target:null;if(btn){if(btn.classList.contains("disabled"))return false;frm.enableForm=function(){$__default["default"](btn).prop("disabled",false).removeClass("disabled")};frm.disableForm=function(){$__default["default"](btn).prop("disabled",true).addClass("disabled")}}var input=form.elements["action"];if(action&&input)input.value=action;if(action=="cancel"){$__default["default"].post($form.attr("action"),$form.serialize(),success).fail(_fail).always(_always)}else if(await frm.canSubmit()){if(args.ask=="1"||_ask()=="1"){$(btn).prop("disabled",false).removeClass("disabled");ew.prompt({html:ew.language.phrase("MessageConfirmSaveMessage"),showCancelButton:true,icon:"question"},(result=>{if(result){if($form.hasClass("ew-login-form")){frm.submit()}else{$body.css("cursor","wait");$__default["default"].post($form.attr("action"),$form.serialize(),_submitSuccess).fail(_fail).always((function(){frm.enableForm();_always()}))}}}))}else{if($form.hasClass("ew-login-form")){frm.submit()}else{$body.css("cursor","wait");$__default["default"].post($form.attr("action"),$form.serialize(),_submitSuccess).fail(_fail).always((function(){frm.enableForm();_always()}))}}}return false};$dlg.modal("hide");$dlg.data("args",args);var success=function(data){var result=parseJson(data);if($__default["default"].isObject(result)){handleResult(result)}else{var args=$dlg.data("args");var $lnk=$__default["default"](args.lnk);url=url.substring(0,url.indexOf("#")==-1?url.length:url.indexOf("#"));url=url.substring(0,url.indexOf("?")==-1?url.length:url.indexOf("?"));url=url.substring(url.lastIndexOf("/")+1,url.length);var current_page=url;var help_online_url="";if(ew.MS_SHOW_HELP_ONLINE==1){help_online_url="&nbsp;<a href='javascript:void(0);' id='helponline' onclick='getHelp(\""+current_page+"\");' title='"+ew.language.phrase("Help")+"'><span class='fa fa-question-circle ew-icon'></span></a>"}$dlg.find(".modal-title").html(_caption()+help_online_url);var footer="";var btn=_button();if(btn)footer+='<button type="button" class="btn btn-primary ew-btn">'+btn+"</button>";if(footer!="")footer+='<button type="button" class="btn btn-default ew-btn" data-bs-dismiss="modal">'+ew.language.phrase("CancelBtn")+"</button>";else footer='<button type="button" class="btn btn-default ew-btn" data-bs-dismiss="modal">'+ew.language.phrase("CloseBtn")+"</button>";$dlg.find(".modal-footer").html(footer).toggle(args.footer!==false);var body=getContent(data);$dlg.find(".modal-body").html(body);var table=$lnk.data("table");if(table)$dlg.find(".modal-dialog").addClass("table-"+table);var $btn=$dlg.find(".card-body button[type=submit], .modal-footer .btn-primary").first().addClass("ew-submit").click(_submit);$dlg.find(".modal-body form").on("keydown",(function(e){if(e.key=="Enter"&&e.target.nodeName!="TEXTAREA"){$btn.click();return false}}));ew.modalDialog=$dlg.modal("show");executeScript(data,"modal_dialog");let modal=bootstrap.Modal.getInstance($dlg[0]);if(!modal._focustrap.__handleFocusin){modal._focustrap.__handleFocusin=modal._focustrap._handleFocusin;modal._focustrap._handleFocusin=function(e){var _e$target10;if((_e$target10=e.target)!=null&&_e$target10.matches("[class^=cke_dialog_]"))return;this.__handleFocusin(e)}}$dlg.trigger("load.ew");$btn.focus()}};$body.css("cursor","wait");if(f){var $f=$__default["default"](f);if(!f.elements.modal)$__default["default"]("<input>").attr({type:"hidden",name:"modal",value:"1"}).appendTo($f);$__default["default"].post(url,$f.serialize(),success).fail(_fail).always(_always)}else{url+=(url.split("?").length>1?"&":"?")+"modal=1&rnd="+random();$__default["default"].get(url,success).fail(_fail).always(_always)}return false}function importDialogShow(args){var _args$evt5,_bootstrap$Tooltip$ge5;args.lnk=args.lnk||((_args$evt5=args.evt)==null?void 0:_args$evt5.currentTarget);(_bootstrap$Tooltip$ge5=bootstrap.Tooltip.getInstance(args.lnk))==null?void 0:_bootstrap$Tooltip$ge5.hide();var $dlg=ew.importDialog||$__default["default"]("#ew-import-dialog");if(!$dlg[0]){_alert("DIV #ew-import-dialog not found.");return false}var $input=$dlg.find("#importfiles"),$dropzone=$input.closest(".ew-file-drop-zone"),$bd=$dlg.find(".modal-body"),$data=$bd.find(":input[id!=importfiles]"),$message=$bd.find(".message"),$progress=$bd.find(".progress"),timer;var enableButtons=function(){$dlg.find(".modal-footer .btn").prop("disabled",false)};var showMessage=function(msg,classname){var $msg=$__default["default"]("<div>"+msg+"</div>");if(classname)$msg.addClass(classname);$message.removeClass("d-none").html($msg);if(classname=="text-danger")enableButtons()};var hideMessage=function(){$message.addClass("d-none").html("")};var showProgress=function(pc,classname){$progress.removeClass("d-none").find(".progress-bar").removeClass("bg-success bg-info").addClass(classname||"bg-success").attr("aria-valuenow",pc).css("width",pc+"%").html(pc+"%")};var hideProgress=function(){$progress.addClass("d-none").find(".progress-bar").attr("aria-valuenow",0).css("width","0%").html("0%")};var uploadProgress=function(data){var pc=parseInt(100*data.loaded/data.total);showProgress(pc,"bg-primary");if(pc===100){showMessage(ew.language.phrase("ImportMessageUploadComplete"),"text-primary")}else{showMessage(ew.language.phrase("ImportMessageUploadProgress").replace("%p",pc),"text-primary")}};var updateProgress=function(result){try{var cnt=parseInt(result.count),tcnt=parseInt(result.totalCount),filename=result.file;if(tcnt>0&&$dlg.find(".modal-footer .ew-close-btn").data("import-progress")){var pc=parseInt(100*cnt/tcnt);showProgress(pc);showMessage(ew.language.phrase("ImportMessageProgress").replace("%t",tcnt).replace("%c",cnt).replace("%f",filename),"text-primary")}}catch(e){}};var importProgress=function(){var url=getApiUrl(ew.API_PROGRESS_ACTION),data={rnd:random()};data[ew.API_FILE_TOKEN_NAME]=$input.data(ew.API_FILE_TOKEN_NAME);$__default["default"].get(url,data,updateProgress,"json")};var importComplete=function(result){var maxErrorCount=5;var msg="";showProgress(100);var fileResults=result.files;$dlg.find(".modal-footer .ew-close-btn").data("import-progress",false);if(Array.isArray(fileResults)){for(var i=0,len=fileResults.length;i<len;i++){var fileResult=fileResults[i],tcnt=fileResult.totalCount||0,cnt=fileResult.count||0,scnt=fileResult.successCount||0,fcnt=fileResult.failCount||0;if(msg!="")msg+="<br>";if(fileResult.success){msg+=ew.language.phrase("ImportMessageSuccess").replace("%t",tcnt).replace("%c",cnt).replace("%f",fileResult.file)}else{msg+=ew.language.phrase("ImportMessageError1").replace("%t",tcnt).replace("%c",cnt).replace("%f",fileResult.file).replace("%s",scnt).replace("%e",fcnt);if(fileResult.error)msg+=ew.language.phrase("ImportMessageError2").replace("%e",fileResult.error);var showLog=true;if(fileResult.failList){var ecnt=0;for(var i=1;i<=cnt;i++){if(fileResult.failList["row"+i]){ecnt+=1;msg+="<br>"+ew.language.phrase("ImportMessageError3").replace("%i",i).replace("%d",fileResult.failList["row"+i])}if(ecnt>=maxErrorCount)break}if(fcnt>maxErrorCount)msg+="<br>"+ew.language.phrase("ImportMessageMore").replace("%s",fcnt-maxErrorCount);else showLog=false}if(fileResult.log&&showLog)msg+="<br>"+ew.language.phrase("ImportMessageError4").replace("%l",fileResult.log);showMessage(msg,"text-danger")}}}if(result.success){showMessage(msg,"text-success");$dlg.find(".modal-footer .ew-close-btn").data("imported",true)}else{if(result.error)msg=result.error;showMessage(msg,"text-danger")}hideProgress()};var importFail=function(o){$dlg.find(".modal-footer .ew-close-btn").data("import-progress",false);showMessage(ew.language.phrase("ImportMessageServerError").replace("%s",o.status).replace("%t",o.statusText),"text-danger")};var importFiles=function(filetoken){$body.css("cursor","wait");$input.data(ew.API_FILE_TOKEN_NAME,filetoken);$dlg.find(".modal-footer .ew-close-btn").data("import-progress",true);var data=ew.API_ACTION_NAME+"=import&"+ew.API_FILE_TOKEN_NAME+"="+encodeURIComponent(filetoken);if($data.length)data+="&"+$data.serialize();$__default["default"].ajax(currentPage(),{data:data,method:"POST",dataType:"json",beforeSend:function(xhr,settings){timer=$__default["default"].later(100,null,importProgress,null,true)}}).done(importComplete).fail(importFail).always((function(){$body.css("cursor","default");if(timer)timer.cancel()}))};var options=ew.importUploadOptions;if(!options.acceptFileTypes)options.acceptFileTypes=new RegExp("\\.("+ew.IMPORT_FILE_ALLOWED_EXTENSIONS.replace(/,/g,"|")+")$","i");if(!$input.data("blueimpFileupload")){$input.fileupload(Object.assign({url:getApiUrl(ew.API_UPLOAD_ACTION),dataType:"json",autoUpload:true,singleFileUploads:false,dropZone:$dropzone,messages:{acceptFileTypes:ew.language.phrase("UploadErrMsgAcceptFileTypes"),maxFileSize:ew.language.phrase("UploadErrMsgMaxFileSize"),maxNumberOfFiles:ew.language.phrase("UploadErrMsgMaxNumberOfFiles"),minFileSize:ew.language.phrase("UploadErrMsgMinFileSize")},beforeSend:function(jqxhr,settings){settings.data.set("session",ew.SESSION_ID);settings.data.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);settings.data.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN);if(ew.API_JWT_TOKEN&&!ew.IS_WINDOWS_AUTHENTICATION)jqxhr.setRequestHeader(ew.API_JWT_AUTHORIZATION_HEADER,"Bearer "+ew.API_JWT_TOKEN)},done:function(e,data){var _data$result,_data$result$files;if(Array.isArray(data==null?void 0:(_data$result=data.result)==null?void 0:(_data$result$files=_data$result.files)==null?void 0:_data$result$files.importfiles)){var ok=true;data.result.files.importfiles.forEach((function(file,index){if(file.error){showMessage(ew.language.phrase("ImportMessageUploadError").replace("%f",file.name).replace("%s",file.error),"text-danger");ok=false}}));if(ok)importFiles(data.result[ew.API_FILE_TOKEN_NAME])}},change:function(e,data){hideMessage()},processfail:function(e,data){data.files.forEach((function(file,index){if(file.error)showMessage(ew.language.phrase("ImportMessageUploadError").replace("%f",file.name).replace("%s",file.error),"text-danger")}))},fail:function(e,data){showMessage(ew.language.phrase("ImportMessageServerError").replace("%s",data.textStatus).replace("%t",data.errorThrown),"text-danger")},progressall:function(e,data){uploadProgress(data)}},options))}$dlg.modal("hide").find(".modal-title").html(args.hdr);$dlg.find(".modal-footer .ew-close-btn").off("click.ew").on("click.ew",(function(){var $this=$__default["default"](this);if($this.data("imported")){$this.data("imported",false);window.location.reload()}}));hideMessage();ew.importDialog=$dlg.modal("show");return false}function autoFill(el){var f=forms.get(el).$element[0];if(!f)return;var ar=getOptionValues(el),id=getId(el),m=id.match(/^([xy])(\d*)_/),rowindex=m?m[2]:"",list=forms.get(el).getList(id),dest_array=list.autoFillTargetFields;var success=function(data){let results=data==null?void 0:data.records,result=Array.isArray(results)&&results.length>0?results[0]:[];for(let j=0;j<dest_array.length;j++){let destEl=getElements(dest_array[j].replace(/^x_/,"x"+rowindex+"_"),f);if(destEl){let val=$__default["default"].isValue(result["af"+j])?String(result["af"+j]):"",args={results:results,result:result,data:val,form:f,name:id,target:dest_array[j],cancel:false,trigger:true};$__default["default"](el).trigger("autofill",[args]);if(args.cancel)continue;val=args.data;if(destEl.options){selectOption(destEl,val.split(","));if(isAutoSuggest(destEl)){destEl.input.value=val;updateOptions.call(forms.get(f.id),destEl)}}else if(isHiddenTextArea(destEl)){destEl.value=val;$__default["default"](destEl).data("editor").set()}else if(destEl.type=="checkbox"){destEl.checked=convertToBool(val)}else{destEl.value=val}if(args.trigger)$__default["default"](destEl).trigger("change")}}return result};if(ar.length>0&&ar[0]!=""){var data=Object.assign({page:list.page,field:list.field,ajax:"autofill",v0:ar[0],language:ew.LANGUAGE_ID},getUserParams("#p_"+id,f));var parentId=list.parentFields.slice();if(rowindex!=""){for(var i=0,len=parentId.length;i<len;i++){var ar=parentId[i].split(" ");if(ar.length==1)parentId[i]=parentId[i].replace(/^x_/,"x"+rowindex+"_")}}var arp=parentId.map((function(pid){return getOptionValues(pid,f)}));for(var i=0,cnt=arp.length;i<cnt;i++)data["v"+(i+1)]=arp[i].join(ew.MULTIPLE_OPTION_SEPARATOR);return $__default["default"].post(getApiUrl(ew.API_LOOKUP_ACTION),data,success,"json")}return success()}function tooltip(i,el){var $this=$__default["default"](el),$tt=$__default["default"]("#"+$this.data("tooltip-id")),trig=$this.data("trigger")||"hover",dir=$this.data("placement")||"auto";if(!$tt[0]||$tt.text().trim()==""&&!$tt.find("img[src!='']")[0])return;if(!bootstrap.Popover.getInstance(el)){$this.popover({html:true,placement:dir,trigger:trig,delay:100,container:document.getElementById("ew-tooltip"),content:$tt.html(),sanitizeFn:ew.sanitizeFn}).on("show.bs.popover",(function(e){var wd=$this.data("tooltip-width");if(wd)$__default["default"](bootstrap.Popover.getInstance(el).getTipElement()).css("max-width",parseInt(wd,10)+"px")}))}}function emailDialogShow(args){var $dlg=ew.emailDialog||$__default["default"]("#ew-email-dialog").on("shown.bs.modal",(e=>setTimeout((()=>{var _e$target$querySelect;return(_e$target$querySelect=e.target.querySelector(".modal-body .form-control"))==null?void 0:_e$target$querySelect.focus()}),200))).on("click",".modal-footer .btn-primary",(function(e){var _$$closest$find$data;e.preventDefault();if((_$$closest$find$data=$__default["default"](this).closest(".modal").find(".modal-body form").data("form"))!=null&&_$$closest$find$data.submit())$dlg.modal("hide")}));if(!$dlg[0]){_alert("DIV #ew-email-dialog not found.");return false}var form=args.evt.currentTarget.form;if(args.sel&&!keySelected(form)){_alert({html:ew.language.phrase("NoRecordSelected"),icon:"warning"});return false}var $f=$dlg.find(".modal-body form"),frm=$f.data("form");if(!frm){frm=new Form($f.attr("id"));frm.addFields([["sender",[ew.Validators.required(ew.language.phrase("Sender")),ew.Validators.email]],["recipient",[ew.Validators.required(ew.language.phrase("Recipient")),ew.Validators.emails(ew.MAX_EMAIL_RECIPIENT,ew.language.phrase("EnterProperRecipientEmail"))]],["cc",ew.Validators.emails(ew.MAX_EMAIL_RECIPIENT,ew.language.phrase("EnterProperCcEmail"))],["bcc",ew.Validators.emails(ew.MAX_EMAIL_RECIPIENT,ew.language.phrase("EnterProperBccEmail"))],["subject",ew.Validators.required(ew.language.phrase("Subject"))]]);frm.validate=function(){return this.validateFields()};frm.submit=function(){if(!this.validate())return false;var data=[$f.serialize()];if(form&&args.sel)data.push($__default["default"](form).find("input[type=checkbox][name='key_m[]']:checked").serialize());if(args.key)data.push($__default["default"].param(args.key));var fobj=this.getForm();if(args.url){$dlg.modal("hide");if(args.exportid)ew.exportWithCharts(args.url,args.exportid,fobj);else _export(args.evt,args.url,"email",true,args.sel,fobj)}else{$__default["default"].post(form.getAttribute("action"),data.join("&"),(result=>showMessage(result)))}return true};$f.data("form",frm)}ew.emailDialog=$dlg.modal("hide").find(".modal-title").html(args.hdr).end().modal("show");return false}function showDrillDown(e,obj,url,id,hdr){if(e!=null&&e.ctrlKey){var arUrl=url.split("?"),params=new URLSearchParams(arUrl[1]);params.set("d","2");return redirect(arUrl[0]+"?"+params.toString())}var $obj=$__default["default"](obj);var pos=$obj.data("drilldown-placement")||"auto";var args={obj:$obj[0],placement:pos,id:id,url:url,hdr:hdr};$document$1.trigger("drilldown",[args]);var ar=args.url.split("?");args.file=ar[0]||"";args.data=ar[1]||"";if(!bootstrap.Popover.getInstance(obj)){$obj.popover({html:true,placement:args.placement,trigger:"manual",title:args.hdr,template:'<div class="popover" role="tooltip"><h3 class="popover-header d-none" style="cursor: move;"></h3><div class="popover-body"></div></div>',content:'<div class="'+ew.spinnerClass+' m-3 ew-loading" role="status"><span class="visually-hidden">'+ew.language.phrase("Loading")+"</span></div>",container:$__default["default"]("#ew-drilldown-panel").draggable(ew.draggableOptions),sanitizeFn:ew.sanitizeFn,boundary:"viewport"}).on("show.bs.popover",(function(e){$obj.attr("data-original-title","")})).on("shown.bs.popover",(function(e){if(!$obj.data("args"))return;var data=$obj.data("args").data;$__default["default"].ajax({cache:false,dataType:"html",type:"POST",data:data,url:$obj.data("args").file,success:function(data){var $tip=$__default["default"](bootstrap.Popover.getInstance(obj).getTipElement());if(args.hdr)$tip.find(".popover-header").empty().removeClass("d-none").append('<button type="button" class="btn-close" aria-label="'+ew.language.phrase("CloseBtn")+'"></button>'+args.hdr).find(".btn-close").on("click",(function(){$obj.popover("hide")}));var m=data.match(/<body[^>]*>([\s\S]*?)<\/body\s*>/i);data=m?m[0]:data;var html=ew.stripScript(data);$tip.find(".popover-body").html($__default["default"]("<div></div>").html(html).find("#ew-report")).find(".ew-table").each(ew.setupTable);ew.executeScript(data,id);$obj.popover("update")},error:function(o){if(o.responseText){if($__default["default"].isString(o.responseText)&&o.responseText.startsWith("{")&&o.responseText.endsWith("}")){var _result$error7,_result$error8;var result=parseJson(o.responseText);if(result!=null&&(_result$error7=result.error)!=null&&_result$error7.type&&result!=null&&(_result$error8=result.error)!=null&&_result$error8.description){bootstrap.Popover.getInstance(obj).hide();return _alert({title:result.error.type,html:result.error.description,customClass:{title:"ew-swal2-title text-danger",htmlContainer:"ew-swal2-html-container text-danger"}})}}var $tip=$__default["default"](bootstrap.Popover.getInstance(obj).getTipElement());$tip.find(".popover-body").empty().append('<p class="text-danger">'+o.responseText+"</p>")}}})})).on("hidden.bs.popover",(function(e){ew.removeScript(id)}))}$obj.data("args",args).popover("show")}function ajax(data,callback){if(!$__default["default"].isObject(data)||!data.url&&!data.action)return undefined;var action;if(data.url){if(data.url.startsWith(getApiUrl()))action=data.url.replace(getApiUrl(),"").split("/")[0];else if(data.url.startsWith(ew.API_URL))action=data.url.replace(ew.API_URL,"").split("/")[0]}else{action=data.action;delete data.action}var obj=Object.assign({},data);var _convert=response=>{if($__default["default"].isObject(response)&&response.result=="OK"){var results=response.records;if(Array.isArray(results)&&results.length==1){results=results[0];if(Array.isArray(results)&&results.length==1)return results[0];else return results}return results}return response};var url=obj.url||getApiUrl(action),type=obj.type||([ew.API_LIST_ACTION,ew.API_VIEW_ACTION,ew.API_DELETE_ACTION].includes(action)?"GET":"POST");delete obj.url;delete obj.type;obj.dataType="json";if(isFunction$2(callback)){$__default["default"].ajax({url:url,type:type,data:obj,success:function(response){callback(_convert(response))}})}else{var response=$__default["default"].ajax({url:url,async:false,type:type,data:obj});return _convert(response.responseJSON)}}function currentPage(){return location.href.split("#")[0].split("?")[0]}function toggleSearchOperator(e,id,value){var el=e.currentTarget.form.elements[id];if(!el)return;el.value=el.value!=value?value:"="}function toggleLayout(el){var _bootstrap$Tooltip$ge6;(_bootstrap$Tooltip$ge6=bootstrap.Tooltip.getInstance(el))==null?void 0:_bootstrap$Tooltip$ge6.hide();$body.css("cursor","wait");let layout=el.dataset.layout,grid=document.querySelector(".ew-multi-column-grid"),$grid=$__default["default"](grid);$grid.load(sanitizeUrl(el.dataset.url+ew.PAGE_LAYOUT+"="+layout)+" .ew-multi-column-grid",((response,status,xhr)=>{if(status=="error"){_alert(xhr.status+" "+xhr.statusText)}else{var _document$createRange,_document$createRange2;removeScript(layout);executeScript((_document$createRange=(_document$createRange2=document.createRange().createContextualFragment(response).querySelector(".ew-multi-column-grid"))==null?void 0:_document$createRange2.innerHTML)!=null?_document$createRange:"",layout);ew.initPage({target:grid});$body.css("cursor","default");$grid.trigger("layout")}}))}function copyToClipboard(source){var _source,_source2;source=$__default["default"].isString(source)?document.querySelector(source):source;const str=((_source=source)==null?void 0:_source.value)||((_source2=source)==null?void 0:_source2.innerText);if(str){const el=document.createElement("textarea");el.value=str;el.setAttribute("readonly","");el.style.position="absolute";el.style.left="-9999px";document.body.appendChild(el);el.select();document.execCommand("copy");document.body.removeChild(el)}return str}function checkInteger(object_value){if(!object_value||object_value.length==0)return true;if(object_value.includes(ew.DECIMAL_SEPARATOR))return false;return checkNumber(object_value)}function checkNumber(object_value){object_value=String(object_value);if(!object_value||object_value.length==0)return true;object_value=object_value.trim();return ew.parseNumber(object_value)!==null}function escapeRegExChars(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function checkRange(object_value,min_value,max_value){if(!object_value||object_value.length==0)return true;if($__default["default"].isNumber(min_value)||$__default["default"].isNumber(max_value)){if(checkNumber(object_value))object_value=ew.parseNumber(object_value)}if(!$__default["default"].isNull(min_value)&&object_value<min_value)return false;if(!$__default["default"].isNull(max_value)&&object_value>max_value)return false;return true}function checkPhone(object_value){if(!object_value||object_value.length==0)return true;return/^\(\d{3}\) ?\d{3}( |-)?\d{4}|^\d{3}( |-)?\d{3}( |-)?\d{4}$/.test(object_value.trim())}function checkZip(object_value){if(!object_value||object_value.length==0)return true;return/^\d{5}$|^\d{5}-\d{4}$/.test(object_value.trim())}function checkCreditCard(object_value){if(!object_value||object_value.length==0)return true;var creditcard_string=object_value.replace(/\D/g,"");if(creditcard_string.length==0)return false;var doubledigit=creditcard_string.length%2==1?false:true;var tempdigit,checkdigit=0;for(var i=0,len=creditcard_string.length;i<len;i++){tempdigit=parseInt(creditcard_string.charAt(i),10);if(doubledigit){tempdigit*=2;checkdigit+=tempdigit%10;if(tempdigit/10>=1)checkdigit++;doubledigit=false}else{checkdigit+=tempdigit;doubledigit=true}}return checkdigit%10==0}function checkSsn(object_value){if(!object_value||object_value.length==0)return true;return/^(?!000)([0-6]\d{2}|7([0-6]\d|7[012]))([ -]?)(?!00)\d\d\3(?!0000)\d{4}$/.test(object_value.trim())}function checkEmails(object_value,email_cnt){if(!object_value||object_value.length==0)return true;var arEmails=object_value.replace(/,/g,";").split(";");for(var i=0,len=arEmails.length;i<len;i++){if(email_cnt>0&&len>email_cnt)return false;if(!checkEmail(arEmails[i]))return false}return true}function checkEmail(object_value){if(!object_value||object_value.length==0)return true;return/^[\w.%+-]+@[\w.-]+\.[A-Z]{2,18}$/i.test(object_value.trim())}function checkGuid(object_value){if(!object_value||object_value.length==0)return true;return/^(\{\w{8}-\w{4}-\w{4}-\w{4}-\w{12}\}|\w{8}-\w{4}-\w{4}-\w{4}-\w{12})$/.test(object_value.trim())}function checkUrl(object_value){if(!object_value||object_value.length==0)return true;try{new URL(object_value)}catch(e){return false}return true}function checkByRegEx(object_value,pattern){if(!object_value||object_value.length==0)return true;return!!object_value.match(pattern)}function showMessage(arg){var _arg$target;let doc,swal;try{let win=window.parent;doc=win.document;swal=win.Swal}catch(e){doc=window.document;swal=window.Swal}let p=(_arg$target=arg==null?void 0:arg.target)!=null?_arg$target:doc,$div=$__default["default"](p).find("div.ew-message-dialog:hidden").first(),msg=$div.length?$div.text():"";if($__default["default"].isString(arg))msg=$__default["default"]("<div>"+arg.trim()+"</div>").text();if(msg.trim()=="")return;if($div.length&&!ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST){["success","info","warning","danger"].forEach((function(value,index){let $alert=$div.find(".alert-"+value).toggleClass("alert-"+value),$heading=$alert.find(".alert-heading").detach(),$content=$alert.children(":not(.icon)");$alert.find(".icon").remove();if($alert[0]){let w=parseInt($content.css("width"),10);if(w>0)$content.first().css("width","auto");let $toast=toast({class:"ew-toast bg-"+value,title:$heading[0]?$heading.html():ew.language.phrase(value),body:$alert.html(),autohide:value=="success"?ew.autoHideSuccessMessage:false,delay:value=="success"?ew.autoHideSuccessMessageDelay:500});if(w>0)$toast.css("max-width",w);return}}))}if($div.length&&ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST){["success","info","warning","danger"].forEach((function(value,index){var $alert=$div.find(".alert-"+value).toggleClass("alert-"+value),$heading=$alert.find(".alert-heading").detach(),$content=$alert.children(":not(.icon)");var delay;delay=value=="success"?ew.autoHideSuccessMessageDelay:0;if($alert[0]){if(value=="danger")value="error";swal.fire({html:msg,icon:value,timer:delay});return}}))}else if(!ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST&&$__default["default"].isString(arg)){return swal.fire({...ew.sweetAlertSettings,html:arg})}}function random(){return Math.floor(Math.random()*100001)+1e5}function upload(input){var $input=$__default["default"](input);if($input.data("blueimpFileupload"))return;var id=$input.attr("name"),nid=id.replace(/\$/g,"\\$"),tbl=$input.data("table"),multiple=$input.is("[multiple]"),$dropzone=$input.closest(".ew-file-drop-zone"),$p=$input.closest(fieldContainerSelector),readonly=$input.prop("disabled")||$input.closest("form").find("#confirm").val()=="confirm",$ft=$p.find("#ft_"+nid),$fn=$p.find("#fn_"+nid),$fa=$p.find("#fa_"+nid),$fs=$p.find("#fs_"+nid),$exts=$p.find("#fx_"+nid),$maxsize=$p.find("#fm_"+nid),$maxfilecount=$p.find("#fc_"+nid),$label=$p.find(".ew-file-label"),label=$label.html();var _done=function(e,data){if(data.result.files[0].error)return;var name=data.result.files[0].name;var ar=multiple?$fn.val()?$fn.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[]:[];ar.push(name);$fn.val(ar.join(ew.MULTIPLE_UPLOAD_SEPARATOR));$fa.val("0");if(!multiple)$ft.find("tbody > tr:not(:last-child)").remove()};var _deleted=function(e,data){var url=$__default["default"](e.originalEvent.target).data("url"),param=new URLSearchParams(url.split("?")[1]),fid=param.get("id"),name=param.get(fid);if(name){var ar=$fn.val()?$fn.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[];var index=ar.indexOf(name);if(index>-1)ar.splice(index,1);$fn.val(ar.join(ew.MULTIPLE_UPLOAD_SEPARATOR));$fa.val("0")}};var _change=function(e,data){var _data$files;$ft.toggleClass("ew-has-rows",((_data$files=data.files)==null?void 0:_data$files.length)>0);var ar=$fn.val()?$fn.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[];for(var i=0;i<data.files.length;i++)ar.push(data.files[i].name);var cnt=parseInt($maxfilecount.val(),10);if($__default["default"].isNumber(cnt)&&cnt>0&&ar.length>cnt){_alert(ew.language.phrase("UploadErrMsgMaxNumberOfFiles"));return false}var l=parseInt($fs.val(),10);if($__default["default"].isNumber(l)&&l>0&&ar.join(ew.MULTIPLE_UPLOAD_SEPARATOR).length>l){_alert(ew.language.phrase("UploadErrMsgMaxFileLength"));return false}};var _confirmDelete=function(e){if(!multiple&&$fn.val()){if(!confirm(ew.language.phrase("UploadOverwrite"))){e.preventDefault();e.stopPropagation()}}};var _changed=function(e,data){var _data$files2,_data$result2,_data$result2$files;$ft.toggleClass("ew-has-rows",((_data$files2=data.files)==null?void 0:_data$files2.length)>0||((_data$result2=data.result)==null?void 0:(_data$result2$files=_data$result2.files)==null?void 0:_data$result2$files.length)>0);var ar=$fn.val()?$fn.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[];$label.html(ar.join(", ")||label)};var _downloadTemplate=$__default["default"].templates("#template-download"),_uploadTemplate=$__default["default"].templates("#template-upload");var _completed=function(e,data){var e={target:data.context};initLightboxes(e);initPdfObjects(e);ew.updateDropdownPosition();data.context.find("img").on("load",ew.updateDropdownPosition)};var _added=function(e,data){var _data$files3;$ft.toggleClass("ew-has-rows",((_data$files3=data.files)==null?void 0:_data$files3.length)>0);data.context.find(".start").click(_confirmDelete)};var form=getForm(input),$form=$__default["default"](form),readonly=$form.find("#confirm").val()=="confirm"||$input.attr("readonly");if(readonly)$input.prop("disabled",true);var cnt=parseInt($maxfilecount.val(),10);var uploadUrl=getApiUrl(ew.API_JQUERY_UPLOAD_ACTION);var formData={id:id,table:tbl,session:ew.SESSION_ID,replace:multiple?"0":"1",exts:$exts.val(),maxsize:$maxsize.val(),maxfilecount:$maxfilecount.val()};$input.fileupload(Object.assign({url:uploadUrl,type:"POST",multipart:true,autoUpload:true,loadImageFileTypes:/^image\/(gif|jpe?g|png)$/i,loadVideoFileTypes:/^video\/mp4$/i,loadAudioFileTypes:/^audio\/(mpeg|mp3)$/i,acceptFileTypes:$exts.val()?new RegExp("\\.("+$exts.val().replace(/,/g,"|")+")$","i"):null,maxFileSize:parseInt($maxsize.val(),10),maxNumberOfFiles:cnt>1?cnt:null,filesContainer:$ft,formData:formData,uploadTemplateId:null,downloadTemplateId:null,uploadTemplate:_uploadTemplate.render.bind(_uploadTemplate),downloadTemplate:_downloadTemplate.render.bind(_downloadTemplate),previewMaxWidth:ew.UPLOAD_THUMBNAIL_WIDTH,previewMaxHeight:ew.UPLOAD_THUMBNAIL_HEIGHT,dropZone:$dropzone,messages:{acceptFileTypes:ew.language.phrase("UploadErrMsgAcceptFileTypes"),maxFileSize:ew.language.phrase("UploadErrMsgMaxFileSize"),maxNumberOfFiles:ew.language.phrase("UploadErrMsgMaxNumberOfFiles"),minFileSize:ew.language.phrase("UploadErrMsgMinFileSize")},readonly:readonly},ew.uploadOptions)).on("fileuploaddone",_done).on("fileuploaddestroy",_deleted).on("fileuploadchange",_change).on("fileuploadadded fileuploadfinished fileuploaddestroyed",_changed).on("fileuploadadded",_added).on("fileuploadcompleted",_completed);if($fn.val()){$__default["default"].ajax({url:uploadUrl,data:{id:id,table:tbl,session:ew.SESSION_ID},dataType:"json",context:this,success:function(result){if(result!=null&&result[id]){var done=$input.fileupload("option","done");if(done)done.call(input,$__default["default"].Event(),{result:{files:result[id]}})}if(readonly)$ft.find("td.delete").hide()}})}}function parseNumber(data){let locale=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);if(ew.NUMBERING_SYSTEM=="latn")locale.numeralSystem=undefined;if(locale.delimiters.thousands!==ew.GROUPING_SEPARATOR)locale.delimiters.thousands=ew.GROUPING_SEPARATOR;if(locale.delimiters.decimal!==ew.DECIMAL_SEPARATOR)locale.delimiters.decimal=ew.DECIMAL_SEPARATOR;return ew.parse(data,{locale:locale})}function getNumberingSystem(){return ew.NUMBERING_SYSTEM||new Intl.NumberFormat(ew.LANGUAGE_ID).resolvedOptions().numberingSystem}let DateTime=luxon__default["default"].DateTime;function formatDateTime(data,format){let dt;if($__default["default"].isString(data))dt=DateTime.fromSQL(data);else if($__default["default"].isNumber(data))dt=DateTime.fromSeconds(data);else if(data instanceof Date)dt=DateTime.fromJSDate(data);return dt.toFormat(format,{locale:ew.LANGUAGE_ID,numberingSystem:ew.getNumberingSystem()})}function parseDateTime(data,format){return DateTime.fromFormat(data,format,{locale:ew.LANGUAGE_ID,numberingSystem:ew.getNumberingSystem()})}function checkDate(data,format){if(!data||data.length==0)return true;return parseDateTime(data,format).isValid}function checkTime(data,format){if(!data||data.length==0)return true;return parseDateTime(data,format).isValid}function formatCurrency(value,format){format||(format=ew.CURRENCY_FORMAT);if(format.includes(";")){let formats=format.split(";");format=value>=0?formats[0]:formats[1]}format=format.replace("","$");let locale=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);if(ew.NUMBERING_SYSTEM=="latn")locale.numeralSystem=undefined;if(locale.delimiters.thousands!==ew.GROUPING_SEPARATOR)locale.delimiters.thousands=ew.GROUPING_SEPARATOR;if(locale.delimiters.decimal!==ew.DECIMAL_SEPARATOR)locale.delimiters.decimal=ew.DECIMAL_SEPARATOR;return ew.format(value,format,{locale:locale,currency:(ew.IS_RTL?"":"")+ew.CURRENCY_SYMBOL})}function formatNumber(value,format){let locale=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);if(ew.NUMBERING_SYSTEM=="latn")locale.numeralSystem=undefined;if(locale.delimiters.thousands!==ew.GROUPING_SEPARATOR)locale.delimiters.thousands=ew.GROUPING_SEPARATOR;if(locale.delimiters.decimal!==ew.DECIMAL_SEPARATOR)locale.delimiters.decimal=ew.DECIMAL_SEPARATOR;return ew.format(value,format||ew.NUMBER_FORMAT,{locale:locale})}function formatPercent(value,format){let locale=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);if(ew.NUMBERING_SYSTEM=="latn")locale.numeralSystem=undefined;if(locale.delimiters.thousands!==ew.GROUPING_SEPARATOR)locale.delimiters.thousands=ew.GROUPING_SEPARATOR;if(locale.delimiters.decimal!==ew.DECIMAL_SEPARATOR)locale.delimiters.decimal=ew.DECIMAL_SEPARATOR;return ew.format(value,format||ew.PERCENT_FORMAT,{locale:locale})}function initPage(e){var _e$target11;var el=(_e$target11=e==null?void 0:e.target)!=null?_e$target11:document,$el=$__default["default"](el),$tables=$el.find("table.ew-table:not(.ew-export-table)");ew.initPanels(el);ew.renderJsTemplates(e);lazyLoad(e);initForms(e);initTooltips(e);initPasswordOptions(e);initIcons(e);initLightboxes(e);initPdfObjects(e);$el.find("[data-widget='treeview']").each((function(){adminlte.Treeview._jQueryInterface.call($__default["default"](this),"init")}));$tables.each(setupTable);$el.find(".ew-table-header-caption[data-sort-url]").each((function(){let $this=$__default["default"](this);$this.on("click",(e=>ew.sort(e,$this.data("sortUrl"),$this.data("sortType"))))}));$el.find(".ew-column-dropdown").each((function(){var _localStorage$getItem;let table=this.dataset.table;(_localStorage$getItem=localStorage.getItem(ew.PROJECT_NAME+"_"+table+"_invisible_fields"))==null?void 0:_localStorage$getItem.split(",").forEach((field=>$__default["default"]("#tbl_"+table+"list").find("th[data-name='"+field+"'],td[data-name='"+field+"']").toggleClass("d-none",true)));$__default["default"](this).find(".ew-dropdown-checkbox").on("click",(function(e){let input=this.querySelector(".ew-dropdown-check-input[data-field]"),field=input==null?void 0:input.dataset.field;if(table&&field){input.classList.toggle("ew-checked");$__default["default"]("#tbl_"+table+"list").find("th[data-name='"+field+"'],td[data-name='"+field+"']").toggleClass("d-none",!input.classList.contains("ew-checked"))}localStorage.setItem(ew.PROJECT_NAME+"_"+table+"_invisible_fields",Array.from(e.currentTarget.closest(".dropdown-menu").querySelectorAll(".ew-dropdown-check-input[data-field]:not(.ew-checked)"),(el=>el.dataset.field)))}))})).on("show.bs.dropdown",(function(e){let table=e.currentTarget.dataset.table,inputs=e.currentTarget.querySelectorAll(".ew-dropdown-check-input[data-field]");for(let input of inputs){let field=input.dataset.field;input.classList.toggle("ew-checked",!!$__default["default"]("#tbl_"+table+"list").find("th[data-name='"+field+"']:not(.d-none)")[0])}}));$el.find("input.ew-page-no").on("keydown",(function(e){if(e.key=="Enter"){currentUrl.searchParams.set(this.name,ew.parseNumber(this.value));window.location=sanitizeUrl(currentUrl.toString());return false}}));if(!ew.IS_SCREEN_SM_MIN){$el.find("."+ew.RESPONSIVE_TABLE_CLASS+" [data-bs-toggle='dropdown']").parent().on("shown.bs.dropdown",(function(){var $this=$__default["default"](this),$menu=$this.find(".dropdown-menu"),div=$this.closest("."+ew.RESPONSIVE_TABLE_CLASS)[0];if(div.scrollHeight-div.clientHeight){var d=$menu.offset().top+$menu.outerHeight()-$__default["default"](div).offset().top-div.clientHeight;if(d>0)$menu.css(ew.IS_RTL?"right":"left","100%").css("top",parseFloat($menu.css("top"))-d)}}))}initExportLinks(e);initMultiSelectCheckboxes(e);var $rpt=$el.find(".ew-report");if($rpt[0]){$rpt.find(".card").on("collapsed.lte.widget",(function(){var $card=$__default["default"](this),$div=$card.closest("[class^='col-']"),mh=$div.css("min-height");if(mh)$div.data("min-height",mh);$div.css("min-height",0)})).on("expanded.lte.widget",(function(){var $card=$__default["default"](this),$div=$card.closest("[class^='col-']"),mh=$div.css("min-height");if(mh)$div.css("min-height",mh)}));$rpt.find(".ew-group-toggle").on("click",(function(){ew.toggleGroup(this)}))}if(typeof ew.USE_JAVASCRIPT_MESSAGE!="undefined"&&ew.USE_JAVASCRIPT_MESSAGE)showMessage(e)}function redirect(url,f,method){var _ew$vars;let urls=(_ew$vars=ew.vars)!=null&&_ew$vars.login?Array.from(Object.entries(ew.vars.login)).filter((entry=>entry[0].endsWith("Url"))).map((entry=>entry[1])):[];if(urls.includes(url)){window.location=url;return false}let newUrl;if(url.startsWith("http")){newUrl=new URL(url)}else if(url.startsWith("/")){newUrl=new URL(url,location.protocol+"//"+location.host)}else{_alert(ew.language.phrase("IncorrectUrl"));return false}let params=newUrl.searchParams;params.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME);params.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN);if(sameText(method,"post")){let $form=f?$__default["default"](f):$__default["default"]("<form></form>").appendTo("body");$form.attr({action:url.split("?")[0],method:"post"});params.forEach((function(value,key){$__default["default"]('<input type="hidden">').attr({name:key,value:ew.sanitize(value)}).appendTo($form)}));$form.trigger("submit")}else{window.location=sanitizeUrl(newUrl.toString())}return false}function togglePassword(e){var $btn=$__default["default"](e.currentTarget),$input=$btn.closest(".input-group").find("input"),$i=$btn.find("i");if($input.attr("type")=="text"){$input.attr("type","password");$i.toggleClass("fa-eye-slash fa-eye")}else if($input.attr("type")=="password"){$input.attr("type","text");$i.toggleClass("fa-eye-slash fa-eye")}}function exportWithCharts(url,exportId,f){let exportUrl=new URL(window.location.href),ar=url.split("?"),method=f?"post":"get";exportId+="_"+Date.now();exportUrl.pathname=ar[0];exportUrl.search=ar[1];exportUrl.searchParams.set("exportid",exportId);let _export=function(){let params=exportUrl.searchParams,custom=params.get("custom")=="1";if(f&&!custom){let data=$__default["default"](f).serialize();$__default["default"].post(exportUrl,data,(function(result){showMessage(result)}))}else{let exportType=params.get("export");if(custom&&["word","excel","pdf","email"].includes(exportType)){if(exportType=="email"){params.delete("export");exportUrl.search=params.toString()+"&"+$__default["default"](f).serialize()}$__default["default"]("iframe.ew-export").remove();$__default["default"]("<iframe></iframe>").addClass("ew-export d-none").attr("src",exportUrl.toString()).appendTo($body.css("cursor","wait"));setTimeout((()=>$body.css("cursor","default")),5e3)}else if(exportType=="print"){redirect(exportUrl.toString(),f,method)}else{fileDownload(exportUrl.toString(),null)}}return false};let keys=Object.keys(window.exportCharts);if(keys.length==0)return _export();$body.css("cursor","wait");let charts=[];for(const[id,chart]of Object.entries(window.exportCharts)){let params="exportfilename="+exportId+"_"+id+".png|exportformat=png|exportaction=download|exportparameters=undefined";if(chart!=null&&chart.toBase64Image)charts.push({chartEngine:"Chart.js",streamType:"base64",stream:chart.toBase64Image(),parameters:params})}$__default["default"].ajax({url:getApiUrl(ew.API_EXPORT_CHART_ACTION),data:{charts:JSON.stringify(charts)},cache:false,type:"POST"}).done((result=>{result=$__default["default"].isString(result)?parseJson(result):result;result.success?_export():_alert(result.error)})).fail(((xhr,status,error)=>_alert(error+": "+xhr.responseText))).always((()=>$body.css("cursor","default")));return false}var _fixLayoutHeightTimer;function fixLayoutHeight(){if(_fixLayoutHeightTimer)_fixLayoutHeightTimer.cancel();_fixLayoutHeightTimer=$__default["default"].later(50,null,(function(){var layout=$body.data("lte.layout");if(layout)layout.fixLayoutHeight()}))}function addEventHandlers(tblVar){let fields=ew.events[tblVar];if(fields){for(var[fldVar,events]of Object.entries(fields))$__default["default"]("[data-table="+tblVar+"][data-field="+fldVar+"]").on(events)}}var functions={__proto__:null,currentUrl:currentUrl,forms:forms,AjaxLookup:AjaxLookup,AutoSuggest:AutoSuggest,Form:Form,SelectionListOption:SelectionListOption,Select2Utils:Utils,Select2Defaults:Defaults,fieldContainerSelector:fieldContainerSelector,createSelect:createSelect,createModalLookup:createModalLookup,createFilter:createFilter,initIcons:initIcons,initPasswordOptions:initPasswordOptions,getApiUrl:getApiUrl,sanitizeUrl:sanitizeUrl,setSessionTimer:setSessionTimer,initExportLinks:initExportLinks,initMultiSelectCheckboxes:initMultiSelectCheckboxes,fileDownload:fileDownload,lazyLoad:lazyLoad,updateDropdownPosition:updateDropdownPosition,initLightboxes:initLightboxes,initPdfObjects:initPdfObjects,initTooltips:initTooltips,parseJson:parseJson,searchOperatorChanged:searchOperatorChanged,initForms:initForms,isFunction:isFunction$2,alert:_alert,prompt:_prompt,toast:toast,showToast:showToast,getForm:getForm,hasFormData:hasFormData,setSearchType:setSearchType,updateOptions:updateOptions,getUserParams:getUserParams,applyTemplate:applyTemplate,toggleGroup:toggleGroup,convertToBool:convertToBool,valueChanged:valueChanged,setLanguage:setLanguage,submitAction:submitAction,export:_export,removeSpaces:removeSpaces,isHiddenTextArea:isHiddenTextArea,isModalLookup:isModalLookup,isFilter:isFilter,isAutoSuggest:isAutoSuggest,isTextbox:isTextbox,clearError:clearError,onError:onError,setFocus:setFocus,setInvalid:setInvalid,setValid:setValid,hasValue:hasValue,isMaskedPassword:isMaskedPassword,sort:sort,filter:filter,confirmDelete:confirmDelete,keySelected:keySelected,selectAllKeys:selectAllKeys,selectAll:selectAll,updateSelected:updateSelected,clearSelected:clearSelected,clearDelete:clearDelete,clickDelete:clickDelete,selectKey:selectKey,setupTable:setupTable,setupGrid:setupGrid,addGridRow:addGridRow,deleteGridRow:deleteGridRow,htmlEncode:htmlEncode,htmlDecode:htmlDecode,getElements:getElements,getElement:getElement,getAncestorBy:getAncestorBy,isHidden:isHidden,sameText:sameText,sameString:sameString,getValue:getValue,getOptionValues:getOptionValues,getOptionTexts:getOptionTexts,clearOptions:clearOptions,getId:getId,valueSeparator:valueSeparator,displayValue:displayValue,optionHtml:optionHtml,optionsHtml:optionsHtml,newOption:newOption,selectOption:selectOption,fetch:_fetch,executeScript:executeScript,stripScript:stripScript,addScript:addScript,removeScript:removeScript,elementsToRow:elementsToRow,getContent:getContent,getOptions:getOptions,enable2FA:enable2FA,disable2FA:disable2FA,showBackupCodes:showBackupCodes,addOptionDialogShow:addOptionDialogShow,modalDialogHide:modalDialogHide,modalDialogShow:modalDialogShow,importDialogShow:importDialogShow,autoFill:autoFill,tooltip:tooltip,emailDialogShow:emailDialogShow,showDrillDown:showDrillDown,ajax:ajax,currentPage:currentPage,toggleSearchOperator:toggleSearchOperator,toggleLayout:toggleLayout,copyToClipboard:copyToClipboard,checkInteger:checkInteger,checkNumber:checkNumber,escapeRegExChars:escapeRegExChars,checkRange:checkRange,checkPhone:checkPhone,checkZip:checkZip,checkCreditCard:checkCreditCard,checkSsn:checkSsn,checkEmails:checkEmails,checkEmail:checkEmail,checkGuid:checkGuid,checkUrl:checkUrl,checkByRegEx:checkByRegEx,showMessage:showMessage,random:random,upload:upload,parseNumber:parseNumber,getNumberingSystem:getNumberingSystem,formatDateTime:formatDateTime,parseDateTime:parseDateTime,parseDate:parseDateTime,parseTime:parseDateTime,checkDate:checkDate,checkTime:checkTime,formatCurrency:formatCurrency,formatNumber:formatNumber,formatPercent:formatPercent,initPage:initPage,redirect:redirect,togglePassword:togglePassword,exportWithCharts:exportWithCharts,fixLayoutHeight:fixLayoutHeight,addEventHandlers:addEventHandlers};ew__default["default"].SERVICE_WORKER="sw.js";async function pushNotificationDialogShow(args){let $dlg=ew__default["default"].pushDialog||$__default["default"]("#ew-push-notification-dialog").on("shown.bs.modal",(e=>setTimeout((()=>{var _e$target$querySelect;return(_e$target$querySelect=e.target.querySelector(".modal-body .form-control"))==null?void 0:_e$target$querySelect.focus()}),200))).on("click",".modal-footer .btn-primary",(function(e){var _$$closest$find$data;e.preventDefault();if((_$$closest$find$data=$__default["default"](this).closest(".modal").find(".modal-body form").data("form"))!=null&&_$$closest$find$data.submit())$dlg.modal("hide")}));if(!$dlg[0]){console.log("DIV #ew-push-notificatoin-dialog not found");return false}if(!args.url){console.log("Missing URL of Web Push API");return false}let target=args.evt.currentTarget,$form=$__default["default"](target.form),$f=$dlg.find(".modal-body form"),frm=$f.data("form");$f.data("all",false);if(!$form.find("input[name='key_m[]']:checked")[0]){let result=await ew__default["default"].prompt({html:ew__default["default"].language.phrase("SendPushNotificationsToAll"),showCancelButton:true,icon:"question"},(bool=>bool));$f.data("all",result);if(!result)return}if(!frm){frm=new ew__default["default"].Form($f.attr("id"));frm.addFields([["title",ew__default["default"].Validators.required(ew__default["default"].language.phrase("PushNotificationFormTitle"))],["body",ew__default["default"].Validators.required(ew__default["default"].language.phrase("PushNotificationFormBody"))]]);frm.validate=function(){return this.validateFields()};frm.submit=function(){if(!this.validate())return false;let data=[$f.serialize(),$f.data("all")?"":$form.find("input[name='key_m[]']:checked").serialize()].join("&");$__default["default"].post(args.url,data,(result=>{var _result$error;if(Array.isArray(result)){let successes=result.reduce(((acc,cur)=>acc+(cur.success?1:0)),0),failures=result.length-successes;if(successes>0&&failures==0)ew__default["default"].alert(ew__default["default"].language.phrase("PushNotificationSuccess").replace("%s",successes),"success");else if(successes==0&&failures>0)ew__default["default"].alert(ew__default["default"].language.phrase("PushNotificationFailure").replace("%f",failures));else if(successes==0&&failures==0)ew__default["default"].alert(ew__default["default"].language.phrase("NoSubscriptions").replace("%f",failures),"primary");else ew__default["default"].alert(ew__default["default"].language.phrase("PushNotificationSent").replace("%s",successes).replace("%f",failures),"primary")}else if(result!=null&&(_result$error=result.error)!=null&&_result$error.description){ew__default["default"].alert(result.error.description)}}));return true};$f.data("form",frm)}ew__default["default"].pushDialog=$dlg.modal("hide").find(".modal-title").html(args.hdr||target.dataset.caption).end().modal("show");return false}function isPushNotificationSupported(){return"serviceWorker"in navigator&&"PushManager"in window}function urlBase64ToUint8Array(base64String){const padding="=".repeat((4-base64String.length%4)%4),base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/"),rawData=window.atob(base64),outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i)outputArray[i]=rawData.charCodeAt(i);return outputArray}async function sendSubscriptionToServer(subscription,url){const key=subscription.getKey("p256dh"),token=subscription.getKey("auth"),contentEncoding=(PushManager.supportedContentEncodings||["aesgcm"])[0];let formData=new FormData;formData.set("endpoint",subscription.endpoint);formData.set("publicKey",key?btoa(String.fromCharCode.apply(null,new Uint8Array(key))):null);formData.set("authToken",token?btoa(String.fromCharCode.apply(null,new Uint8Array(token))):null);formData.set("contentEncoding",contentEncoding);let response=await ew__default["default"].fetch(url,{method:"POST",body:formData});return response.json()}async function createSubscription(){var _result$error2;let url=ew__default["default"].getApiUrl([ew__default["default"].API_PUSH_NOTIFICATION_ACTION,ew__default["default"].API_PUSH_NOTIFICATION_SUBSCRIBE]),serviceWorkerReg=await navigator.serviceWorker.ready,subscription=await serviceWorkerReg.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:urlBase64ToUint8Array(ew__default["default"].PUSH_SERVER_PUBLIC_KEY)}),result=await sendSubscriptionToServer(subscription,url);if(result!=null&&(_result$error2=result.error)!=null&&_result$error2.description)ew__default["default"].alert(result.error.description);return result.success?subscription:null}async function getSubscription(){let serviceWorkerReg=await navigator.serviceWorker.ready;return serviceWorkerReg.pushManager.getSubscription()}function setSubscription(subscription){let $btn=$__default["default"]("#subscribe-notification").toggleClass("ew-enable-notification",!subscription).attr("data-bs-original-title",ew__default["default"].language.phrase(subscription?"DisableNotifications":"EnableNotifications")).removeClass("disabled");$btn.find("i").toggleClass("fa-bell",!subscription).toggleClass("fa-bell-slash",!!subscription);let inst=bootstrap.Tooltip.getInstance($btn[0]);if(inst!=null&&inst.tip)inst.setContent(inst.tip)}async function subscribeNotification(){if(Notification.permission!=="denied"&&!ew__default["default"].IS_SYS_ADMIN){let $body=$__default["default"]("body").css("cursor","wait");try{if(Notification.permission==="granted"){var _await$getSubscriptio,_document$getElementB;setSubscription((_await$getSubscriptio=await getSubscription())!=null?_await$getSubscriptio:await createSubscription());if(!((_document$getElementB=document.getElementById("subscribe-notification"))!=null&&_document$getElementB.classList.contains("ew-enable-notification")))ew__default["default"].showToast(ew__default["default"].language.phrase("NotificationsEnabled"),"success")}else if(Notification.permission==="default"&&await Notification.requestPermission()=="granted"){var _document$getElementB2;setSubscription(await createSubscription());if(!((_document$getElementB2=document.getElementById("subscribe-notification"))!=null&&_document$getElementB2.classList.contains("ew-enable-notification")))ew__default["default"].showToast(ew__default["default"].language.phrase("NotificationsEnabled"),"success")}}catch(e){ew__default["default"].alert(e)}finally{$body.css("cursor","default")}}return false}async function checkSubscription(){$__default["default"]("#subscribe-notification").tooltip();if(Notification.permission=="granted")setSubscription(await getSubscription());else setSubscription(null);return true}async function unsubscribeNotification(){ew__default["default"].prompt({html:ew__default["default"].language.phrase("DisableNotificationsMsg")},(async res=>{if(!res)return;let $body=$__default["default"]("body").css("cursor","wait");try{var _result$error3;let subscription=await getSubscription();await subscription.unsubscribe();let url=ew__default["default"].getApiUrl([ew__default["default"].API_PUSH_NOTIFICATION_ACTION,ew__default["default"].API_PUSH_NOTIFICATION_DELETE]),result=await sendSubscriptionToServer(subscription,url);if(result!=null&&(_result$error3=result.error)!=null&&_result$error3.description){ew__default["default"].alert(result.error.description);return false}if(result.success){setSubscription(null);ew__default["default"].showToast(ew__default["default"].language.phrase("NotificationsDisabled"),"success")}}catch(e){ew__default["default"].alert(e)}finally{$body.css("cursor","default")}}));return false}loadjs.ready("foot",(()=>{if(ew__default["default"].PUSH_SERVER_PUBLIC_KEY&&isPushNotificationSupported()){navigator.serviceWorker.register(ew__default["default"].PATH_BASE+ew__default["default"].SERVICE_WORKER,{scope:ew__default["default"].PATH_BASE}).then((()=>{checkSubscription();$__default["default"]("#subscribe-notification").on("click",(function(){this.classList.contains("ew-enable-notification")?subscribeNotification():unsubscribeNotification()}))})).catch((e=>console.log(e)))}else{$__default["default"]("#subscribe-notification").addClass("d-none")}}));var webpush={__proto__:null,pushNotificationDialogShow:pushNotificationDialogShow,isPushNotificationSupported:isPushNotificationSupported,subscribeNotification:subscribeNotification,checkSubscription:checkSubscription,unsubscribeNotification:unsubscribeNotification};function show(data){if(data.inited)return true;let latlng=data.latlng,$div=$__default["default"]("#"+data.id),useSingleMap=data.useSingleMap,showAllMarkers=data.showAllMarkers,useMarkerClusterer=data.useMarkerClusterer,ext=ew.maps[data.ext];if(useSingleMap){let id=data.id.replace(/^mp\d*_/,"mp_");$div=$__default["default"]("#"+id);if(!$div[0]){$div=$__default["default"]("<div></div>").attr("id",id).addClass("ew-single-map").height(data.singleMapHeight);if(data.singleMapWidth)$div.width(data.singleMapWidth);$__default["default"](".ew-grid, .ew-multi-column-grid").first()[data.showMapOnTop?"before":"after"]($div);data.map=ext.createMap($div[0],data);$div.data("map",data.map);$div.data("ext",data.ext);$div.data("bounds",showAllMarkers?ext.createBounds():null);$div.data("markerClusterer",useMarkerClusterer?ext.createMarkerClusterer(data):null)}data=Object.assign(data,$div.data())}else{if(!latlng){$div.addClass("d-none").html(data.status);return true}$div.next(".ew-map-value").addClass("d-none");if(!data.map)data.map=ext.createMap($div[0],data)}data.marker=ext.createMarker(data);data.inited=true;$__default["default"](document).trigger("map",[data]);return true}function done(){$__default["default"](".ew-single-map").each((function(){let data=$__default["default"](this).data();ew.maps[data.ext].fitBounds(data)}));$__default["default"](document).trigger("maps")}function init(ext){let promises=$__default["default"](".ew-map").filter((function(){return!ext||$__default["default"](this).data("ext")==ext})).map((function(i){let data=$__default["default"](this).data();if(data.inited)return show(data);data.id=this.id;data.address=(data.address||"").trim();if(data.address){let geocodingDelay=data.geocodingDelay;return new Promise((resolve=>{$__default["default"].later(i*geocodingDelay,null,(()=>{resolve(ew.maps[data.ext].geocode(data).then((latlng=>{data.latlng=latlng})).catch((status=>{data.status=status})).finally((()=>show(data))))}))}))}else{let latitude=data.latitude,longitude=data.longitude;if(latitude&&!isNaN(latitude)&&longitude&&!isNaN(longitude))data.latlng=ew.maps[data.ext].createLatLng(latitude,longitude);return show(data)}})).get();return Promise.all(promises).then(done)}$__default["default"]((function(){$__default["default"]("#ew-modal-dialog").on("load.ew",init);$__default["default"](document).on("preview",init)}));var maps={__proto__:null,show:show,done:done,init:init};ew.IS_SCREEN_SM_MIN=window.matchMedia("(min-width: 768px)").matches;ew.MOBILE_DETECT=new MobileDetect(window.navigator.userAgent);ew.IS_MOBILE=!!ew.MOBILE_DETECT.mobile();window.exportCharts={};Object.assign(ew,{MultiPage:MultiPage,Form:Form,Validators:Validators,maps:maps},functions,webpush);var $document=$__default["default"](document);loadjs.ready("load",(function(){$__default["default"].views.settings.debugMode(ew.DEBUG);ew.setSessionTimer();ew.initPage();$__default["default"]("#ew-modal-dialog").on("load.ew",ew.initPage);$__default["default"]("#ew-add-opt-dialog").on("load.ew",ew.initPage);var hash=ew.currentUrl.searchParams.get("hash");if(hash)$__default["default"]("html, body").animate({scrollTop:$__default["default"]("#"+hash).offset().top},800);$document.trigger("load")}));$document.on("addoption",(function(e,args){var row=args.data;var arp=args.parents;for(var i=0,cnt=arp.length;i<cnt;i++){var p=arp[i];if(!p.length)return args.valid=false;var val=row["ff"+(i>0?i+1:"")];if(!$__default["default"].isUndefined(val)&&!p.includes(String(val)))return args.valid=false}}));$document.on("click","[data-ew-action]:not([data-ew-action=''])",(function(e){let data=Object.assign({},$__default["default"](this).data()),action=data.ewAction;if(!action){return true}else if(action=="none"){return false}else if(action=="redirect"){return ew.redirect(data.url)}else if(action=="reload"){location.reload();return false}else if(action=="submit"){delete data.ewAction;return ew.submitAction(e,data)}else if(action=="modal"){delete data.ewAction;return ew.modalDialogShow({evt:e,...data})}else if(action=="export"){return ew.export(e,data.url,data.export,data.custom,data.exportSelected)}else if(action=="layout"){return ew.toggleLayout(this)}else if(action=="language"){return ew.setLanguage(this)}else if(action=="filter"){return ew.filter(e)}else if(action=="email"){delete data.ewAction;return ew.emailDialogShow({evt:e,...data})}else if(action=="set-action"){this.form.elements["action"].value=data.value}else if(action=="drilldown"){return ew.showDrillDown(e,this,data.url,data.id,data.hdr)}else if(action=="export-charts"){return ew.exportWithCharts(data.url,data.exportid)}else if(action=="add-option"){delete data.ewAction;return ew.addOptionDialogShow({evt:e,...data})}else if(action=="search-type"){return ew.setSearchType(this)}else if(action=="search-operator"){ew.toggleSearchOperator(e,data.target,data.value)}else if(action=="search-toggle"){$__default["default"]("#"+this.dataset.form+"_search_panel").collapse("toggle")}else if(action=="highlight"){$__default["default"]("mark."+this.dataset.name).toggleClass("mark")}else if(action=="inline-delete"){return ew.confirmDelete(this)}else if(action=="add-grid-row"){return ew.addGridRow(this)}else if(action=="delete-grid-row"){return ew.deleteGridRow(this,this.dataset.rowindex)}else if(action=="select-all"){ew.selectAll(this)}else if(action=="select-key"){ew.selectKey(e)}else if(action=="select-all-keys"){ew.selectAllKeys(this)}else if(action=="import"){return ew.importDialogShow({evt:e,hdr:data.hdr})}else if(action=="password"){return ew.togglePassword(e)}else if(action=="push"){return ew.pushNotificationDialogShow({evt:e,url:data.apiUrl})}else if(action=="enable-2fa"){return ew.enable2FA()}else if(action=="disable-2fa"){return ew.disable2FA()}else if(action=="backup-codes"){return ew.showBackupCodes()}else if(action=="scroll-top"){$__default["default"](document).scrollTop($__default["default"]("#top").offset().top);return false}}));$document.on("click",".ew-row-link",(e=>e.stopPropagation()));$document.on("show.bs.modal",".modal",(function(){var zIndex=1050+$__default["default"](".modal:visible").length;$__default["default"](this).css("z-index",zIndex);setTimeout((function(){$__default["default"](".modal-backdrop").not(".modal-stack").css("z-index",zIndex-1).addClass("modal-stack")}),0)}));$document.on("hidden.bs.modal",".modal",(function(){$__default["default"](".modal:visible").length&&$__default["default"]("body").addClass("modal-open")}));$__default["default"].extend({isBoolean:function(o){return typeof o==="boolean"},isNull:function(o){return o===null},isNumber:function(o){return typeof o==="number"&&isFinite(o)},isObject:function(o){return o&&(typeof o==="object"||this.isFunction(o))||false},isString:function(o){return typeof o==="string"},isUndefined:function(o){return typeof o==="undefined"},isValue:function(o){return this.isObject(o)||this.isString(o)||this.isNumber(o)||this.isBoolean(o)},isDate:function(o){return this.type(o)==="date"&&o.toString()!=="Invalid Date"&&!isNaN(o)},later:function(when,o,fn,data,periodic){when=when||0;o=o||{};var m=fn,d=data,f,r;if(this.isString(fn))m=o[fn];if(!m)return;if(!this.isUndefined(data)&&!this.isArray(d))d=[data];f=function(){m.apply(o,d||[])};r=periodic?setInterval(f,when):setTimeout(f,when);return{interval:periodic,cancel:function(){if(this.interval){clearInterval(r)}else{clearTimeout(r)}}}}});$__default["default"].fn.fields=function(fldvar){var rec={},id=this.attr("id"),obj=this[0],m=id.match(/^[xy](\d*)_/),f,tbl,infix;if(m){f=ew.getForm(obj);tbl=this.data("table");infix=m[1]}else if(obj!=null&&obj.htmlForm){f=obj.$element;tbl=obj.id.replace(new RegExp("^f|"+obj.pageId+"$","g"),"");infix=obj.htmlForm.dataset.rowindex}var selector="[data-table"+(tbl?"="+tbl:"")+"][data-field"+(fldvar?"=x_"+fldvar:"")+"]";if($__default["default"].isValue(infix))selector+="[name^=x"+infix+"_]";if(f&&selector){$__default["default"](f).find(selector).each((function(){var key=this.getAttribute("data-field").substr(2),name=this.getAttribute("name");key=/^y_/.test(name)?"y_"+key:key;rec[key]=rec[key]?rec[key].add(this):$__default["default"](this)}))}return fldvar?rec[fldvar]:rec};$__default["default"].fn.extend({row:function(){var _this$data;var $row=this.closest("#r_"+((_this$data=this.data("field"))==null?void 0:_this$data.substr(2)));if(!$row[0])$row=this.closest(".ew-table > tbody > tr");return $row},visible:function(v){var _this$data2;var $p=this.closest("#r_"+((_this$data2=this.data("field"))==null?void 0:_this$data2.substr(2)));if(!$p[0])$p=this.closest("[id^=el]");if(typeof v!="undefined"){$p.toggle(v);return this}else{return $el.is(":visible")}},readonly:function(v){if(typeof v!="undefined"){this.prop("readOnly",v);return this}else{return this.prop("readOnly")}},disabled:function(v){if(typeof v!="undefined"){this.prop("disabled",v);return this}else{return this.prop("disabled")}},value:function(v){var type=this.attr("type");if(typeof v!="undefined"){if(!Array.isArray(v))v=[v];var type=this.attr("type");var el=type=="radio"||type=="checkbox"?this.get():this[0];if(ew.isHiddenTextArea(this)){this.val(v).data("editor").save()}else{ew.selectOption(el,v);if(this.hasClass("select2-hidden-accessible")){this.trigger("change")}}return this}else{if(type=="checkbox"){var val=ew.getOptionValues(this.get());return this.length==1?val.join():val}else if(type=="radio"){return ew.getOptionValues(this.get()).join()}else if(ew.isHiddenTextArea(this)){this.data("editor").save();return this.val()}else{return this.val()}}},toNumber:function(){return ew.parseNumber(this.value())},toDate:function(){var _ew$vars$tables,_ew$vars$tables$table,_ew$vars$tables$table2,_ew$vars$tables$table3;let data=this.data(),table=data.table,field=data.field.replace(/^[xy]_/,""),format=(_ew$vars$tables=ew.vars.tables)==null?void 0:(_ew$vars$tables$table=_ew$vars$tables[table])==null?void 0:(_ew$vars$tables$table2=_ew$vars$tables$table.fields)==null?void 0:(_ew$vars$tables$table3=_ew$vars$tables$table2[field])==null?void 0:_ew$vars$tables$table3.clientFormatPattern;return ew.parseDateTime(this.value(),format)},toJsDate:function(){return this.toDate().toJSDate()}});bootstrap.Dropdown.prototype._getMenuElement=function(){if(this._element.closest("[data-widget]"))$__default["default"](this._element).on("click.bs.dropdown",(e=>e.stopPropagation()));if(!this._menu){const parent=bootstrap.Dropdown.getParentFromElement(this._element);if(parent){this._menu=parent.querySelector(".dropdown-menu");if(this._menu.closest(".table-responsive")){let container=this._menu.closest(".popover-body, .modal-body, body");container.appendChild(this._menu);let menu=this._menu;if(!this._element.id)this._element.id="dropdownbtn"+ew.random();menu.setAttribute("aria-labelledby",this._element.id);function callback(mutationList){mutationList.forEach((mutation=>{switch(mutation.type){case"attributes":if(mutation.target.classList.contains("show")){menu.classList.add("d-block")}else{menu.classList.remove("d-block")}break}}))}let observer=new MutationObserver(callback);observer.observe(parent,{attributeFilter:["class"],attributeOldValue:false,subtree:false})}}}return this._menu};$__default["default"](window).off("load.lte.treeview");var Treeview=adminlte.Treeview;Treeview.prototype._toggle=Treeview.prototype.toggle;Treeview.prototype.toggle=function toggle(e){let $currentTarget=$__default["default"](e.currentTarget),treeviewMenu=$currentTarget.next(),href=$currentTarget.attr("href"),isText=e.target.tagName=="P";if(!treeviewMenu.is(".nav-treeview")||isText&&href&&href!="#"&&href!="javascript:void(0);")return;this._toggle(e);e.stopImmediatePropagation()};$__default["default"]("ul.dropdown-menu [data-bs-toggle=dropdown]").on("click",(function(e){let href=$__default["default"](this).attr("href");if(href&&href!="#"&&e.target.tagName=="SPAN")window.location=href}));var isNil=value=>value===null||value===undefined;var isNil$1=isNil;var isFunction=value=>typeof value==="function";var isFunction$1=isFunction;var isNaNNumber=value=>typeof value==="number"&&isNaN(value);var isNaNNumber$1=isNaNNumber;var isFiniteNumber=value=>typeof value=="number"&&isFinite(value);var isFiniteNumber$1=isFiniteNumber;const multiplyByPowerOfTen=(number,powerOfTenExponent)=>{if(!isFiniteNumber$1(number))return NaN;const numAsString=""+number;const indexOfE=numAsString.indexOf("e");if(indexOfE===-1){return+(numAsString+"e"+powerOfTenExponent)}else{return+(numAsString.slice(0,indexOfE)+"e"+(+numAsString.slice(indexOfE+1)+powerOfTenExponent))}};var multiplyByPowerOfTen$1=multiplyByPowerOfTen;const log10=numberThatIsPowerOfTen=>Math.round(Math.log(numberThatIsPowerOfTen)*Math.LOG10E);var log10$1=log10;const toObject=(arr,entriesResolver)=>{const object={};for(let i=0;i<arr.length;++i){if(i in arr){const[key,value]=entriesResolver(arr[i],i);object[key]=value}}return object};var toObject$1=toObject;const escapeRegexString=string=>string.replace(/[.*+?^${}()|[\]\\]/g,(match=>`\\${match}`));var escapeRegexString$1=escapeRegexString;const memoize=fn=>{const cache={};return function(...args){const cacheKey=args.length>1?args.join("-(:-:)-"):args[0];if(cacheKey in cache){return cache[cacheKey]}const result=fn.apply(this,args);cache[cacheKey]=result;return result}};var memoize$1=memoize;const powerOf10LookupObject=(()=>{const object={};let additionalZeros="";let currentValue;while(currentValue!==Infinity){currentValue=+("1"+additionalZeros);object[currentValue]=true;additionalZeros+="0"}additionalZeros="";currentValue=undefined;while(currentValue!==0){currentValue=+("0."+additionalZeros+"1");object[currentValue]=true;additionalZeros+="0"}return object})();const isPowerOfTen=number=>!!powerOf10LookupObject[number];var isPowerOfTen$1=isPowerOfTen;const toBase=(value,valueUnit,unitScale)=>{if(!isFiniteNumber$1(value)||valueUnit===unitScale.base)return value;if(!(valueUnit in unitScale.scale))return NaN;const toBaseMultiplier=unitScale.scale[valueUnit]||1;return isPowerOfTen$1(toBaseMultiplier)?multiplyByPowerOfTen$1(value,log10$1(toBaseMultiplier)):value*toBaseMultiplier};const convertUnit=(value,originUnit,targetUnit,unitScale)=>{if(!isFiniteNumber$1(value)||originUnit===targetUnit)return value;const valueAsBase=toBase(value,originUnit,unitScale);const resolvedScale=Object.assign(Object.assign({},unitScale.scale),{[unitScale.base]:1});if(isNaN(valueAsBase)||!(originUnit in resolvedScale)||!(targetUnit in resolvedScale))return NaN;const conversionFactorFromBase=unitScale.scale[targetUnit]||1;return isPowerOfTen$1(conversionFactorFromBase)?multiplyByPowerOfTen$1(valueAsBase,-log10$1(conversionFactorFromBase)):valueAsBase/conversionFactorFromBase};const toBest=(value,originUnit,unitScale,options)=>{const resolvedOptions=Object.assign({exclude:[],cutOffNumber:1},options);let best=null;const scale=unitScale.scale;Object.keys(scale).sort(((a,b)=>scale[a]-scale[b])).forEach((scaleUnit=>{const isIncluded=resolvedOptions.exclude.indexOf(scaleUnit)===-1;if(!isIncluded)return;const result=convertUnit(value,originUnit,scaleUnit,unitScale);const absoluteResult=Math.abs(result);if(!best||absoluteResult>=resolvedOptions.cutOffNumber&&absoluteResult<Math.abs(best[0])){best=[result,scaleUnit]}}));return best||[value,originUnit]};const unitScale=unitScaleDefinition=>({toBase:(value,unit)=>toBase(value,unit,unitScaleDefinition),convert:(value,originUnit,targetUnit)=>convertUnit(value,originUnit,targetUnit,unitScaleDefinition),toBest:(value,originUnit,options)=>toBest(value,originUnit,unitScaleDefinition,options),scaleDefinition:unitScaleDefinition});const stringRepeat=(str,count)=>{if(count<1)return"";let result="";let pattern=str;while(count>1){if(count&1)result+=pattern;count>>>=1,pattern+=pattern}return result+pattern};var stringRepeat$1=stringRepeat;const baseCreateUnitScaleFromLocaleAbbreviations=str=>{if(!str){return unitScale({base:"",scale:{}})}const scale=str.split("|");const scaleDefinition={[""]:1};scale.forEach(((scaleItem,scaleItemIndex)=>{if(!scaleItem)return;scaleDefinition[scaleItem]=+(1+stringRepeat$1("0",scaleItemIndex))}));return unitScale({base:"",scale:scaleDefinition})};const createUnitScaleFromLocaleAbbreviations=memoize$1(baseCreateUnitScaleFromLocaleAbbreviations);var createUnitScaleFromLocaleAbbreviations$1=createUnitScaleFromLocaleAbbreviations;const replaceNumeralSystemWithLatinNumbers=(numericStringWithExtraInfo,numeralSystemMap)=>{if(!numeralSystemMap||numeralSystemMap.length!==10)return numericStringWithExtraInfo;const numericStringLength=numericStringWithExtraInfo.length;const numeralSystemToLatinSystemMap=toObject$1(numeralSystemMap,((digit,digitIndex)=>[digit.replace(/\u200e/g,""),""+digitIndex]));let output="";for(let numericStringIndex=0;numericStringIndex<numericStringLength;numericStringIndex++){const char=numericStringWithExtraInfo[numericStringIndex];output+=numeralSystemToLatinSystemMap[char]||char}return output};const getScalingFactorFromAbbreviations=(stringOriginal,options)=>{var _a;const scale=createUnitScaleFromLocaleAbbreviations$1((_a=options.locale)===null||_a===void 0?void 0:_a.abbreviations);const abbreviationsSortedByLengthDesc=Object.keys(scale.scaleDefinition.scale).sort(((a,b)=>b.length-a.length));let abbreviationScalingFactor=1;for(const abbreviation of abbreviationsSortedByLengthDesc){const scapedAbbreviationForRegex=escapeRegexString$1(abbreviation);const regexp=new RegExp("[^a-zA-Z]"+`(${scapedAbbreviationForRegex})|(${scapedAbbreviationForRegex.replace(/\u200e/g,"")})`+"(?:\\)(?:\\))?)?$");if(stringOriginal.match(regexp)){abbreviationScalingFactor=scale.toBase(abbreviationScalingFactor,abbreviation);break}}return abbreviationScalingFactor};const formattedStringToNumber=(inputString,options)=>{var _a;const locale=options.locale;const stringOriginal=inputString;let value;const stringWithLatinDigits=replaceNumeralSystemWithLatinNumbers(inputString,(_a=options.locale)===null||_a===void 0?void 0:_a.numeralSystem);if(options.zeroFormat&&stringWithLatinDigits===options.zeroFormat){value=0}else if(options.nullFormat&&stringWithLatinDigits===options.nullFormat||!stringWithLatinDigits.replace(/[^0-9]+/g,"").length){value=null}else{const decimalDelimiterFromLocale=locale.delimiters.decimal;const stringWithDotDecimalDelimiter=decimalDelimiterFromLocale==="."?stringWithLatinDigits:stringWithLatinDigits.replace(/\./g,"").replace(decimalDelimiterFromLocale,".");const abbreviationScalingFactor=getScalingFactorFromAbbreviations(stringOriginal,options);const negativeFactor=(stringWithDotDecimalDelimiter.split("-").length+Math.min(stringWithDotDecimalDelimiter.split("(").length-1,stringWithDotDecimalDelimiter.split(")").length-1))%2?1:-1;const numberAsString=stringWithDotDecimalDelimiter.replace(/[^0-9.]+/g,"");value=negativeFactor*multiplyByPowerOfTen$1(+numberAsString,log10$1(abbreviationScalingFactor))}return value};var formattedStringToNumber$1=formattedStringToNumber;const locale={code:"en",delimiters:{thousands:",",decimal:"."},abbreviations:"|||K|||M|||B|||T",ordinal:number=>{const b=number%10;return Math.floor(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}};var locale$1=locale;function merge(...args){const newObject={};const argsLength=args.length;for(let i=0;i<argsLength;i++){for(const key in args[i])newObject[key]=args[i][key]}return newObject}var isObject=value=>typeof value==="object"&&value!==null;var isObject$1=isObject;var isString=value=>typeof value==="string";var isString$1=isString;const truncateNumber=value=>value<0?Math.ceil(value):Math.floor(value);var truncateNumber$1=truncateNumber;const getPatternParts=patternMask=>{let isInEscapedPart=false;let currentEscapedWord="";const parts=[];for(let i=0;i<patternMask.length;i++){const char=patternMask.charAt(i);if(char==="'"&&!isInEscapedPart){isInEscapedPart=true;currentEscapedWord=""}else if(char==="'"&&isInEscapedPart&&patternMask.charAt(i-1)!=="\\"){isInEscapedPart=false;parts.push({escaped:true,value:currentEscapedWord})}else if(isInEscapedPart){currentEscapedWord+=char}else{if(parts.length&&!parts[parts.length-1].escaped){parts[parts.length-1].value+=char}else{parts.push({escaped:false,value:char})}}}return parts};const patternIncludes=(patternMask,search)=>patternRemoveEscapedText(patternMask).indexOf(search)!==-1;const patternReplace=(patternMask,searchValue,replaceValue)=>getPatternParts(patternMask).map((e=>e.escaped?`'${e.value}'`:e.value.replace(searchValue,(_=>replaceValue)))).join("");const patternRemoveEscapedText=patternMask=>getPatternParts(patternMask).filter((e=>!e.escaped)).map((e=>e.value)).join("");const patternStripAndNormalizeEscapedText=patternMask=>getPatternParts(patternMask).map((e=>e.escaped?e.value.replace(/\\'/g,"'"):e.value)).join("");const stringIncludes=(str,search)=>str.indexOf(search)!==-1;var stringIncludes$1=stringIncludes;const signRule=pattern=>{const patternWithoutEscapedText=patternRemoveEscapedText(pattern);const negativeParentheses=stringIncludes$1(patternWithoutEscapedText,"(")&&stringIncludes$1(patternWithoutEscapedText,")");const forceSign=!negativeParentheses&&stringIncludes$1(patternWithoutEscapedText,"+");let outputPatternMask=pattern;outputPatternMask=patternReplace(outputPatternMask,"(",`'nps'`);outputPatternMask=patternReplace(outputPatternMask,")",`'npe'`);outputPatternMask=patternReplace(outputPatternMask,/(-|\+)/,`'s'`);return[outputPatternMask,{negativeParentheses:negativeParentheses,forceSign:forceSign}]};var signRule$1=signRule;const abbreviationRule=patternMask=>{let compactUnit=null;let compact=false;if(patternIncludes(patternMask,"a")){compact=true;const patternWithoutEscapedText=patternRemoveEscapedText(patternMask);const abbreviationRegExpResult=patternWithoutEscapedText.match(/a(k|m|b|t)?/);compactUnit=!!abbreviationRegExpResult?abbreviationRegExpResult[1]:null}let outputPatternMask=patternMask;outputPatternMask=patternReplace(outputPatternMask,/a(k|m|b|t)?/,`'a'`);return[outputPatternMask,{compact:compact,compactUnit:compactUnit,compactAuto:compact&&!compactUnit}]};var abbreviationRule$1=abbreviationRule;const splitStringInTwoParts=(str,separator)=>{if(!str)return["",""];const indexOfSearchChar=str.indexOf(separator);if(indexOfSearchChar===-1){return[str,""]}else{return[str.slice(0,indexOfSearchChar),str.slice(indexOfSearchChar+1)]}};var splitStringInTwoParts$1=splitStringInTwoParts;const countChars=(string,char)=>!string?0:string.split("").filter((stringChar=>stringChar===char)).length;const decimalPlacesRule=patternMask=>{const patternWithoutEscapedText=patternRemoveEscapedText(patternMask);const patternPrecisionPart=splitStringInTwoParts$1(patternWithoutEscapedText,".")[1];let minimumFractionDigits=0;let maximumFractionDigits=0;if(!!patternPrecisionPart){const trimmedPatternPrecisionPart=patternPrecisionPart.trim();if(stringIncludes$1(trimmedPatternPrecisionPart,"[")){const patternPrecisionPartWithoutClosingBracket=trimmedPatternPrecisionPart.replace("]","");const precisionSplitted=splitStringInTwoParts$1(patternPrecisionPartWithoutClosingBracket,"[");minimumFractionDigits=countChars(precisionSplitted[0],"0");maximumFractionDigits=minimumFractionDigits+countChars(precisionSplitted[1],"0")}else if(stringIncludes$1(trimmedPatternPrecisionPart,"#")){minimumFractionDigits=countChars(trimmedPatternPrecisionPart.split("#")[0],"0");maximumFractionDigits=trimmedPatternPrecisionPart.length}else if(stringIncludes$1(trimmedPatternPrecisionPart,"X")){minimumFractionDigits=countChars(trimmedPatternPrecisionPart.split("X")[0],"0");maximumFractionDigits=500}else{const fractionDigits=countChars(trimmedPatternPrecisionPart.split(" ")[0],"0");minimumFractionDigits=fractionDigits;maximumFractionDigits=fractionDigits}}return{minimumFractionDigits:minimumFractionDigits,maximumFractionDigits:maximumFractionDigits}};var decimalPlacesRule$1=decimalPlacesRule;const optionalDecimalPlacesRule=patternMask=>{let optionalFractionDigits=false;let outputPatternMask=patternMask;if(patternIncludes(patternMask,"[.]")){optionalFractionDigits=true;outputPatternMask=patternReplace(outputPatternMask,"[.]",".")}return[outputPatternMask,{optionalFractionDigits:optionalFractionDigits}]};var optionalDecimalPlacesRule$1=optionalDecimalPlacesRule;const numberPositionRule=patternMask=>{const numberPartRegExp=/((((0|#)+,)?(0|#)+(\.([0#X]|\[0+\])+)?){1})/;return patternReplace(patternMask,numberPartRegExp,`'n'`)};const minimumIntegerDigitsRule=patternMask=>{const patternMaskWithoutEscapedText=patternRemoveEscapedText(patternMask);const patternMaskIntegerPart=patternMaskWithoutEscapedText.split(".")[0].split(",")[0];if(/#/g.test(patternMaskIntegerPart)){return 0}return(patternMaskIntegerPart.match(/0/g)||[]).length};const addSignPositionIfItDoesNotExists=patternMask=>{if(stringIncludes$1(patternMask,`'s'`)||stringIncludes$1(patternMask,`'nps'`))return patternMask;return patternMask.replace(`'n'`,(_=>`'s''n'`))};const baseParsePattern=inputPattern=>{const resolvedInputPattern=isString$1(inputPattern)&&inputPattern||"0,0.##########";const[patternMaskAfterSignRule,signRules]=signRule$1(resolvedInputPattern);const[patternMaskAfterAbbreviationRule,abbreviationRules]=abbreviationRule$1(patternMaskAfterSignRule);const[patternMaskAfterOptionalDecimalPlacesRule,optionalDecimalPlacesRules]=optionalDecimalPlacesRule$1(patternMaskAfterAbbreviationRule);const outputPatternMask=patternMaskAfterOptionalDecimalPlacesRule;const outputPatternMaskWithoutEscapedText=patternRemoveEscapedText(outputPatternMask);const decimalPlacesRules=decimalPlacesRule$1(outputPatternMask);const minimumIntegerDigits=minimumIntegerDigitsRule(outputPatternMask);const grouping=outputPatternMaskWithoutEscapedText.indexOf(",")>-1;const patternMaskAfterHandlingNumberPosition=numberPositionRule(outputPatternMask);const patternMaskWithEnsuredSignPosition=addSignPositionIfItDoesNotExists(patternMaskAfterHandlingNumberPosition);const patternMask=patternMaskWithEnsuredSignPosition;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},signRules),abbreviationRules),optionalDecimalPlacesRules),decimalPlacesRules),{grouping:grouping,minimumIntegerDigits:minimumIntegerDigits,patternMask:patternMask})};const parsePattern=memoize$1(baseParsePattern);var parsePattern$1=parsePattern;const removeSignIfExists=valueAsString=>valueAsString[0]==="-"?valueAsString.slice(1):valueAsString;var removeSignIfExists$1=removeSignIfExists;const rescaleRoundedValue=(value,currentAbbreviationScale,patternRules,options)=>{const{compact:compact,compactAuto:compactAuto}=patternRules;const{abbreviations:abbreviations}=options.locale;if(!compact||!compactAuto){return[value,currentAbbreviationScale]}const scale=createUnitScaleFromLocaleAbbreviations$1(abbreviations);const[newScaledValue,newScaledValueUnit]=scale.toBest(value,currentAbbreviationScale||"");return[newScaledValue,newScaledValueUnit]};var rescaleRoundedValue$1=rescaleRoundedValue;const resolveForcedAbbreviationUnit=(forcedAbbreviationUnit,abbreviationsFromLocale,value)=>{const forcedScaleMap={k:3,m:6,b:9,t:12};const targetPowerOfTenExponent=forcedScaleMap[forcedAbbreviationUnit];const scaleDefinitionFromLocale=(abbreviationsFromLocale===null||abbreviationsFromLocale===void 0?void 0:abbreviationsFromLocale.split("|"))||[];let closestPowerOfTenWithAvailableAbbreviation=null;for(let distanceFromTarget=0;distanceFromTarget<scaleDefinitionFromLocale.length;distanceFromTarget++){if(!scaleDefinitionFromLocale[targetPowerOfTenExponent-distanceFromTarget])continue;closestPowerOfTenWithAvailableAbbreviation=targetPowerOfTenExponent-distanceFromTarget;break}if(closestPowerOfTenWithAvailableAbbreviation===null){return[value,null]}return[multiplyByPowerOfTen$1(value,-closestPowerOfTenWithAvailableAbbreviation),scaleDefinitionFromLocale[closestPowerOfTenWithAvailableAbbreviation]]};const scaleValueWithAbbreviation=(value,patternRules,options)=>{const{compact:compact,compactUnit:compactUnit}=patternRules;const{abbreviations:abbreviations}=options.locale;if(!compact)return[value,null];if(!!compactUnit){return resolveForcedAbbreviationUnit(compactUnit,abbreviations,value)}const scale=createUnitScaleFromLocaleAbbreviations$1(abbreviations);const[scaledValue,localizedUnit]=scale.toBest(value,"");return[scaledValue,localizedUnit||null]};var scaleValueWithAbbreviation$1=scaleValueWithAbbreviation;const roundNumber=(number,precision,roundingFunction)=>{const resolvedPrecision=precision||0;const resolvedRoundingFunction=roundingFunction||Math.round;const scaledValueForRounding=multiplyByPowerOfTen$1(number,resolvedPrecision);const roundedScaledValue=resolvedRoundingFunction(scaledValueForRounding);const roundedValue=multiplyByPowerOfTen$1(roundedScaledValue,-resolvedPrecision);return roundedValue};var roundNumber$1=roundNumber;const formatPositiveExponentResult=valueAsString=>{const[significand,exponent]=splitStringInTwoParts$1(valueAsString,"e");const exponentAsNumber=+exponent;if(exponentAsNumber<0)return valueAsString;const[integerPartOfSignificand,fractionalPartOfSignificand]=splitStringInTwoParts$1(significand,".");const numberOfZerosToAdd=exponentAsNumber-fractionalPartOfSignificand.length;return`${integerPartOfSignificand}${fractionalPartOfSignificand}${stringRepeat$1("0",numberOfZerosToAdd)}`};const formatNegativeExponentResult=(value,exponentAsNumber,significandAsString)=>{const negativeExponentAbsoluteValue=Math.abs(exponentAsNumber);const[integerPartOfSignificand,fractionalPartOfSignificand]=splitStringInTwoParts$1(significandAsString,".");const absoluteIntegerPartOfSignificand=integerPartOfSignificand[0]==="-"?integerPartOfSignificand.slice(1):integerPartOfSignificand;let outputIntegerPartOfSignificand=absoluteIntegerPartOfSignificand;let outputFractionalPartOfSignificand=fractionalPartOfSignificand;for(let i=0;i<negativeExponentAbsoluteValue;i+=1){const firstCharInIntegerPart=outputIntegerPartOfSignificand[0]||"";outputIntegerPartOfSignificand=outputIntegerPartOfSignificand.slice(0,outputIntegerPartOfSignificand.length-1);outputFractionalPartOfSignificand=(firstCharInIntegerPart||"0")+outputFractionalPartOfSignificand}return`${value<0?"-":""}${outputIntegerPartOfSignificand||0}.${outputFractionalPartOfSignificand}`};const numberToNonExponentialString=value=>{const valueAsString=(value||0).toString();const valueAsStringHasExponentialInfo=valueAsString.indexOf("e")>=0;if(!valueAsStringHasExponentialInfo)return valueAsString;const[significand,exponent]=splitStringInTwoParts$1(valueAsString,"e");const exponentAsNumber=+exponent;return exponentAsNumber>=0?formatPositiveExponentResult(valueAsString):formatNegativeExponentResult(value,exponentAsNumber,significand)};var numberToNonExponentialString$1=numberToNonExponentialString;const addTrailingZerosInFractionalPart=(valueAsString,minimumFractionDigits)=>{const[integerPart,fractionalPart]=splitStringInTwoParts$1(valueAsString,".");return`${integerPart}.${fractionalPart+stringRepeat$1("0",minimumFractionDigits-fractionalPart.length)}`};const numberToFixed=(finiteNumber,fractionDigits,roundingFunction,optionalFractionDigits)=>{const valueAsString=numberToNonExponentialString$1(finiteNumber);const minimumFractionDigits=fractionDigits-(optionalFractionDigits||0);const fractionalPartOfValueAsString=splitStringInTwoParts$1(valueAsString,".")[1];const targetFractionDigitsAmount=!!fractionalPartOfValueAsString?Math.min(Math.max(fractionalPartOfValueAsString.length,minimumFractionDigits),fractionDigits):minimumFractionDigits;const roundedValue=roundNumber$1(finiteNumber,targetFractionDigitsAmount,roundingFunction);let output=numberToNonExponentialString$1(roundedValue);if(!!minimumFractionDigits){output=addTrailingZerosInFractionalPart(output,minimumFractionDigits)}return output};var numberToFixed$1=numberToFixed;const roundValueAndAddTrailingZeros=(value,patternRules,options)=>{const{rounding:rounding}=options;const{minimumFractionDigits:minimumFractionDigits,maximumFractionDigits:maximumFractionDigits}=patternRules;const resolvedRoundingFunction=rounding||Math.round;const shouldIncludeDecimalPlaces=minimumFractionDigits>0||maximumFractionDigits>0;if(shouldIncludeDecimalPlaces){const optionalDecimalDigitsCount=maximumFractionDigits-minimumFractionDigits;return numberToFixed$1(value,maximumFractionDigits,resolvedRoundingFunction,optionalDecimalDigitsCount)}else{return numberToFixed$1(value,0,resolvedRoundingFunction)}};var roundValueAndAddTrailingZeros$1=roundValueAndAddTrailingZeros;const replaceDigitsWithNumeralSystem=(numericString,numeralSystemMap)=>{if(!numeralSystemMap||numeralSystemMap.length!==10)return numericString;const numericStringLength=numericString.length;let output="";for(let numericStringIndex=0;numericStringIndex<numericStringLength;numericStringIndex++){const char=numericString[numericStringIndex];output+=numeralSystemMap[char]||char}return output};var replaceDigitsWithNumeralSystem$1=replaceDigitsWithNumeralSystem;const addOrRemoveLeadingZerosToValue=(valueIntegerPartWithoutSign,patternRules)=>{const{minimumIntegerDigits:minimumIntegerDigits}=patternRules;if(minimumIntegerDigits===0&&+valueIntegerPartWithoutSign<1&&+valueIntegerPartWithoutSign>-1){return""}return valueIntegerPartWithoutSign.length>=minimumIntegerDigits?valueIntegerPartWithoutSign:`${stringRepeat$1("0",minimumIntegerDigits-valueIntegerPartWithoutSign.length)}${valueIntegerPartWithoutSign}`};var addOrRemoveLeadingZerosToValue$1=addOrRemoveLeadingZerosToValue;const addSignInfoToFullFormattedNumber=(fullFormattedValueWithoutSign,isValueNegative,isValueZero,patternRules)=>{const{negativeParentheses:negativeParentheses,forceSign:forceSign}=patternRules;let output=fullFormattedValueWithoutSign;if(negativeParentheses&&isValueNegative){output=output.replace(/'(nps|npe)'/g,(match=>match===`'nps'`?"(":")"))}else if(forceSign){output=output.replace(`'s'`,isValueNegative?"-":isValueZero?"":"+")}else if(isValueNegative){output=output.replace(`'s'`,"-")}return output};var addSignInfoToFullFormattedNumber$1=addSignInfoToFullFormattedNumber;const splitNumberIntegerAndDecimalParts=(valueAsString,patternRules)=>{const{optionalFractionDigits:optionalFractionDigits}=patternRules;const[integerPart,decimalPart]=splitStringInTwoParts$1(valueAsString,".");if(optionalFractionDigits&&Number(decimalPart)===0){return[integerPart,""]}return[integerPart,decimalPart]};var splitNumberIntegerAndDecimalParts$1=splitNumberIntegerAndDecimalParts;const addThousandsSeparatorToValueIntegerPart=(valueIntegerPartWithLeadingZerosAndWithoutSign,patternRules,options)=>{const{delimiters:delimiters,digitGroupingStyle:digitGroupingStyle}=options.locale;const{grouping:grouping}=patternRules;if(!grouping||!delimiters.thousands){return valueIntegerPartWithLeadingZerosAndWithoutSign}const valueAsString=valueIntegerPartWithLeadingZerosAndWithoutSign;const thousandsSeparator=delimiters.thousands;const digitGrouping=!!(digitGroupingStyle===null||digitGroupingStyle===void 0?void 0:digitGroupingStyle.length)?digitGroupingStyle:[3];const restDigitGrouping=[...digitGrouping];let output="";let groupingSubIteration=1;for(let i=valueAsString.length-1;i>=0;i--){if(groupingSubIteration===restDigitGrouping[0]&&i!==0){output=thousandsSeparator+valueAsString[i]+output;if(restDigitGrouping.length>1)restDigitGrouping.shift();groupingSubIteration=1}else{output=valueAsString[i]+output;groupingSubIteration+=1}}return output};var addThousandsSeparatorToValueIntegerPart$1=addThousandsSeparatorToValueIntegerPart;const applyAbbreviationLocalizedUnitToPatternMask=(patternMask,abbreviationLocalizedUnit,hasAbbreviationInPatternMask)=>{if(!hasAbbreviationInPatternMask)return patternMask;if(abbreviationLocalizedUnit){return patternMask.replace(`'a'`,(_=>`'${abbreviationLocalizedUnit.replace(/'/g,(_=>"\\'"))}'`))}else{return patternMask.match(/'n'\s*'a'/)?patternMask.replace(/\s*'a'/,""):patternMask.replace(/'a'\s*/,"")}};var applyAbbreviationLocalizedUnitToPatternMask$1=applyAbbreviationLocalizedUnitToPatternMask;const scaleAndRoundValue=(number,patternRules,options)=>{if(!patternRules.compact){const roundedValueAsString=roundValueAndAddTrailingZeros$1(number,patternRules,options);return[roundedValueAsString,null]}const[scaledValue,scaledValueLocalizedUnit]=scaleValueWithAbbreviation$1(number,patternRules,options);const roundedScaledValue=+roundValueAndAddTrailingZeros$1(scaledValue,patternRules,options);const[rescaledValue,rescaledValueLocalizedUnit]=rescaleRoundedValue$1(+roundedScaledValue,scaledValueLocalizedUnit,patternRules,options);const roundedRescaledValueAsStringWithTrailingZeros=roundValueAndAddTrailingZeros$1(rescaledValue,patternRules,options);return[roundedRescaledValueAsStringWithTrailingZeros,rescaledValueLocalizedUnit]};const numberToFormattedNumber=(number,pattern,options)=>{var _a;const patternRules=parsePattern$1(pattern);const resolvedValue=isFiniteNumber$1(number)?number:0;const[valueAsString,localizedAbbreviationUnit]=scaleAndRoundValue(resolvedValue,patternRules,options);if(valueAsString==="NaN")return"";const isValueNegative=options.signedZero?number<0:+valueAsString<0;const isValueZero=options.signedZero?number===0:+valueAsString===0;const valueAsStringWithoutSign=removeSignIfExists$1(valueAsString);const[integerPart,decimalPart]=splitNumberIntegerAndDecimalParts$1(valueAsStringWithoutSign,patternRules);const valueIntegerPartWithLeadingZeros=addOrRemoveLeadingZerosToValue$1(integerPart,patternRules);const valueIntegerPartWithThousandsSeparator=addThousandsSeparatorToValueIntegerPart$1(valueIntegerPartWithLeadingZeros,patternRules,options);const numeralSystemFromLocale=options.locale.numeralSystem;const integerPartWithNumeralSystem=replaceDigitsWithNumeralSystem$1(valueIntegerPartWithThousandsSeparator,numeralSystemFromLocale);const decimalPartWithNumeralSystem=replaceDigitsWithNumeralSystem$1(decimalPart,numeralSystemFromLocale);const fullNumberWithNumeralSystem=integerPartWithNumeralSystem+(!!decimalPartWithNumeralSystem?(((_a=options.locale.delimiters)===null||_a===void 0?void 0:_a.decimal)||".")+decimalPartWithNumeralSystem:"");const patternMaskWithAbbreviation=applyAbbreviationLocalizedUnitToPatternMask$1(patternRules.patternMask,localizedAbbreviationUnit,patternRules.compact);const patternMaskWithNumber=patternMaskWithAbbreviation.replace(`'n'`,(_=>`'${fullNumberWithNumeralSystem.replace(/'/g,"\\'")}'`));const patternMaskWithSignInfo=addSignInfoToFullFormattedNumber$1(patternMaskWithNumber,isValueNegative,isValueZero,patternRules);const cleanPatternMask=patternMaskWithSignInfo.replace(/'(nps|npe|s|a|n)'/g,"");const fullFormattedValueWithNormalizedText=patternStripAndNormalizeEscapedText(cleanPatternMask);return fullFormattedValueWithNormalizedText};var numberToFormattedNumber$1=numberToFormattedNumber;const bpsFormatter={name:"bps",regexps:{format:/BPS/,unformat:/BPS/},format:(number,pattern,options)=>{const scaledValue=multiplyByPowerOfTen$1(number,4);const patternWithEscapedBPS=patternReplace(pattern,/BPS/,`'BPS'`);const formatResult=numberToFormattedNumber$1(scaledValue,patternWithEscapedBPS,options);return formatResult.replace("BPS","BPS")},unformat:(string,options)=>{const number=formattedStringToNumber$1(string.replace(/\s?BPS/,""),options);return isFiniteNumber$1(number)?multiplyByPowerOfTen$1(number,-4):number}};var bpsFormatter$1=bpsFormatter;const timeFormatter={name:"time",regexps:{format:/([0-9]{1,2}:[0-9]{2}) *$/,unformat:/([0-9]{1,2}:[0-9]{2}) *$/},format:number=>{const absoluteValue=Math.abs(number);const sign=number<0?"-":"";const hours=truncateNumber$1(absoluteValue/3600);const minutes=truncateNumber$1((absoluteValue-hours*3600)/60);const seconds=truncateNumber$1(absoluteValue-hours*3600-minutes*60);return`${sign}${hours}:${(minutes<10?"0":"")+minutes}:${(seconds<10?"0":"")+seconds}`},unformat:string=>{const isNegative=/^ *-/.test(string);const stringWithoutSign=string.replace(/^ *-/,"");const timeArray=stringWithoutSign.split(":").reverse();let seconds=0;seconds+=+timeArray[0];seconds+=+timeArray[1]*60;seconds+=(+timeArray[2]||0)*3600;return isNegative&&seconds!==0?-seconds:seconds}};var timeFormatter$1=timeFormatter;const decimalSuffixes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];const binarySuffixes=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];const allSuffixes=decimalSuffixes.concat(binarySuffixes.slice(1));const unformatRegex=`(${allSuffixes.join("|").replace(/B/g,"B(?!PS)")})`;const bytesDecimalScale=unitScale({base:"B",scale:toObject$1(decimalSuffixes,((unit,unitIndex)=>[unit,Math.pow(1e3,unitIndex)]))});const bytesBinaryScale=unitScale({base:"B",scale:toObject$1(binarySuffixes,((unit,unitIndex)=>[unit,Math.pow(1024,unitIndex)]))});const bytesFormatter={name:"bytes",regexps:{format:/([0\s]b[bd])|(b[bd][0\s])/,unformat:(string,options)=>options.type==="bytes"?new RegExp(unformatRegex).test(string):false},format:(number,pattern,options)=>{const scale=patternIncludes(pattern,"bb")?bytesBinaryScale:bytesDecimalScale;const[scaledValue,scaledValueUnit]=scale.toBest(number,"B");const patternWithEscapedBytes=patternReplace(pattern,/b[bd]/,`'bytes'`);const formatResult=numberToFormattedNumber$1(scaledValue,patternWithEscapedBytes,options);return formatResult.replace("bytes",scaledValueUnit||"")},unformat:(string,options)=>{var _a;const number=formattedStringToNumber$1(string.replace(new RegExp(unformatRegex),""),options);const suffix=((_a=string.match(unformatRegex))===null||_a===void 0?void 0:_a[0])||"";const scale=!!bytesBinaryScale.scaleDefinition.scale[suffix]?bytesBinaryScale:bytesDecimalScale;return number?scale.toBase(number,suffix):number}};var bytesFormatter$1=bytesFormatter;const ordinalFormatter={name:"ordinal",regexps:{format:/o/},format:(number,pattern,options)=>{var _a,_b;const localizedOrdinal=((_b=(_a=options.locale).ordinal)===null||_b===void 0?void 0:_b.call(_a,number))||"";const patternWithEscapedOrdinal=patternReplace(pattern,/o/,`'ord'`);const formatResult=numberToFormattedNumber$1(number,patternWithEscapedOrdinal,options);return formatResult.replace("ord",(_=>localizedOrdinal))}};var ordinalFormatter$1=ordinalFormatter;const currencySymbolsMap={EUR:"",USD:"$",XCD:"EC$",AUD:"A$",INR:"",BRL:"R$",CAD:"CA$",XAF:"FCFA",CNY:"CN",NZD:"NZ$",XPF:"CFPF",GBP:"",HKD:"HK$",ILS:"",JPY:"",KRW:"",XOF:"CFA",MXN:"MX$",TWD:"NT$",VND:""};const currencyFormatter={name:"currency",regexps:{format:/(\$)/},format:(number,pattern,options)=>{var _a;const currencyFromOptions=(_a=options.currency)===null||_a===void 0?void 0:_a.toUpperCase();const localizedCurrencySymbol=currencySymbolsMap[currencyFromOptions]||currencyFromOptions||"";const patternWithEscapedCurrencySymbol=patternReplace(pattern,/\$/,`'currency'`);const formatResult=numberToFormattedNumber$1(number,patternWithEscapedCurrencySymbol,options);return formatResult.replace("currency",(_=>localizedCurrencySymbol))}};var currencyFormatter$1=currencyFormatter;const percentageFormatter={name:"percentage",regexps:{format:/%!?/,unformat:/%/},format:(number,pattern,options)=>{const hasNotScalePercentageSymbolInPattern=patternIncludes(pattern,"%!");const scaledValue=options.scalePercentage&&!hasNotScalePercentageSymbolInPattern?multiplyByPowerOfTen$1(number,2):number;const patternWithEscapedPercentage=patternReplace(pattern,/%!?/,`'%'`);const formatResult=numberToFormattedNumber$1(scaledValue,patternWithEscapedPercentage,options);return formatResult.replace("%","%")},unformat:(string,options)=>{const number=formattedStringToNumber$1(string.replace(/\s?%/,""),options);return number&&options.scalePercentage?multiplyByPowerOfTen$1(number,-2):number}};var percentageFormatter$1=percentageFormatter;const exponentialFormatter={name:"exponential",regexps:{format:/[eE][+-][0-9]+/,unformat:/[eE][+-][0-9]+/},format:(number,pattern,options)=>{const exponential=typeof number==="number"&&!isNaNNumber$1(number)?number.toExponential():"0e+0";const parts=splitStringInTwoParts$1(exponential,"e");const patternWithoutExponential=patternReplace(pattern,/e[+|-]{1}0/i,"");const formatResult=numberToFormattedNumber$1(+parts[0],patternWithoutExponential,options);return formatResult+"e"+parts[1]},unformat:(string,options)=>{var _a;const value=formattedStringToNumber$1(string.replace(/e[+-]{1}[0-9]{1,3}/i,""),options);const powerOfTenExponent=+(((_a=string.match(/e([+-]{1}[0-9]{1,3})/i))===null||_a===void 0?void 0:_a[1])||"0");return isFiniteNumber$1(value)?multiplyByPowerOfTen$1(value,powerOfTenExponent):value}};var exponentialFormatter$1=exponentialFormatter;const BUILT_IN_FORMATTERS=[percentageFormatter$1,currencyFormatter$1,ordinalFormatter$1,timeFormatter$1,bytesFormatter$1,exponentialFormatter$1,bpsFormatter$1];var BUILT_IN_FORMATTERS$1=BUILT_IN_FORMATTERS;const roundHalfAwayFromZero=value=>value>=0?Math.round(value):value%.5===0?Math.floor(value):Math.round(value);var roundHalfAwayFromZero$1=roundHalfAwayFromZero;const areDelimitersValid=delimiters=>!!(delimiters===null||delimiters===void 0?void 0:delimiters.decimal)&&isString$1(delimiters===null||delimiters===void 0?void 0:delimiters.thousands)&&delimiters.decimal!==delimiters.thousands;const resolveOptionsLocale=optionsLocale=>{const defaultLocale=locale$1;if(!isObject$1(optionsLocale))return defaultLocale;return merge(optionsLocale,{delimiters:areDelimitersValid(optionsLocale.delimiters)?optionsLocale.delimiters:defaultLocale.delimiters,abbreviations:optionsLocale.abbreviations||defaultLocale.abbreviations,ordinal:optionsLocale.ordinal||defaultLocale.ordinal})};const resolveRoundingOption=roundingOption=>{switch(roundingOption){case"ceil":return Math.ceil;case"floor":return Math.floor;case"truncate":return truncateNumber$1;case"half-up":return Math.round;case"half-away-from-zero":return roundHalfAwayFromZero$1;default:return isFunction$1(roundingOption)?roundingOption:roundHalfAwayFromZero$1}};const resolveOptionsFormatters=optionsFormatters=>{if(!optionsFormatters)return BUILT_IN_FORMATTERS$1;return isFunction$1(optionsFormatters)?optionsFormatters(BUILT_IN_FORMATTERS$1):[...optionsFormatters,...BUILT_IN_FORMATTERS$1]};const resolveFormatOptions=formatOptions=>{var _a,_b,_c;const options=formatOptions||{};const resolvedRoundingFunction=resolveRoundingOption(options.rounding);const resolvedLocale=resolveOptionsLocale(options.locale);const resolvedFormatters=resolveOptionsFormatters(options.formatters);return{defaultPattern:options.defaultPattern||"0,0.##########",nullFormat:options.nullFormat||"",nanFormat:options.nanFormat,zeroFormat:options.zeroFormat,locale:resolvedLocale,rounding:resolvedRoundingFunction,type:options.type,scalePercentage:(_a=options.scalePercentage)!==null&&_a!==void 0?_a:true,trim:(_b=options.trim)!==null&&_b!==void 0?_b:true,formatters:resolvedFormatters,currency:options.currency,signedZero:!!options.signedZero,nonBreakingSpace:(_c=options.nonBreakingSpace)!==null&&_c!==void 0?_c:false}};var resolveFormatOptions$1=resolveFormatOptions;const getUnformatFunctionIfMatch=(input,resolvedOptions)=>{for(const formatter of resolvedOptions.formatters){const matcher=formatter.regexps.unformat;if(!matcher)continue;const matcherResult=isFunction$1(matcher)?matcher(input,resolvedOptions):!!input.match(matcher);if(matcherResult)return formatter.unformat}};const parse$2=(input,options)=>{const resolvedOptions=resolveFormatOptions$1(options);let value;if(isNil$1(input)||isNaNNumber$1(input)){value=null}else if(typeof input==="number"){value=input===0?0:input}else if(typeof input==="string"){if(resolvedOptions.zeroFormat&&input===resolvedOptions.zeroFormat){value=0}else if(resolvedOptions.nullFormat&&input===resolvedOptions.nullFormat){value=null}else{const inputStringWithNormalSpaces=input.replace(/\u00A0/," ");const unformatFunctionFromFormatters=getUnformatFunctionIfMatch(inputStringWithNormalSpaces,resolvedOptions);const unformatFunction=unformatFunctionFromFormatters||formattedStringToNumber$1;value=unformatFunction(inputStringWithNormalSpaces,resolvedOptions)}}else{const result=+input;value=result===0?result:result||null}return value};var parse$1$1=parse$2;const parse=(string,options)=>parse$1$1(string,options);var parse$1=parse;const round=(number,precision,roundingFunction)=>roundNumber$1(number,precision,roundingFunction);var round$1=round;const getFormatFunctionIfMatch=(pattern,resolvedOptions)=>{const patternWithoutEscapedText=patternRemoveEscapedText(pattern);for(const formatter of resolvedOptions.formatters){const matcher=formatter.regexps.format;if(!matcher)continue;const matcherResult=isFunction$1(matcher)?matcher(pattern,resolvedOptions):!!patternWithoutEscapedText.match(matcher);if(matcherResult)return formatter.format}};const format$1=(value,pattern,options)=>{var _a;try{const resolvedValue=isString$1(value)?parseFloat(value):value;const resolvedOptions=resolveFormatOptions$1(options);const resolvedPattern=pattern||resolvedOptions.defaultPattern;let output;if(resolvedValue===Infinity||resolvedValue===-Infinity){output=resolvedValue>0?"":"-"}else if(isNaNNumber$1(resolvedValue)){return isString$1(resolvedOptions.nanFormat)?resolvedOptions.nanFormat:isString$1(resolvedOptions.nullFormat)?resolvedOptions.nullFormat:""}else if(isNil$1(resolvedValue)){output=isString$1(resolvedOptions.nullFormat)?resolvedOptions.nullFormat:""}else if(resolvedValue===0&&isString$1(resolvedOptions.zeroFormat)){output=resolvedOptions.zeroFormat}else{const resolvedValueAsNumber=resolvedValue||0;const formatFunctionFromFormatters=getFormatFunctionIfMatch(resolvedPattern,resolvedOptions);const resolvedFormatFunction=formatFunctionFromFormatters||numberToFormattedNumber$1;output=resolvedFormatFunction(resolvedValueAsNumber,resolvedPattern,resolvedOptions)}output=isString$1(output)?output:"";output=resolvedOptions.nonBreakingSpace?output.replace(/ /g,(_=>"")):output;output=resolvedOptions.trim?output.trim():output;return output}catch(_error){return((_a=options)===null||_a===void 0?void 0:_a._errorFormat)||""}};var format$1$1=format$1;function format(number,arg2,arg3){const pattern=isString$1(arg2)?arg2:null;const options=isObject$1(arg2)?arg2:isObject$1(arg3)?arg3:{};return format$1$1(number,pattern,options)}const createFormatFunction=options=>{const baseOptions=merge(options,{locale:isFunction$1(options.locale)?options.locale():options.locale});return(value,arg2,arg3)=>{const pattern=isString$1(arg2)?arg2:null;const optionsFromArguments=isObject$1(arg2)?arg2:isObject$1(arg3)?arg3:{};return format$1$1(value,pattern,merge(baseOptions,optionsFromArguments))}};format.withOptions=createFormatFunction;const unique=arr=>{if(!arr)return[];return arr.filter(((value,index,self)=>self.indexOf(value)===index))};var unique$1=unique;const leftToRightMark="";const rtlCharsRanges="---";const rtlDirCheck=new RegExp("^[^"+rtlCharsRanges+"]*?["+rtlCharsRanges+"]");const isRTL=string=>rtlDirCheck.test(string);const appendLeftToRightMarkIfIsRTL=string=>isRTL(string)?string+leftToRightMark:string;const languagesWith4DigitsGroupingStyle=["zh","yue","ko","ja"];const toLocaleStringSupportsOptions=()=>typeof Intl==="object"&&!!Intl&&typeof Intl.NumberFormat==="function";const getNumeralSystemDigits=languageTag=>{try{const localizedNumber=1234567890..toLocaleString(languageTag,{useGrouping:false});const lookupObject={};const repeatedChar=localizedNumber.split("").find((char=>{if(lookupObject[char])return true;lookupObject[char]=true}));const digitsWithoutGroupingDelimiters=repeatedChar?localizedNumber.replace(new RegExp(escapeRegexString$1(repeatedChar||""),"g"),""):localizedNumber;const digitsAsArray=digitsWithoutGroupingDelimiters.split("");const sortedDigits=[digitsAsArray[digitsAsArray.length-1],...digitsAsArray.slice(0,-1)];return sortedDigits.join("")}catch(_err){return null}};const getGroupingAndFractionDelimiters=(languageTag,digits)=>{try{const localizedNumber=12345678.123.toLocaleString(languageTag);const localizedNumberWithoutDigits=localizedNumber.replace(new RegExp(`[${escapeRegexString$1(digits)}]`,"g"),"");const[groupingDelimiter=",",fractionDelimiter="."]=unique$1(localizedNumberWithoutDigits.split(""));return[groupingDelimiter,fractionDelimiter]}catch(_err){return null}};const getGroupingStyle=(languageTag,groupingDelimiter)=>{if(languagesWith4DigitsGroupingStyle.some((language=>languageTag.indexOf(language)===0)))return[4];try{const result=[];let subIterationIndex=0;1e11.toLocaleString(languageTag).split("").reverse().forEach((digitOrGroupingDelimiter=>{if(digitOrGroupingDelimiter===groupingDelimiter){result.push(subIterationIndex);subIterationIndex=0}else{subIterationIndex+=1}}));let resultIndex=result.length;while(resultIndex--){if(result[resultIndex]===result[resultIndex-1])result.pop();else break}return result}catch(_err){return null}};const getAbbreviations=(languageTag,digits,type)=>{try{if(!toLocaleStringSupportsOptions())return null;const intlFormatOptions={notation:"compact",useGrouping:false,compactDisplay:type};const[digitOfZero,digitOfOne,digitOfTwo]=digits.split("");let abbreviations="";for(let i=1;i<50;i++){const abbreviationResultForOne=(+(1+stringRepeat$1("0",i))).toLocaleString(languageTag,intlFormatOptions);if(new RegExp(`^${digitOfOne}[^${digitOfZero}]+$`).test(abbreviationResultForOne)){if(type==="long"){const abbreviationResultForTwo=(+(2+stringRepeat$1("0",i))).toLocaleString(languageTag,intlFormatOptions);const abbreviationOne=abbreviationResultForOne.replace(new RegExp(`${digitOfOne}`,"g"),"").trim();const abbreviationTwo=abbreviationResultForTwo.replace(new RegExp(`${digitOfTwo}`,"g"),"").trim();abbreviations+="|"+appendLeftToRightMarkIfIsRTL(abbreviationOne)+":::"+appendLeftToRightMarkIfIsRTL(abbreviationTwo)}else{const abbreviation=abbreviationResultForOne.replace(new RegExp(`${digitOfOne}`,"g"),"").trim();abbreviations+="|"+appendLeftToRightMarkIfIsRTL(abbreviation)}}else{abbreviations+="|"}}let result=abbreviations;let resultIndex=result.length;while(resultIndex--){if(result[resultIndex]==="|")result=result.slice(0,-1);else break}return result}catch(_err){return null}};const baseGetLocaleFromPlatform=languageTag=>{const resolvedLanguageTag=languageTag||"en";const digits=getNumeralSystemDigits(resolvedLanguageTag);const resolvedDigits=digits||"0123456789";const delimiters=getGroupingAndFractionDelimiters(resolvedLanguageTag,resolvedDigits);const[groupingDelimiter,fractionDelimiter]=!!delimiters&&delimiters.length>=2?delimiters:[",","."];const groupingStyle=getGroupingStyle(resolvedLanguageTag,groupingDelimiter);const shortAbbreviations=getAbbreviations(resolvedLanguageTag,resolvedDigits,"short");const longAbbreviations=getAbbreviations(resolvedLanguageTag,resolvedDigits,"long");return{_abbreviationsLong:longAbbreviations||locale$1.abbreviations,code:resolvedLanguageTag,delimiters:{thousands:groupingDelimiter,decimal:fractionDelimiter},abbreviations:shortAbbreviations||locale$1.abbreviations,digitGroupingStyle:!!(groupingStyle===null||groupingStyle===void 0?void 0:groupingStyle.length)?groupingStyle:undefined,numeralSystem:digits!=="0123456789"?digits===null||digits===void 0?void 0:digits.split("").map(appendLeftToRightMarkIfIsRTL):undefined,ordinal:locale$1.ordinal}};const getLocaleFromPlatform$2=memoize$1(baseGetLocaleFromPlatform);var getLocaleFromPlatform$1$1=getLocaleFromPlatform$2;const getLocaleFromPlatform=languageTag=>getLocaleFromPlatform$1$1(languageTag);var getLocaleFromPlatform$1=getLocaleFromPlatform;var numerable={__proto__:null,parse:parse$1,round:round$1,format:format,getLocaleFromPlatform:getLocaleFromPlatform$1};Object.assign(ew__default["default"],numerable)})(ew,jQuery,luxon);
